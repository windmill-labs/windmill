import{D as J,bU as Cs,bP as W,cd as Xs,ce as we,cf as w,cg as Is,ch as ji,ci as Zs,E as b,H as $s,cj as Q,ck as qs,cl as js,cm as se,t as Ii,cn as k,bC as Js,bD as H,bG as Ye,bH as v,co as dt,bM as Te,cp as q,cq as Ji,cr as Ze,cs as Qi,ct as Xe,$ as K,cu as le,q as me,bx as Ts,h as X,v as m,bF as oe,bR as ue,bQ as B,cv as zt,cw as Ut,j as _,l as f,s as bs,b7 as O,bt as We,bu as U,cx as pe,cy as Qs,bY as I,cz as Kt,cA as Es,cB as ut,cC as ft,cD as en,cE as tn,bj as Ti,cF as Oi,cG as bi,cH as re,cI as ei,cJ as ce,cK as gt,U as et,cL as sn,cM as nn,cN as st,cO as on,cP as an,cQ as rn,cR as cn,cS as ze,cT as hn,cU as Ue,cV as ws,cW as _s,cX as ln,cY as G,cZ as di,c_ as si,m as Fe,c$ as vs,d0 as Ge,d1 as _e,d2 as Ds,d3 as dn,d4 as un,d5 as fn,d6 as h,bl as C,bV as Ae,bq as he,d7 as ai,d8 as Se,d9 as gn,da as qt,db as Rs,dc as mn,a9 as ui,dd as pn,de as An,df as Sn,a8 as xi,dg as ri,dh as ys,di as Cn,dj as nt,dk as D,dl as jt,bo as Ri,dm as In,bn as Ce,dn as Tn,bm as bn,X as Ps,dp as En,bO as yi,dq as wn,dr as _n,ds as Yt,dt as Ke,bp as vn,du as ki,dv as mt,dw as ni,dx as Jt,dy as Dn,dz as ii,dA as Ei,K as j,dB as ve,dC as pt,dD as Ie,dE as Ns,dF as Qt,dG as E,dH as Rn,dI as yn,dJ as Pn,dK as Nn,dL as Vn,dM as Bn,ax as T,dN as S,dO as Ln,dP as Mn,dQ as On,dR as li,dS as ot,dT as Pi,dU as Vs,dV as V,dW as xn,dX as es,dY as at,dZ as kn,d_ as Hn,d$ as Xt,e0 as At,e1 as L,e2 as is,e3 as x,e4 as Fn,e5 as Gn,e6 as Wn,e7 as zn,e8 as Un,e9 as Kn,ea as Yn,eb as ts,ec as hi,ed as F,ee as Xn,ef as ss,eg as ee,eh as qe,ei as Ni,ej as St,ek as Zn,el as $n,ay as P,em as ns,be as Bs,en as os,eo as qn,ep as jn,eq as Jn,G as Vi,er as Ls,es as Qn,bz as eo,et as io,eu as to,ev as Bi,ew as so,ex as rt,ey as no,ez as oo,eA as ao,eB as ro,eC as co,eD as ho,eE as lo,eF as uo,eG as fo,eH as go,eI as mo,eJ as Ms,eK as po,eL as Zt,eM as as,eN as Ao,eO as Os,bX as xs,eP as So,eQ as Co,bA as ks,bB as Hs,eR as Io,bE as Fs,eS as Li,eT as To,eU as bo,eV as Eo,eW as wo,eX as _o,eY as vo,bZ as $,eZ as rs,e_ as Do,e$ as Ro,f0 as yo,f1 as Po,f2 as Gs,f3 as No,f4 as cs,f5 as Vo,f6 as hs,f7 as ls,f8 as Bo,f9 as Lo,fa as Mo,fb as Oo,fc as xo,fd as ko,fe as Ho,ff as Fo,fg as Go,fh as Wo,V as zo,fi as Uo,fj as Ko,fk as Yo,fl as Xo,fm as Zo,fn as ds,fo as $o,fp as qo,fq as jo,fr as us,fs as $t,a4 as fi,ft as Ws,fu as Jo,fv as it,aT as Qo,fw as ea,fx as ia,au as ta,fy as sa,fz as na,fA as oa,fB as aa,fC as ra,fD as ca,fE as ha,fF as la,fG as da,fH as ua,fI as fa,fJ as ga,fK as ma,fL as pa}from"./index-DopNzxpa.js";import{fP as ar,fQ as rr,fN as cr,fT as hr,fR as lr,fO as dr,fS as ur,fM as fr}from"./index-DopNzxpa.js";var z;(function(u){u[u.ADD=0]="ADD",u[u.CHANGE=1]="CHANGE",u[u.EXPAND_COLLAPSE=2]="EXPAND_COLLAPSE",u[u.REMOVE=3]="REMOVE"})(z||(z={}));var oi;(function(u){u[u.ADD=0]="ADD",u[u.REMOVE=1]="REMOVE"})(oi||(oi={}));class Aa extends J{constructor(e,i){super(),this.item=e,this.onClose=i,this._onDidClose=this._register(new b),this.onDidClose=this._onDidClose.event,this._onDidChangeVisibility=this._register(new b),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this.registerListeners()}registerListeners(){this._register(this.item.onDidChangeVisibility(e=>this._onDidChangeVisibility.fire(e))),se.once(this.item.onDidClose)(()=>{this._onDidClose.fire(),this.dispose()})}get progress(){return this.item.progress}updateSeverity(e){this.item.updateSeverity(e)}updateMessage(e){this.item.updateMessage(e)}updateActions(e){this.item.updateActions(e)}close(){this.onClose(this.item),this.dispose()}}const Zi=class Zi extends J{constructor(){super(...arguments),this._onDidChangeNotification=this._register(new b),this.onDidChangeNotification=this._onDidChangeNotification.event,this._onDidChangeStatusMessage=this._register(new b),this.onDidChangeStatusMessage=this._onDidChangeStatusMessage.event,this._onDidChangeFilter=this._register(new b),this.onDidChangeFilter=this._onDidChangeFilter.event,this._notifications=[],this.filter={global:w.OFF,sources:new Map}}get notifications(){return this._notifications}get statusMessage(){return this._statusMessage}setFilter(e){let i=!1;typeof e.global=="number"&&(i=this.filter.global!==e.global,this.filter.global=e.global);let t=!1;e.sources&&(t=!js(this.filter.sources,e.sources),this.filter.sources=e.sources),(i||t)&&this._onDidChangeFilter.fire({global:i?e.global:void 0,sources:t?e.sources:void 0})}addNotification(e){const i=this.createViewItem(e);if(!i)return Zi.NO_OP_NOTIFICATION;const t=this.findNotification(i);return t==null||t.close(),this._notifications.splice(0,0,i),this._onDidChangeNotification.fire({item:i,index:0,kind:z.ADD}),new Aa(i,s=>this.onClose(s))}onClose(e){const i=this.findNotification(e);i&&i!==e?i.close():e.close()}findNotification(e){return this._notifications.find(i=>i.equals(e))}createViewItem(e){const i=wi.create(e,this.filter);if(!i)return;const t=(o,a)=>{const r=this._notifications.indexOf(i);r>=0&&this._onDidChangeNotification.fire({item:i,index:r,kind:o,detail:a})},s=i.onDidChangeExpansion(()=>t(z.EXPAND_COLLAPSE)),n=i.onDidChangeContent(o=>t(z.CHANGE,o.kind));return se.once(i.onDidClose)(()=>{s.dispose(),n.dispose();const o=this._notifications.indexOf(i);o>=0&&(this._notifications.splice(o,1),this._onDidChangeNotification.fire({item:i,index:o,kind:z.REMOVE}))}),i}showStatusMessage(e,i){const t=Ca.create(e,i);return t?(this._statusMessage=t,this._onDidChangeStatusMessage.fire({kind:oi.ADD,item:t}),Ii(()=>{this._statusMessage===t&&(this._statusMessage=void 0,this._onDidChangeStatusMessage.fire({kind:oi.REMOVE,item:t}))})):J.None}};Zi.NO_OP_NOTIFICATION=new qs;let fs=Zi;function ct(u){return u instanceof wi}var Z;(function(u){u[u.SEVERITY=0]="SEVERITY",u[u.MESSAGE=1]="MESSAGE",u[u.ACTIONS=2]="ACTIONS",u[u.PROGRESS=3]="PROGRESS"})(Z||(Z={}));class Sa extends J{constructor(){super(),this._onDidChange=this._register(new b),this.onDidChange=this._onDidChange.event,this._state=Object.create(null)}get state(){return this._state}infinite(){this._state.infinite||(this._state.infinite=!0,this._state.total=void 0,this._state.worked=void 0,this._state.done=void 0,this._onDidChange.fire())}done(){this._state.done||(this._state.done=!0,this._state.infinite=void 0,this._state.total=void 0,this._state.worked=void 0,this._onDidChange.fire())}total(e){this._state.total!==e&&(this._state.total=e,this._state.infinite=void 0,this._state.done=void 0,this._onDidChange.fire())}worked(e){typeof this._state.worked=="number"?this._state.worked+=e:this._state.worked=e,this._state.infinite=void 0,this._state.done=void 0,this._onDidChange.fire()}}const fe=class fe extends J{static create(e,i){if(!e||!e.message||Cs(e.message))return;let t;typeof e.severity=="number"?t=e.severity:t=W.Info;const s=fe.parseNotificationMessage(e.message);if(!s)return;let n;e.actions?n=e.actions:Xs(e.message)&&(n={primary:e.message.actions});let o=e.priority??we.DEFAULT;return o===we.DEFAULT&&t!==W.Error&&(i.global===w.ERROR?o=we.SILENT:Is(e.source)&&i.sources.get(e.source.id)===w.ERROR&&(o=we.SILENT)),new fe(e.id,t,e.sticky,o,s,e.source,e.progress,n)}static parseNotificationMessage(e){let i;if(e instanceof Error?i=ji(e,!1):typeof e=="string"&&(i=e),!i)return;const t=i;i.length>fe.MAX_MESSAGE_LENGTH&&(i=`${i.substr(0,fe.MAX_MESSAGE_LENGTH)}...`),i=i.replace(/(\r\n|\n|\r)/gm," ").trim();const s=Zs(i);return{raw:t,linkedText:s,original:e}}constructor(e,i,t,s,n,o,a,r){super(),this.id=e,this._severity=i,this._sticky=t,this._priority=s,this._message=n,this._source=o,this._visible=!1,this._onDidChangeExpansion=this._register(new b),this.onDidChangeExpansion=this._onDidChangeExpansion.event,this._onDidClose=this._register(new b),this.onDidClose=this._onDidClose.event,this._onDidChangeContent=this._register(new b),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidChangeVisibility=this._register(new b),this.onDidChangeVisibility=this._onDidChangeVisibility.event,a&&this.setProgress(a),this.setActions(r)}setProgress(e){e.infinite?this.progress.infinite():e.total&&(this.progress.total(e.total),e.worked&&this.progress.worked(e.worked))}setActions(e={primary:[],secondary:[]}){this._actions={primary:Array.isArray(e.primary)?e.primary:[],secondary:Array.isArray(e.secondary)?e.secondary:[]},this._expanded=e.primary&&e.primary.length>0}get canCollapse(){return!this.hasActions}get expanded(){return!!this._expanded}get severity(){return this._severity}get sticky(){if(this._sticky)return!0;const e=this.hasActions;return!!(e&&this._severity===W.Error||!e&&this._expanded||this._progress&&!this._progress.state.done)}get priority(){return this._priority}get hasActions(){return!this._actions||!this._actions.primary?!1:this._actions.primary.length>0}get hasProgress(){return!!this._progress}get progress(){return this._progress||(this._progress=this._register(new Sa),this._register(this._progress.onDidChange(()=>this._onDidChangeContent.fire({kind:Z.PROGRESS})))),this._progress}get message(){return this._message}get source(){return typeof this._source=="string"?this._source:this._source?this._source.label:void 0}get sourceId(){return this._source&&typeof this._source!="string"&&"id"in this._source?this._source.id:void 0}get actions(){return this._actions}get visible(){return this._visible}updateSeverity(e){e!==this._severity&&(this._severity=e,this._onDidChangeContent.fire({kind:Z.SEVERITY}))}updateMessage(e){const i=fe.parseNotificationMessage(e);!i||i.raw===this._message.raw||(this._message=i,this._onDidChangeContent.fire({kind:Z.MESSAGE}))}updateActions(e){this.setActions(e),this._onDidChangeContent.fire({kind:Z.ACTIONS})}updateVisibility(e){this._visible!==e&&(this._visible=e,this._onDidChangeVisibility.fire(e))}expand(){this._expanded||!this.canCollapse||(this._expanded=!0,this._onDidChangeExpansion.fire())}collapse(e){!this._expanded||!this.canCollapse||(this._expanded=!1,e||this._onDidChangeExpansion.fire())}toggle(){this._expanded?this.collapse():this.expand()}close(){this._onDidClose.fire(),this.dispose()}equals(e){if(this.hasProgress||e.hasProgress)return!1;if(typeof this.id=="string"||typeof e.id=="string")return this.id===e.id;if(typeof this._source=="object"){if(this._source.label!==e.source||this._source.id!==e.sourceId)return!1}else if(this._source!==e.source)return!1;if(this._message.raw!==e.message.raw)return!1;const i=this._actions&&this._actions.primary||[],t=e.actions&&e.actions.primary||[];return $s(i,t,(s,n)=>s.id+s.label===n.id+n.label)}};fe.MAX_MESSAGE_LENGTH=1e3;let wi=fe;class Hi extends Q{constructor(e,i){super(e,i.label,void 0,!0,async()=>{i.run(),this._onDidRun.fire()}),this._onDidRun=this._register(new b),this.onDidRun=this._onDidRun.event,this._keepOpen=!!i.keepOpen,this._menu=!i.isSecondary&&i.menu?i.menu.map((t,s)=>new Hi(`${e}.${s}`,t)):void 0}get menu(){return this._menu}get keepOpen(){return this._keepOpen}}class Ca{static create(e,i){if(!e||Cs(e))return;let t;if(e instanceof Error?t=ji(e,!1):typeof e=="string"&&(t=e),!!t)return{message:t,options:i}}}const Ct="notifications.showList",_i="notifications.hideList",Ia="notifications.toggleList",ht="notifications.hideToasts",gs="notifications.focusToasts",Ta="notifications.focusNextToast",ba="notifications.focusPreviousToast",Ea="notifications.focusFirstToast",wa="notifications.focusLastToast",It="notification.collapse",Tt="notification.expand",ms="notification.acceptPrimaryAction",_a="notification.toggle",bt="notification.clear",Fi="notifications.clearAll",Gi="notifications.toggleDoNotDisturbMode",Wi="notifications.toggleDoNotDisturbModeBySource";function Ee(u,e){if(ct(e))return e;const i=u.lastFocusedList;if(i instanceof Ut){let t=i.getFocusedElements()[0];if(ct(t)||i.isDOMFocused()&&(t=i.element(0)),ct(t))return t}}function va(u,e,i){k.registerCommandAndKeybindingRule({id:Ct,weight:H.WorkbenchContrib,primary:Js(Ye.CtrlCmd|v.KeyK,Ye.CtrlCmd|Ye.Shift|v.KeyN),handler:()=>{e.hide(),u.show()}}),k.registerCommandAndKeybindingRule({id:_i,weight:H.WorkbenchContrib+50,when:dt,primary:v.Escape,handler:()=>u.hide()}),Te.registerCommand(Ia,()=>{u.isVisible?u.hide():(e.hide(),u.show())}),k.registerCommandAndKeybindingRule({id:bt,weight:H.WorkbenchContrib,when:q,primary:v.Delete,mac:{primary:Ye.CtrlCmd|v.Backspace},handler:(s,n)=>{const o=s.get(Ji),a=Ee(s.get(Ze),n);a&&!a.hasProgress&&(a.close(),o.playSignal(Qi.clear))}}),k.registerCommandAndKeybindingRule({id:Tt,weight:H.WorkbenchContrib,when:q,primary:v.RightArrow,handler:(s,n)=>{const o=Ee(s.get(Ze),n);o==null||o.expand()}}),k.registerCommandAndKeybindingRule({id:ms,weight:H.WorkbenchContrib,when:Xe.or(q,le),primary:Ye.CtrlCmd|Ye.Shift|v.KeyA,handler:s=>{var r;const n=s.get(K).createInstance(vi),o=Ee(s.get(Ze))||i.notifications.at(0);if(!o)return;const a=(r=o.actions)!=null&&r.primary?o.actions.primary.at(0):void 0;a&&(n.run(a,o),o.close(),n.dispose())}}),k.registerCommandAndKeybindingRule({id:It,weight:H.WorkbenchContrib,when:q,primary:v.LeftArrow,handler:(s,n)=>{const o=Ee(s.get(Ze),n);o==null||o.collapse()}}),k.registerCommandAndKeybindingRule({id:_a,weight:H.WorkbenchContrib,when:q,primary:v.Space,secondary:[v.Enter],handler:s=>{const n=Ee(s.get(Ze));n==null||n.toggle()}}),Te.registerCommand(ht,s=>{e.hide()}),k.registerKeybindingRule({id:ht,weight:H.WorkbenchContrib-50,when:le,primary:v.Escape}),k.registerKeybindingRule({id:ht,weight:H.WorkbenchContrib+100,when:Xe.and(le,q),primary:v.Escape}),Te.registerCommand(gs,()=>e.focus()),k.registerCommandAndKeybindingRule({id:Ta,weight:H.WorkbenchContrib,when:Xe.and(q,le),primary:v.DownArrow,handler:()=>{e.focusNext()}}),k.registerCommandAndKeybindingRule({id:ba,weight:H.WorkbenchContrib,when:Xe.and(q,le),primary:v.UpArrow,handler:()=>{e.focusPrevious()}}),k.registerCommandAndKeybindingRule({id:Ea,weight:H.WorkbenchContrib,when:Xe.and(q,le),primary:v.PageUp,secondary:[v.Home],handler:()=>{e.focusFirst()}}),k.registerCommandAndKeybindingRule({id:wa,weight:H.WorkbenchContrib,when:Xe.and(q,le),primary:v.PageDown,secondary:[v.End],handler:()=>{e.focusLast()}}),Te.registerCommand(Fi,()=>u.clearAll()),Te.registerCommand(Gi,s=>{const n=s.get(me);n.setFilter(n.getFilter()===w.ERROR?w.OFF:w.ERROR)}),Te.registerCommand(Wi,s=>{const n=s.get(me),o=s.get(Ts),a=n.getFilters().sort((l,g)=>l.label.localeCompare(g.label)),r=new X,c=r.add(o.createQuickPick());c.items=a.map(l=>({id:l.id,label:l.label,tooltip:`${l.label} (${l.id})`,filter:l.filter})),c.canSelectMany=!0,c.placeholder=m(3348,"Select sources to enable all notifications from"),c.selectedItems=c.items.filter(l=>l.filter===w.OFF),c.show(),r.add(c.onDidAccept(async()=>{for(const l of c.items)n.setFilter({id:l.id,label:l.label,filter:c.selectedItems.includes(l)?w.OFF:w.ERROR});c.hide()})),r.add(c.onDidHide(()=>r.dispose()))});const t=oe(3349,"Notifications");ue.appendMenuItem(B.CommandPalette,{command:{id:Ct,title:oe(3350,"Show Notifications"),category:t}}),ue.appendMenuItem(B.CommandPalette,{command:{id:_i,title:oe(3351,"Hide Notifications"),category:t},when:dt}),ue.appendMenuItem(B.CommandPalette,{command:{id:Fi,title:oe(3352,"Clear All Notifications"),category:t}}),ue.appendMenuItem(B.CommandPalette,{command:{id:ms,title:oe(3353,"Accept Notification Primary Action"),category:t}}),ue.appendMenuItem(B.CommandPalette,{command:{id:Gi,title:oe(3354,"Toggle Do Not Disturb Mode"),category:t}}),ue.appendMenuItem(B.CommandPalette,{command:{id:Wi,title:oe(3355,"Toggle Do Not Disturb Mode By Source..."),category:t}}),ue.appendMenuItem(B.CommandPalette,{command:{id:gs,title:oe(3356,"Focus Notification Toast"),category:t},when:le})}let vi=class extends zt{constructor(e,i){super(),this.telemetryService=e,this.notificationService=i}async runAction(e,i){this.telemetryService.publicLog2("workbenchActionExecuted",{id:e.id,from:"message"});try{await super.runAction(e,i)}catch(t){this.notificationService.error(t)}}};vi=_([f(0,bs),f(1,me)],vi);const Da=We("notifications-clear",U.close,m(3321,"Icon for the clear action in notifications.")),Ra=We("notifications-clear-all",U.clearAll,m(3322,"Icon for the clear all action in notifications.")),ya=We("notifications-hide",U.chevronDown,m(3323,"Icon for the hide action in notifications.")),Pa=We("notifications-expand",U.chevronUp,m(3324,"Icon for the expand action in notifications.")),Na=We("notifications-collapse",U.chevronDown,m(3325,"Icon for the collapse action in notifications.")),Va=We("notifications-configure",U.gear,m(3326,"Icon for the configure action in notifications.")),zs=We("notifications-do-not-disturb",U.bellSlash,m(3327,"Icon for the mute all action in notifications."));var De;let gi=(De=class extends Q{constructor(e,i,t){super(e,i,O.asClassName(Da)),this.commandService=t}async run(e){this.commandService.executeCommand(bt,e)}},De.ID=bt,De.LABEL=m(3328,"Clear Notification"),De);gi=_([f(2,pe)],gi);var Re;let mi=(Re=class extends Q{constructor(e,i,t){super(e,i,O.asClassName(Ra)),this.commandService=t}async run(){this.commandService.executeCommand(Fi)}},Re.ID=Fi,Re.LABEL=m(3329,"Clear All Notifications"),Re);mi=_([f(2,pe)],mi);var ye;let zi=(ye=class extends Q{constructor(e,i,t){super(e,i,O.asClassName(zs)),this.commandService=t}async run(){this.commandService.executeCommand(Gi)}},ye.ID=Gi,ye.LABEL=m(3330,"Toggle Do Not Disturb Mode"),ye);zi=_([f(2,pe)],zi);var Pe;let Ui=(Pe=class extends Q{constructor(e,i,t){super(e,i),this.commandService=t}async run(){this.commandService.executeCommand(Wi)}},Pe.ID=Wi,Pe.LABEL=m(3331,"Toggle Do Not Disturb Mode By Source..."),Pe);Ui=_([f(2,pe)],Ui);const $i=class $i extends Q{constructor(e,i){super(e,i,O.asClassName(zs))}};$i.ID="workbench.action.configureDoNotDisturbMode",$i.LABEL=m(3332,"Configure Do Not Disturb...");let je=$i;var Ne;let pi=(Ne=class extends Q{constructor(e,i,t){super(e,i,O.asClassName(ya)),this.commandService=t}async run(){this.commandService.executeCommand(_i)}},Ne.ID=_i,Ne.LABEL=m(3333,"Hide Notifications"),Ne);pi=_([f(2,pe)],pi);var Ve;let Ai=(Ve=class extends Q{constructor(e,i,t){super(e,i,O.asClassName(Pa)),this.commandService=t}async run(e){this.commandService.executeCommand(Tt,e)}},Ve.ID=Tt,Ve.LABEL=m(3334,"Expand Notification"),Ve);Ai=_([f(2,pe)],Ai);var Be;let Si=(Be=class extends Q{constructor(e,i,t){super(e,i,O.asClassName(Na)),this.commandService=t}async run(e){this.commandService.executeCommand(It,e)}},Be.ID=It,Be.LABEL=m(3335,"Collapse Notification"),Be);Si=_([f(2,pe)],Si);const qi=class qi extends Q{constructor(e,i,t){super(e,i,O.asClassName(Va)),this.notification=t}};qi.ID="workbench.action.configureNotification",qi.LABEL=m(3336,"More Actions...");let ti=qi;var Le;let Ci=(Le=class extends Q{constructor(e,i,t){super(e,i),this.clipboardService=t}run(e){return this.clipboardService.writeText(e.message.raw)}},Le.ID="workbench.action.copyNotificationMessage",Le.LABEL=m(3337,"Copy Text"),Le);Ci=_([f(2,Qs)],Ci);var Et,ne;const ae=class ae{constructor(e){this.offsetHelper=this.createOffsetHelper(e)}createOffsetHelper(e){return e.appendChild(I(".notification-offset-helper"))}getHeight(e){if(!e.expanded)return ae.ROW_HEIGHT;let i=ae.ROW_HEIGHT;const t=this.computePreferredHeight(e);if(ae.LINE_HEIGHT<t){const n=t-ae.LINE_HEIGHT;i+=n}return(e.source||Oi(e.actions&&e.actions.primary))&&(i+=ae.ROW_HEIGHT),i===ae.ROW_HEIGHT&&e.collapse(!0),i}computePreferredHeight(e){let i=0;e.hasProgress||i++,e.canCollapse&&i++,Oi(e.actions&&e.actions.secondary)&&i++,this.offsetHelper.style.width=`${450-(40+i*30-Math.max(i-1,0)*4)}px`;const t=Us.render(e.message);this.offsetHelper.appendChild(t);const s=Math.max(this.offsetHelper.offsetHeight,this.offsetHelper.scrollHeight);return bi(this.offsetHelper),s}getTemplateId(e){if(e instanceof wi)return Ki.TEMPLATE_ID;throw new Error("unknown element type: "+e)}};ae.ROW_HEIGHT=42,ae.LINE_HEIGHT=22;let wt=ae;class Us{static render(e,i){const t=I("span");for(const s of e.linkedText.nodes)if(typeof s=="string")t.appendChild(document.createTextNode(s));else{let n=s.title;!n&&s.href.startsWith("command:")?n=m(3378,"Click to execute command '{0}'",s.href.substr(8)):n||(n=s.href);const o=I("a",{href:s.href,title:n,tabIndex:0},s.label);if(i){const a=A=>{cn(A)&&ei.stop(A,!0),i.callback(s.href)},r=i.toDispose.add(new st(o,ce.CLICK)).event,c=i.toDispose.add(new st(o,ce.KEY_DOWN)).event,l=se.chain(c,A=>A.filter(p=>{const R=new on(p);return R.equals(v.Space)||R.equals(v.Enter)}));i.toDispose.add(an.addTarget(o));const g=i.toDispose.add(new st(o,rn.Tap)).event;se.any(r,g,l)(a,null,i.toDispose)}t.appendChild(o)}return t}}var Me;let Ki=(Me=class{constructor(e,i,t,s){this.actionRunner=e,this.contextMenuService=i,this.instantiationService=t,this.notificationService=s}get templateId(){return Et.TEMPLATE_ID}renderTemplate(e){const i=Object.create(null);i.toDispose=new X,i.container=I(".notification-list-item"),i.mainRow=I(".notification-list-item-main-row"),i.icon=I(".notification-list-item-icon.codicon"),i.message=I(".notification-list-item-message");const t=this,s=I(".notification-list-item-toolbar-container");return i.toolbar=new Kt(s,{ariaLabel:m(3379,"Notification Actions"),actionViewItemProvider:(n,o)=>{if(n instanceof ti)return i.toDispose.add(new Es(n,{getActions(){var c,l,g;const a=[],r={id:n.notification.sourceId,label:n.notification.source};if(Is(r)){const A=t.notificationService.getFilter(r)===w.ERROR;a.push(ut({id:r.id,label:A?m(3380,"Turn On All Notifications from '{0}'",r.label):m(3381,"Turn Off Info and Warning Notifications from '{0}'",r.label),run:()=>t.notificationService.setFilter({...r,filter:A?w.OFF:w.ERROR})})),(l=(c=n.notification.actions)==null?void 0:c.secondary)!=null&&l.length&&a.push(new ft)}return Array.isArray((g=n.notification.actions)==null?void 0:g.secondary)&&a.push(...n.notification.actions.secondary),a}},this.contextMenuService,{...o,actionRunner:this.actionRunner,classNames:n.class}))},actionRunner:this.actionRunner}),i.toDispose.add(i.toolbar),i.detailsRow=I(".notification-list-item-details-row"),i.source=I(".notification-list-item-source"),i.buttonsContainer=I(".notification-list-item-buttons-container"),e.appendChild(i.container),i.container.appendChild(i.detailsRow),i.detailsRow.appendChild(i.source),i.detailsRow.appendChild(i.buttonsContainer),i.container.appendChild(i.mainRow),i.mainRow.appendChild(i.icon),i.mainRow.appendChild(i.message),i.mainRow.appendChild(s),i.progress=new en(e,tn),i.toDispose.add(i.progress),i.renderer=this.instantiationService.createInstance(_t,i,this.actionRunner),i.toDispose.add(i.renderer),i}renderElement(e,i,t){t.renderer.setInput(e)}disposeTemplate(e){Ti(e.toDispose)}},Et=Me,Me.TEMPLATE_ID="notification",Me);Ki=Et=_([f(1,ze),f(2,K),f(3,me)],Ki);var Oe;let _t=(Oe=class extends J{constructor(e,i,t,s,n,o,a){super(),this.template=e,this.actionRunner=i,this.openerService=t,this.instantiationService=s,this.keybindingService=n,this.contextMenuService=o,this.hoverService=a,this.inputDisposables=this._register(new X),ne.closeNotificationAction||(ne.closeNotificationAction=s.createInstance(gi,gi.ID,gi.LABEL),ne.expandNotificationAction=s.createInstance(Ai,Ai.ID,Ai.LABEL),ne.collapseNotificationAction=s.createInstance(Si,Si.ID,Si.LABEL))}setInput(e){this.inputDisposables.clear(),this.render(e)}render(e){this.template.container.classList.toggle("expanded",e.expanded),this.inputDisposables.add(re(this.template.container,ce.MOUSE_UP,n=>{n.button===1&&ei.stop(n,!0)})),this.inputDisposables.add(re(this.template.container,ce.AUXCLICK,n=>{!e.hasProgress&&n.button===1&&(ei.stop(n,!0),e.close())})),this.renderSeverity(e);const i=this.inputDisposables.add(this.hoverService.setupManagedHover(gt("mouse"),this.template.message,"")),t=this.renderMessage(e,i);this.renderSecondaryActions(e,t);const s=this.inputDisposables.add(this.hoverService.setupManagedHover(gt("mouse"),this.template.source,""));this.renderSource(e,s),this.renderButtons(e),this.renderProgress(e),this.inputDisposables.add(e.onDidChangeContent(n=>{switch(n.kind){case Z.SEVERITY:this.renderSeverity(e);break;case Z.PROGRESS:this.renderProgress(e);break;case Z.MESSAGE:this.renderMessage(e,i);break}}))}renderSeverity(e){ne.SEVERITIES.forEach(i=>{e.severity!==i&&this.template.icon.classList.remove(...O.asClassNameArray(this.toSeverityIcon(i)))}),this.template.icon.classList.add(...O.asClassNameArray(this.toSeverityIcon(e.severity)))}renderMessage(e,i){bi(this.template.message),this.template.message.appendChild(Us.render(e.message,{callback:s=>this.openerService.open(et.parse(s),{allowCommands:!0}),toDispose:this.inputDisposables}));const t=e.canCollapse&&!e.expanded&&this.template.message.scrollWidth>this.template.message.clientWidth;return i.update(t?this.template.message.textContent+"":""),t}renderSecondaryActions(e,i){var n;const t=[];if(Oi((n=e.actions)==null?void 0:n.secondary)){const o=this.instantiationService.createInstance(ti,ti.ID,ti.LABEL,e);t.push(o),this.inputDisposables.add(o)}let s=!1;e.canCollapse&&(e.expanded||e.source||i)&&(s=!0),s&&t.push(e.expanded?ne.collapseNotificationAction:ne.expandNotificationAction),e.hasProgress||t.push(ne.closeNotificationAction),this.template.toolbar.clear(),this.template.toolbar.context=e,t.forEach(o=>this.template.toolbar.push(o,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(o)}))}renderSource(e,i){e.expanded&&e.source?(this.template.source.textContent=m(3382,"Source: {0}",e.source),i.update(e.source)):(this.template.source.textContent="",i.update(""))}renderButtons(e){bi(this.template.buttonsContainer);const i=e.actions?e.actions.primary:void 0;if(e.expanded&&Oi(i)){const t=this,s=this.inputDisposables.add(new class extends zt{async runAction(o){t.actionRunner.run(o,e),(!(o instanceof Hi)||!o.keepOpen)&&e.close()}}),n=this.inputDisposables.add(new sn(this.template.buttonsContainer));for(let o=0;o<i.length;o++){const a=i[o],r={title:!0,secondary:o>0,...nn},c=a instanceof Hi?a.menu:void 0,l=this.inputDisposables.add(c?n.addButtonWithDropdown({...r,contextMenuProvider:this.contextMenuService,actions:c,actionRunner:s}):n.addButton(r));l.label=a.label,this.inputDisposables.add(l.onDidClick(g=>{g&&ei.stop(g,!0),s.run(a)}))}}}renderProgress(e){if(!e.hasProgress){this.template.progress.stop().hide();return}const i=e.progress.state;i.infinite?this.template.progress.infinite().show():typeof i.total=="number"||typeof i.worked=="number"?(typeof i.total=="number"&&!this.template.progress.hasTotal()&&this.template.progress.total(i.total),typeof i.worked=="number"&&this.template.progress.setWorked(i.worked).show()):this.template.progress.done().hide()}toSeverityIcon(e){switch(e){case W.Warning:return U.warning;case W.Error:return U.error}return U.info}getKeybindingLabel(e){const i=this.keybindingService.lookupKeybinding(e.id);return i?i.getLabel():null}},ne=Oe,Oe.SEVERITIES=[W.Info,W.Warning,W.Error],Oe);_t=ne=_([f(2,hn),f(3,K),f(4,Ue),f(5,ze),f(6,ws)],_t);let Yi=class extends J{constructor(e,i,t,s){super(),this.container=e,this.options=i,this.instantiationService=t,this.contextMenuService=s,this.viewModel=[]}show(){this.isVisible||(this.list||this.createNotificationsList(),this.isVisible=!0)}createNotificationsList(){this.listContainer=I(".notifications-list-container");const e=this._register(this.instantiationService.createInstance(vi)),i=this.instantiationService.createInstance(Ki,e),t=this.listDelegate=new wt(this.listContainer),s=this.options,n=this.list=this._register(this.instantiationService.createInstance(Ut,"NotificationsList",this.listContainer,t,[i],{...s,setRowLineHeight:!1,horizontalScrolling:!1,overrideStyles:{listBackground:_s},accessibilityProvider:this.instantiationService.createInstance(vt,s)})),o=this._register(this.instantiationService.createInstance(Ci,Ci.ID,Ci.LABEL));this._register(n.onContextMenu(r=>{r.element&&this.contextMenuService.showContextMenu({getAnchor:()=>r.anchor,getActions:()=>[o],getActionsContext:()=>r.element,actionRunner:e})})),this._register(n.onMouseDblClick(r=>r.element.toggle()));const a=this._register(ln(n.getHTMLElement()));this._register(a.onDidBlur(()=>{G(this.listContainer).document.hasFocus()&&n.setFocus([])})),q.bindTo(n.contextKeyService),this._register(n.onDidChangeSelection(r=>{r.indexes.length>0&&n.setSelection([])})),this.container.appendChild(this.listContainer)}updateNotificationsList(e,i,t=[]){const[s,n]=di(this.list,this.listContainer),o=si(n),a=s.getFocus()[0],r=this.viewModel[a];let c=null;if(typeof a=="number"&&(c=s.getRelativeTop(a)),this.viewModel.splice(e,i,...t),s.splice(e,i,t),s.layout(),this.viewModel.length===0)this.hide();else if(typeof a=="number"){let l=0;if(r){let g=this.viewModel.indexOf(r);g===-1&&(g=a-1),g<this.viewModel.length&&g>=0&&(l=g)}typeof c=="number"&&s.reveal(l,c),s.setFocus([l])}this.isVisible&&o&&s.domFocus()}updateNotificationHeight(e){const i=this.viewModel.indexOf(e);if(i===-1)return;const[t,s]=di(this.list,this.listDelegate);t.updateElementHeight(i,s.getHeight(e)),t.layout()}hide(){!this.isVisible||!this.list||(this.isVisible=!1,this.list.splice(0,this.viewModel.length),this.viewModel=[])}focusFirst(){this.list&&(this.list.focusFirst(),this.list.domFocus())}hasFocus(){return this.listContainer?si(this.listContainer):!1}layout(e,i){this.listContainer&&this.list&&(this.listContainer.style.width=`${e}px`,typeof i=="number"&&(this.list.getHTMLElement().style.maxHeight=`${i}px`),this.list.layout())}dispose(){this.hide(),super.dispose()}};Yi=_([f(2,K),f(3,ze)],Yi);let vt=class{constructor(e,i,t){this._options=e,this._keybindingService=i,this._configurationService=t}getAriaLabel(e){var s;let i;const t=(s=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))==null?void 0:s.getAriaLabel();return this._configurationService.getValue("accessibility.verbosity.notification")&&(i=t?m(3357,"Inspect the response in the accessible view with {0}",t):m(3358,"Inspect the response in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding")),e.source?i?m(3361,"{0}, source: {1}, notification, {2}",e.message.raw,e.source,i):m(3362,"{0}, source: {1}, notification",e.message.raw,e.source):i?m(3359,"{0}, notification, {1}",e.message.raw,i):m(3360,"{0}, notification",e.message.raw)}getWidgetAriaLabel(){return this._options.widgetAriaLabel??m(3363,"Notifications List")}getRole(){return"dialog"}};vt=_([f(1,Ue),f(2,Fe)],vt);var $e,ge;let Dt=(ge=class extends vs{constructor(e,i,t,s,n,o,a,r,c,l,g){super(t),this.container=e,this.model=i,this.instantiationService=s,this.layoutService=n,this.editorGroupService=a,this.keybindingService=r,this.notificationService=c,this.accessibilitySignalService=l,this.contextMenuService=g,this._onDidChangeVisibility=this._register(new b),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this.notificationsCenterVisibleContextKey=dt.bindTo(o),this.registerListeners()}registerListeners(){this._register(this.model.onDidChangeNotification(e=>this.onDidChangeNotification(e))),this._register(this.layoutService.onDidLayoutMainContainer(e=>this.layout(Ge.lift(e)))),this._register(this.notificationService.onDidChangeFilter(()=>this.onDidChangeFilter()))}onDidChangeFilter(){this.notificationService.getFilter()===w.ERROR&&this.hide()}get isVisible(){return!!this._isVisible}show(){if(this._isVisible){const t=_e(this.notificationsList);t.show(),t.focusFirst();return}this.notificationsCenterContainer||this.create(),this.updateTitle();const[e,i]=di(this.notificationsList,this.notificationsCenterContainer);this._isVisible=!0,i.classList.add("visible"),e.show(),this.layout(this.workbenchDimensions),e.updateNotificationsList(0,0,this.model.notifications),e.focusFirst(),this.updateStyles(),this.model.notifications.forEach(t=>t.updateVisibility(!0)),this.notificationsCenterVisibleContextKey.set(!0),this._onDidChangeVisibility.fire()}updateTitle(){const[e,i]=di(this.notificationsCenterTitle,this.clearAllAction);this.model.notifications.length===0?(e.textContent=m(3341,"No new notifications"),i.enabled=!1):(e.textContent=m(3342,"Notifications"),i.enabled=this.model.notifications.some(t=>!t.hasProgress))}create(){this.notificationsCenterContainer=I(".notifications-center"),this.notificationsCenterHeader=I(".notifications-center-header"),this.notificationsCenterContainer.appendChild(this.notificationsCenterHeader),this.notificationsCenterTitle=I("span.notifications-center-header-title"),this.notificationsCenterHeader.appendChild(this.notificationsCenterTitle);const e=I(".notifications-center-header-toolbar");this.notificationsCenterHeader.appendChild(e);const i=this._register(this.instantiationService.createInstance(vi)),t=this,s=this._register(new Kt(e,{ariaLabel:m(3343,"Notification Center Actions"),actionRunner:i,actionViewItemProvider:(o,a)=>{if(o.id===je.ID)return this._register(this.instantiationService.createInstance(Es,o,{getActions(){const r=[ut({id:zi.ID,label:t.notificationService.getFilter()===w.OFF?m(3344,"Enable Do Not Disturb Mode"):m(3345,"Disable Do Not Disturb Mode"),run:()=>t.notificationService.setFilter(t.notificationService.getFilter()===w.OFF?w.ERROR:w.OFF)})],c=t.notificationService.getFilters().sort((l,g)=>l.label.localeCompare(g.label));for(const l of c.slice(0,$e.MAX_NOTIFICATION_SOURCES))r.length===1&&r.push(new ft),r.push(ut({id:`${zi.ID}.${l.id}`,label:l.label,checked:l.filter!==w.ERROR,run:()=>t.notificationService.setFilter({...l,filter:l.filter===w.ERROR?w.OFF:w.ERROR})}));return c.length>$e.MAX_NOTIFICATION_SOURCES&&(r.push(new ft),r.push(t._register(t.instantiationService.createInstance(Ui,Ui.ID,m(3346,"More…"))))),r}},this.contextMenuService,{...a,actionRunner:i,classNames:o.class,keybindingProvider:r=>this.keybindingService.lookupKeybinding(r.id)}))}}));this.clearAllAction=this._register(this.instantiationService.createInstance(mi,mi.ID,mi.LABEL)),s.push(this.clearAllAction,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(this.clearAllAction)}),this.configureDoNotDisturbAction=this._register(this.instantiationService.createInstance(je,je.ID,je.LABEL)),s.push(this.configureDoNotDisturbAction,{icon:!0,label:!1});const n=this._register(this.instantiationService.createInstance(pi,pi.ID,pi.LABEL));s.push(n,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(n)}),this.notificationsList=this.instantiationService.createInstance(Yi,this.notificationsCenterContainer,{widgetAriaLabel:m(3347,"Notifications Center")}),this.container.appendChild(this.notificationsCenterContainer)}getKeybindingLabel(e){const i=this.keybindingService.lookupKeybinding(e.id);return i?i.getLabel():null}onDidChangeNotification(e){if(!this._isVisible)return;let i=!1;const[t,s]=di(this.notificationsList,this.notificationsCenterContainer);switch(e.kind){case z.ADD:t.updateNotificationsList(e.index,0,[e.item]),e.item.updateVisibility(!0);break;case z.CHANGE:switch(e.detail){case Z.ACTIONS:t.updateNotificationsList(e.index,1,[e.item]);break;case Z.MESSAGE:e.item.expanded&&t.updateNotificationHeight(e.item);break}break;case z.EXPAND_COLLAPSE:t.updateNotificationsList(e.index,1,[e.item]);break;case z.REMOVE:i=si(s),t.updateNotificationsList(e.index,1),e.item.updateVisibility(!1);break}this.updateTitle(),this.model.notifications.length===0&&(this.hide(),i&&this.editorGroupService.activeGroup.focus())}hide(){if(!this._isVisible||!this.notificationsCenterContainer||!this.notificationsList)return;const e=si(this.notificationsCenterContainer);this._isVisible=!1,this.notificationsCenterContainer.classList.remove("visible"),this.notificationsList.hide(),this.model.notifications.forEach(i=>i.updateVisibility(!1)),this.notificationsCenterVisibleContextKey.set(!1),this._onDidChangeVisibility.fire(),e&&this.editorGroupService.activeGroup.focus()}updateStyles(){if(this.notificationsCenterContainer&&this.notificationsCenterHeader){const e=this.getColor(Ds);this.notificationsCenterContainer.style.boxShadow=e?`0 0 8px 2px ${e}`:"";const i=this.getColor(dn);this.notificationsCenterContainer.style.border=i?`1px solid ${i}`:"";const t=this.getColor(un);this.notificationsCenterHeader.style.color=t??"";const s=this.getColor(fn);this.notificationsCenterHeader.style.background=s??""}}layout(e){if(this.workbenchDimensions=e,this._isVisible&&this.notificationsCenterContainer){const i=$e.MAX_DIMENSIONS.width,t=$e.MAX_DIMENSIONS.height;let s=i,n=t;this.workbenchDimensions&&(s=this.workbenchDimensions.width,s-=2*8,n=this.workbenchDimensions.height-35,this.layoutService.isVisible(h.STATUSBAR_PART,C)&&(n-=22),this.layoutService.isVisible(h.TITLEBAR_PART,C)&&(n-=22),n-=2*12),_e(this.notificationsList).layout(Math.min(i,s),Math.min(t,n))}}clearAll(){this.hide();for(const e of[...this.model.notifications])e.hasProgress||e.close(),this.accessibilitySignalService.playSignal(Qi.clear)}},$e=ge,ge.MAX_DIMENSIONS=new Ge(450,400),ge.MAX_NOTIFICATION_SOURCES=10,ge);Dt=$e=_([f(2,Ae),f(3,K),f(4,he),f(5,ai),f(6,Se),f(7,Ue),f(8,me),f(9,Ji),f(10,ze)],Dt);class Ba extends J{constructor(e){super(),this.model=e;for(const i of e.notifications)this.triggerAriaAlert(i);this.registerListeners()}registerListeners(){this._register(this.model.onDidChangeNotification(e=>this.onDidChangeNotification(e)))}onDidChangeNotification(e){e.kind===z.ADD&&(this.triggerAriaAlert(e.item),e.item.severity===W.Error&&(e.item.message.original instanceof Error?console.error(e.item.message.original):console.error(ji(e.item.message.linkedText.toString(),!0))))}triggerAriaAlert(e){if(e.priority===we.SILENT)return;const i=e.onDidChangeContent(t=>{t.kind===Z.MESSAGE&&this.doTriggerAriaAlert(e)});se.once(e.onDidClose)(()=>i.dispose()),this.doTriggerAriaAlert(e)}doTriggerAriaAlert(e){let i;e.severity===W.Error?i=m(3338,"Error: {0}",e.message.linkedText.toString()):e.severity===W.Warning?i=m(3339,"Warning: {0}",e.message.linkedText.toString()):i=m(3340,"Info: {0}",e.message.linkedText.toString()),gn(i)}}let Rt=class extends J{constructor(e,i,t){super(),this.model=e,this.statusbarService=i,this.notificationService=t,this.newNotificationsCount=0,this.isNotificationsCenterVisible=!1,this.isNotificationsToastsVisible=!1,this.updateNotificationsCenterStatusItem(),e.statusMessage&&this.doSetStatusMessage(e.statusMessage),this.registerListeners()}registerListeners(){this._register(this.model.onDidChangeNotification(e=>this.onDidChangeNotification(e))),this._register(this.model.onDidChangeStatusMessage(e=>this.onDidChangeStatusMessage(e))),this._register(this.notificationService.onDidChangeFilter(()=>this.updateNotificationsCenterStatusItem()))}onDidChangeNotification(e){this.isNotificationsCenterVisible||(e.kind===z.ADD?this.newNotificationsCount++:e.kind===z.REMOVE&&this.newNotificationsCount>0&&this.newNotificationsCount--),this.updateNotificationsCenterStatusItem()}updateNotificationsCenterStatusItem(){let e=0;if(!this.isNotificationsCenterVisible&&!this.isNotificationsToastsVisible)for(const t of this.model.notifications)t.hasProgress&&e++;let i={name:m(3364,"Notifications"),text:`${e>0||this.newNotificationsCount>0?"$(bell-dot)":"$(bell)"}`,ariaLabel:m(3364,"Notifications"),command:this.isNotificationsCenterVisible?_i:Ct,tooltip:this.getTooltip(e),showBeak:this.isNotificationsCenterVisible};this.notificationService.getFilter()===w.ERROR&&(i={...i,text:`${e>0||this.newNotificationsCount>0?"$(bell-slash-dot)":"$(bell-slash)"}`,ariaLabel:m(3365,"Do Not Disturb"),tooltip:m(3366,"Do Not Disturb Mode is Enabled")}),this.notificationsCenterStatusItem?this.notificationsCenterStatusItem.update(i):this.notificationsCenterStatusItem=this.statusbarService.addEntry(i,"status.notifications",qt.RIGHT,Number.NEGATIVE_INFINITY)}getTooltip(e){return this.isNotificationsCenterVisible?m(3367,"Hide Notifications"):this.model.notifications.length===0?m(3368,"No Notifications"):e===0?this.newNotificationsCount===0?m(3369,"No New Notifications"):this.newNotificationsCount===1?m(3370,"1 New Notification"):m(3371,"{0} New Notifications",this.newNotificationsCount):this.newNotificationsCount===0?m(3372,"No New Notifications ({0} in progress)",e):this.newNotificationsCount===1?m(3373,"1 New Notification ({0} in progress)",e):m(3374,"{0} New Notifications ({1} in progress)",this.newNotificationsCount,e)}update(e,i){let t=!1;this.isNotificationsCenterVisible!==e&&(this.isNotificationsCenterVisible=e,this.newNotificationsCount=0,t=!0),this.isNotificationsToastsVisible!==i&&(this.isNotificationsToastsVisible=i,t=!0),t&&this.updateNotificationsCenterStatusItem()}onDidChangeStatusMessage(e){const i=e.item;switch(e.kind){case oi.ADD:this.doSetStatusMessage(i);break;case oi.REMOVE:this.currentStatusMessage&&this.currentStatusMessage[0]===i&&(Ti(this.currentStatusMessage[1]),this.currentStatusMessage=void 0);break}}doSetStatusMessage(e){const i=e.message,t=e.options&&typeof e.options.showAfter=="number"?e.options.showAfter:0,s=e.options&&typeof e.options.hideAfter=="number"?e.options.hideAfter:-1;this.currentStatusMessage&&Ti(this.currentStatusMessage[1]);let n,o=setTimeout(()=>{n=this.statusbarService.addEntry({name:m(3375,"Status Message"),text:i,ariaLabel:i},"status.message",qt.LEFT,Number.NEGATIVE_INFINITY),o=null},t),a;const r={dispose:()=>{o&&clearTimeout(o),a&&clearTimeout(a),n==null||n.dispose()}};s>0&&(a=setTimeout(()=>r.dispose(),s)),this.currentStatusMessage=[e,r]}};Rt=_([f(1,Rs),f(2,me)],Rt);var be,ie;(function(u){u[u.HIDDEN_OR_VISIBLE=0]="HIDDEN_OR_VISIBLE",u[u.HIDDEN=1]="HIDDEN",u[u.VISIBLE=2]="VISIBLE"})(ie||(ie={}));var te;let yt=(te=class extends vs{get isVisible(){return!!this._isVisible}constructor(e,i,t,s,n,o,a,r,c){super(n),this.container=e,this.model=i,this.instantiationService=t,this.layoutService=s,this.editorGroupService=o,this.lifecycleService=r,this.hostService=c,this._onDidChangeVisibility=this._register(new b),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._isVisible=!1,this.mapNotificationToToast=new Map,this.mapNotificationToDisposable=new Map,this.addedToastsIntervalCounter=new mn(be.SPAM_PROTECTION.interval),this.notificationsToastsVisibleContextKey=le.bindTo(a),this.registerListeners()}registerListeners(){this._register(this.layoutService.onDidLayoutMainContainer(e=>this.layout(Ge.lift(e)))),this.lifecycleService.when(ui.Restored).then(()=>{this.model.notifications.forEach(e=>this.addToast(e)),this._register(this.model.onDidChangeNotification(e=>this.onDidChangeNotification(e)))}),this._register(this.model.onDidChangeFilter(({global:e,sources:i})=>{if(e===w.ERROR)this.hide();else if(i)for(const[t]of this.mapNotificationToToast)typeof t.sourceId=="string"&&i.get(t.sourceId)===w.ERROR&&t.severity!==W.Error&&t.priority!==we.URGENT&&this.removeToast(t)}))}onDidChangeNotification(e){switch(e.kind){case z.ADD:return this.addToast(e.item);case z.REMOVE:return this.removeToast(e.item)}}addToast(e){if(this.isNotificationsCenterVisible||e.priority===we.SILENT||this.addedToastsIntervalCounter.increment()>be.SPAM_PROTECTION.limit)return;const i=new X;this.mapNotificationToDisposable.set(e,i),i.add(pn(G(this.container),()=>this.doAddToast(e,i)))}doAddToast(e,i){let t=this.notificationsToastsContainer;t||(t=this.notificationsToastsContainer=I(".notifications-toasts"),this.container.appendChild(t)),t.classList.add("visible");const s=I(".notification-toast-container"),n=t.firstChild;n?t.insertBefore(s,n):t.appendChild(s);const o=I(".notification-toast");s.appendChild(o);const a=this.instantiationService.createInstance(Yi,o,{verticalScrollMode:An.Hidden,widgetAriaLabel:e.source?m(3377,"{0}, source: {1}, notification",e.message.raw,e.source):m(3376,"{0}, notification",e.message.raw)});i.add(a);const r={item:e,list:a,container:s,toast:o};this.mapNotificationToToast.set(e,r),i.add(Ii(()=>this.updateToastVisibility(r,!1))),a.show();const c=this.computeMaxDimensions();this.layoutLists(c.width),a.updateNotificationsList(0,0,[e]),this.layoutContainer(c.height),i.add(e.onDidChangeExpansion(()=>{a.updateNotificationsList(0,1,[e])})),i.add(e.onDidChangeContent(l=>{switch(l.kind){case Z.ACTIONS:a.updateNotificationsList(0,1,[e]);break;case Z.MESSAGE:e.expanded&&a.updateNotificationHeight(e);break}})),se.once(e.onDidClose)(()=>{this.removeToast(e)}),this.purgeNotification(e,s,a,i),this.updateStyles(),this.notificationsToastsVisibleContextKey.set(!0),o.classList.add("notification-fade-in"),i.add(re(o,"transitionend",()=>{o.classList.remove("notification-fade-in"),o.classList.add("notification-fade-in-done")})),e.updateVisibility(!0),this._isVisible||(this._isVisible=!0,this._onDidChangeVisibility.fire())}purgeNotification(e,i,t,s){let n=!1;s.add(re(i,ce.MOUSE_OVER,()=>n=!0)),s.add(re(i,ce.MOUSE_OUT,()=>n=!1));let o,a;const r=()=>{o=setTimeout(()=>{this.hostService.hasFocus?e.sticky||t.hasFocus()||n?r():this.removeToast(e):a||(a=this.hostService.onDidChangeFocus(c=>{c&&r()}),s.add(a))},be.PURGE_TIMEOUT[e.severity])};r(),s.add(Ii(()=>clearTimeout(o)))}removeToast(e){let i=!1;const t=this.mapNotificationToToast.get(e);t&&(si(t.container)&&(i=!(this.focusNext()||this.focusPrevious())),this.mapNotificationToToast.delete(e));const s=this.mapNotificationToDisposable.get(e);s&&(Ti(s),this.mapNotificationToDisposable.delete(e)),this.mapNotificationToToast.size>0?this.layout(this.workbenchDimensions):(this.doHide(),i&&this.editorGroupService.activeGroup.focus())}removeToasts(){this.mapNotificationToToast.clear(),this.mapNotificationToDisposable.forEach(e=>Ti(e)),this.mapNotificationToDisposable.clear(),this.doHide()}doHide(){var e;(e=this.notificationsToastsContainer)==null||e.classList.remove("visible"),this.notificationsToastsVisibleContextKey.set(!1),this._isVisible&&(this._isVisible=!1,this._onDidChangeVisibility.fire())}hide(){const e=this.notificationsToastsContainer?si(this.notificationsToastsContainer):!1;this.removeToasts(),e&&this.editorGroupService.activeGroup.focus()}focus(){const e=this.getToasts(ie.VISIBLE);return e.length>0?(e[0].list.focusFirst(),!0):!1}focusNext(){const e=this.getToasts(ie.VISIBLE);for(let i=0;i<e.length;i++)if(e[i].list.hasFocus()){const s=e[i+1];if(s)return s.list.focusFirst(),!0;break}return!1}focusPrevious(){const e=this.getToasts(ie.VISIBLE);for(let i=0;i<e.length;i++)if(e[i].list.hasFocus()){const s=e[i-1];if(s)return s.list.focusFirst(),!0;break}return!1}focusFirst(){const e=this.getToasts(ie.VISIBLE)[0];return e?(e.list.focusFirst(),!0):!1}focusLast(){const e=this.getToasts(ie.VISIBLE);return e.length>0?(e[e.length-1].list.focusFirst(),!0):!1}update(e){this.isNotificationsCenterVisible!==e&&(this.isNotificationsCenterVisible=e,this.isNotificationsCenterVisible&&this.removeToasts())}updateStyles(){this.mapNotificationToToast.forEach(({toast:e})=>{const i=this.getColor(_s);e.style.background=i||"";const t=this.getColor(Ds);e.style.boxShadow=t?`0 0 8px 2px ${t}`:"";const s=this.getColor(Sn);e.style.border=s?`1px solid ${s}`:""})}getToasts(e){const i=[];return this.mapNotificationToToast.forEach(t=>{switch(e){case ie.HIDDEN_OR_VISIBLE:i.push(t);break;case ie.HIDDEN:this.isToastInDOM(t)||i.push(t);break;case ie.VISIBLE:this.isToastInDOM(t)&&i.push(t);break}}),i.reverse()}layout(e){this.workbenchDimensions=e;const i=this.computeMaxDimensions();i.height&&this.layoutContainer(i.height),this.layoutLists(i.width)}computeMaxDimensions(){const e=be.MAX_WIDTH;let i=e,t;return this.workbenchDimensions&&(i=this.workbenchDimensions.width,i-=2*8,t=this.workbenchDimensions.height,this.layoutService.isVisible(h.STATUSBAR_PART,C)&&(t-=22),this.layoutService.isVisible(h.TITLEBAR_PART,C)&&(t-=22),t-=2*12),t=typeof t=="number"?Math.round(t*.618):0,new Ge(Math.min(e,i),t)}layoutLists(e){this.mapNotificationToToast.forEach(({list:i})=>i.layout(e))}layoutContainer(e){let i=0;for(const t of this.getToasts(ie.HIDDEN_OR_VISIBLE)){t.container.style.opacity="0",this.updateToastVisibility(t,!0),e-=t.container.offsetHeight;let s=!1;i===be.MAX_NOTIFICATIONS?s=!1:e>=0&&(s=!0),this.updateToastVisibility(t,s),t.container.style.opacity="",s&&i++}}updateToastVisibility(e,i){if(this.isToastInDOM(e)===i)return;const t=_e(this.notificationsToastsContainer);i?t.appendChild(e.container):e.container.remove(),e.item.updateVisibility(i)}isToastInDOM(e){return!!e.container.parentElement}},be=te,te.MAX_WIDTH=450,te.MAX_NOTIFICATIONS=3,te.PURGE_TIMEOUT={[W.Info]:15e3,[W.Warning]:18e3,[W.Error]:2e4},te.SPAM_PROTECTION={interval:800,limit:te.MAX_NOTIFICATIONS},te);yt=be=_([f(2,K),f(3,he),f(4,Ae),f(5,Se),f(6,ai),f(7,xi),f(8,ri)],yt);var y;(function(u){u.SIDEBAR_HIDDEN="nosidebar",u.MAIN_EDITOR_AREA_HIDDEN="nomaineditorarea",u.PANEL_HIDDEN="nopanel",u.AUXILIARYBAR_HIDDEN="noauxiliarybar",u.STATUSBAR_HIDDEN="nostatusbar",u.FULLSCREEN="fullscreen",u.MAXIMIZED="maximized",u.WINDOW_BORDER="border"})(y||(y={}));const La=["chat.commandCenter.enabled","workbench.navigationControl.enabled","workbench.experimental.share.enabled"],Ma=[D.ACTIVITY_BAR_LOCATION,D.COMMAND_CENTER,...La,D.EDITOR_ACTIONS_LOCATION,D.LAYOUT_ACTIONS,"window.menuBarVisibility",ki.TITLE_BAR_STYLE,ki.CUSTOM_TITLE_BAR_VISIBILITY],ps=new Ge(ns.width,ns.height);class Oa extends J{get activeContainer(){return this.getContainerFromDocument(ys())}get containers(){const e=[];for(const{window:i}of Cn())e.push(this.getContainerFromDocument(i.document));return e}getContainerFromDocument(e){return e===this.mainContainer.ownerDocument?this.mainContainer:e.body.getElementsByClassName("monaco-workbench")[0]}whenContainerStylesLoaded(e){return this.containerStylesLoaded.get(e.vscodeWindowId)}get mainContainerDimension(){return this._mainContainerDimension}get activeContainerDimension(){return this.getContainerDimension(this.activeContainer)}getContainerDimension(e){return e===this.mainContainer?this.mainContainerDimension:nt(e)}get mainContainerOffset(){return this.computeContainerOffset(C)}get activeContainerOffset(){return this.computeContainerOffset(G(this.activeContainer))}computeContainerOffset(e){let i=0,t=0;this.isVisible(h.BANNER_PART)&&(i=this.getPart(h.BANNER_PART).maximumHeight,t=i);const s=this.isVisible(h.TITLEBAR_PART,e);return s&&(i+=this.getPart(h.TITLEBAR_PART).maximumHeight,t=i),s&&this.configurationService.getValue(D.COMMAND_CENTER)!==!1&&(t=6),{top:i,quickPickTop:t}}constructor(e){super(),this.parent=e,this._onDidChangeZenMode=this._register(new b),this.onDidChangeZenMode=this._onDidChangeZenMode.event,this._onDidChangeMainEditorCenteredLayout=this._register(new b),this.onDidChangeMainEditorCenteredLayout=this._onDidChangeMainEditorCenteredLayout.event,this._onDidChangePanelAlignment=this._register(new b),this.onDidChangePanelAlignment=this._onDidChangePanelAlignment.event,this._onDidChangeWindowMaximized=this._register(new b),this.onDidChangeWindowMaximized=this._onDidChangeWindowMaximized.event,this._onDidChangePanelPosition=this._register(new b),this.onDidChangePanelPosition=this._onDidChangePanelPosition.event,this._onDidChangePartVisibility=this._register(new b),this.onDidChangePartVisibility=this._onDidChangePartVisibility.event,this._onDidChangeNotificationsVisibility=this._register(new b),this.onDidChangeNotificationsVisibility=this._onDidChangeNotificationsVisibility.event,this._onDidLayoutMainContainer=this._register(new b),this.onDidLayoutMainContainer=this._onDidLayoutMainContainer.event,this._onDidLayoutActiveContainer=this._register(new b),this.onDidLayoutActiveContainer=this._onDidLayoutActiveContainer.event,this._onDidLayoutContainer=this._register(new b),this.onDidLayoutContainer=this._onDidLayoutContainer.event,this._onDidAddContainer=this._register(new b),this.onDidAddContainer=this._onDidAddContainer.event,this._onDidChangeActiveContainer=this._register(new b),this.onDidChangeActiveContainer=this._onDidChangeActiveContainer.event,this.mainContainer=document.createElement("div"),this.containerStylesLoaded=new Map,this.parts=new Map,this.initialized=!1,this.disposed=!1,this._openedDefaultEditors=!1,this.whenReadyPromise=new jt,this.whenReady=this.whenReadyPromise.p,this.whenRestoredPromise=new jt,this.whenRestored=this.whenRestoredPromise.p,this.restored=!1}initLayout(e){this.environmentService=e.get(Ri),this.configurationService=e.get(Fe),this.hostService=e.get(ri),this.contextService=e.get(In),this.storageService=e.get(Ce),this.workingCopyBackupService=e.get(Tn),this.themeService=e.get(Ae),this.extensionService=e.get(bn),this.logService=e.get(Ps),this.telemetryService=e.get(bs),this.auxiliaryWindowService=e.get(En),this.editorService=e.get(yi),this.mainPartEditorService=this.editorService.createScoped("main",this._store),this.editorGroupService=e.get(Se),this.paneCompositeService=e.get(wn),this.viewDescriptorService=e.get(_n),this.titleService=e.get(Yt),this.notificationService=e.get(me),this.statusBarService=e.get(Rs),e.get(Ke),this.registerLayoutListeners(),this.initLayoutState(e.get(xi),e.get(vn))}registerLayoutListeners(){const e=()=>{this.isVisible(h.EDITOR_PART,C)||this.toggleMaximizedPanel()};this.editorGroupService.whenRestored.then(()=>{this._register(this.mainPartEditorService.onDidVisibleEditorsChange(e)),this._register(this.editorGroupService.mainPart.onDidActivateGroup(e)),this._register(this.mainPartEditorService.onDidActiveEditorChange(()=>this.centerMainEditorLayout(this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED))))}),this._register(this.configurationService.onDidChangeConfiguration(t=>{if([...Ma,Y.SIDEBAR_POSITION,Y.STATUSBAR_VISIBLE].some(s=>t.affectsConfiguration(s))){const s=t.affectsConfiguration("workbench.experimental.share.enabled")&&this.configurationService.getValue("workbench.experimental.share.enabled"),n=t.affectsConfiguration("workbench.navigationControl.enabled")&&this.configurationService.getValue("workbench.navigationControl.enabled");if((s||n)&&this.configurationService.getValue(D.COMMAND_CENTER)===!1){this.configurationService.updateValue(D.COMMAND_CENTER,!0);return}const o=t.affectsConfiguration(D.EDITOR_ACTIONS_LOCATION)&&this.configurationService.getValue(D.EDITOR_ACTIONS_LOCATION)===mt.TITLEBAR,a=t.affectsConfiguration(D.COMMAND_CENTER)&&this.configurationService.getValue(D.COMMAND_CENTER),r=t.affectsConfiguration(D.LAYOUT_ACTIONS)&&this.configurationService.getValue(D.LAYOUT_ACTIONS);if((t.affectsConfiguration(D.ACTIVITY_BAR_LOCATION)&&[ni.TOP,ni.BOTTOM].includes(this.configurationService.getValue(D.ACTIVITY_BAR_LOCATION))||o||a||r)&&this.configurationService.getValue(ki.CUSTOM_TITLE_BAR_VISIBILITY)===Jt.NEVER){this.configurationService.updateValue(ki.CUSTOM_TITLE_BAR_VISIBILITY,Jt.AUTO);return}this.doUpdateLayoutConfiguration()}})),this._register(Dn(t=>this.onFullscreenChanged(t))),this._register(this.editorGroupService.mainPart.onDidAddGroup(()=>this.centerMainEditorLayout(this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED)))),this._register(this.editorGroupService.mainPart.onDidRemoveGroup(()=>this.centerMainEditorLayout(this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED)))),this._register(this.editorGroupService.mainPart.onDidChangeGroupMaximized(()=>this.centerMainEditorLayout(this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED)))),this._register(re(this.mainContainer,ce.SCROLL,()=>this.mainContainer.scrollTop=0)),(ii||Ei||j)&&!ve(this.configurationService)&&this._register(this.titleService.onMenubarVisibilityChange(t=>this.onMenubarToggled(t))),this._register(this.themeService.onDidColorThemeChange(()=>this.updateWindowsBorder())),this._register(this.hostService.onDidChangeFocus(t=>this.onWindowFocusChanged(t))),this._register(this.hostService.onDidChangeActiveWindow(()=>this.onActiveWindowChanged())),j&&typeof navigator.windowControlsOverlay=="object"&&this._register(re(navigator.windowControlsOverlay,"geometrychange",()=>this.onDidChangeWCO())),this._register(this.auxiliaryWindowService.onDidOpenAuxiliaryWindow(({window:t,disposables:s})=>{const n=t.window.vscodeWindowId;this.containerStylesLoaded.set(n,t.whenStylesHaveLoaded),t.whenStylesHaveLoaded.then(()=>this.containerStylesLoaded.delete(n)),s.add(Ii(()=>this.containerStylesLoaded.delete(n)));const o=s.add(new X);this._onDidAddContainer.fire({container:t.container,disposables:o}),s.add(t.onDidLayout(a=>this.handleContainerDidLayout(t.container,a)))}))}onMenubarToggled(e){if(e!==this.state.runtime.menuBar.toggled){this.state.runtime.menuBar.toggled=e;const i=pt(this.configurationService);j&&i==="toggle"?this.workbenchGrid.setViewVisible(this.titleBarPartView,Ie(this.configurationService,C,this.state.runtime.menuBar.toggled)):this.state.runtime.mainWindowFullscreen&&(i==="toggle"||i==="classic")&&this.workbenchGrid.setViewVisible(this.titleBarPartView,Ie(this.configurationService,C,this.state.runtime.menuBar.toggled)),this.handleContainerDidLayout(this.mainContainer,this._mainContainerDimension)}}handleContainerDidLayout(e,i){e===this.mainContainer&&this._onDidLayoutMainContainer.fire(i),Ns(e)&&this._onDidLayoutActiveContainer.fire(i),this._onDidLayoutContainer.fire({container:e,dimension:i})}onFullscreenChanged(e){e===C.vscodeWindowId&&(this.state.runtime.mainWindowFullscreen=Qt(C),this.state.runtime.mainWindowFullscreen?this.mainContainer.classList.add(y.FULLSCREEN):(this.mainContainer.classList.remove(y.FULLSCREEN),this.stateModel.getRuntimeValue(d.ZEN_MODE_EXIT_INFO).transitionedToFullScreen&&this.isZenModeActive()&&this.toggleZenMode()),this.workbenchGrid.edgeSnapping=this.state.runtime.mainWindowFullscreen,this.workbenchGrid.setViewVisible(this.titleBarPartView,Ie(this.configurationService,C,this.state.runtime.menuBar.toggled)),this.updateWindowsBorder(!0))}onActiveWindowChanged(){const e=this.getActiveContainerId();this.state.runtime.activeContainerId!==e&&(this.state.runtime.activeContainerId=e,this.updateWindowsBorder(),this._onDidChangeActiveContainer.fire())}onWindowFocusChanged(e){this.state.runtime.hasFocus!==e&&(this.state.runtime.hasFocus=e,this.updateWindowsBorder())}getActiveContainerId(){const e=this.activeContainer;return G(e).vscodeWindowId}doUpdateLayoutConfiguration(e){this.updateCustomTitleBarVisibility(),this.updateMenubarVisibility(!!e),this.editorGroupService.whenRestored.then(()=>this.centerMainEditorLayout(this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED),e))}setSideBarPosition(e){const i=this.getPart(h.ACTIVITYBAR_PART),t=this.getPart(h.SIDEBAR_PART),s=this.getPart(h.AUXILIARYBAR_PART),n=e===E.LEFT?"left":"right",o=e===E.RIGHT?"left":"right",a=this.getPanelAlignment(),r=this.getPanelPosition();this.stateModel.setRuntimeValue(d.SIDEBAR_POSITON,e);const c=_e(i.getContainer()),l=_e(t.getContainer()),g=_e(s.getContainer());c.classList.remove(o),l.classList.remove(o),c.classList.add(n),l.classList.add(n),g.classList.remove(n),g.classList.add(o),i.updateStyles(),t.updateStyles(),s.updateStyles(),this.adjustPartPositions(e,a,r)}updateWindowsBorder(e=!1){if(j||ii||(ii||Ei)&&Rn(this.configurationService)||ve(this.configurationService))return;const i=this.themeService.getColorTheme(),t=i.getColor(yn),s=i.getColor(Pn),n=this.hasMainWindowBorder();for(const o of this.containers){const a=o===this.mainContainer,r=this.activeContainer===o;let c=!1;if(!this.state.runtime.mainWindowFullscreen&&(t||s)){c=!0;const l=r&&this.state.runtime.hasFocus?t:s??t;o.style.setProperty("--window-border-color",(l==null?void 0:l.toString())??"transparent")}a&&(this.state.runtime.mainWindowBorder=c),o.classList.toggle(y.WINDOW_BORDER,c)}!e&&n!==this.hasMainWindowBorder()&&this.layout()}initLayoutState(e,i){var o,a,r,c;this._mainContainerDimension=nt(this.parent,ps),this.stateModel=new Pt(this.storageService,this.configurationService,this.contextService),this.stateModel.load(this._mainContainerDimension),this.stateModel.getRuntimeValue(d.PANEL_HIDDEN)&&this.stateModel.getRuntimeValue(d.EDITOR_HIDDEN)&&this.stateModel.setRuntimeValue(d.EDITOR_HIDDEN,!1),this._register(this.stateModel.onDidChangeState(l=>{l.key===d.ACTIVITYBAR_HIDDEN&&this.setActivityBarHidden(l.value),l.key===d.STATUSBAR_HIDDEN&&this.setStatusBarHidden(l.value),l.key===d.SIDEBAR_POSITON&&this.setSideBarPosition(l.value),l.key===d.PANEL_POSITION&&this.setPanelPosition(l.value),l.key===d.PANEL_ALIGNMENT&&this.setPanelAlignment(l.value),this.doUpdateLayoutConfiguration()}));const t=this.getInitialEditorsState();t&&this.logService.trace("Initial editor state",t);const s={layout:{editors:t==null?void 0:t.layout},editor:{restoreEditors:this.shouldRestoreEditors(this.contextService,t),editorsToOpen:this.resolveEditorsToOpen(i,t)},views:{defaults:this.getDefaultLayoutViews(this.environmentService,this.storageService),containerToRestore:{}}},n={activeContainerId:this.getActiveContainerId(),mainWindowFullscreen:Qt(C),hasFocus:this.hostService.hasFocus,maximized:new Set,mainWindowBorder:!1,menuBar:{toggled:!1},zenMode:{transitionDisposables:new Nn}};if(this.state={initialization:s,runtime:n},this.isVisible(h.SIDEBAR_PART)){let l;!this.environmentService.isBuilt||e.startupKind===Vn.ReloadedWindow||this.environmentService.isExtensionDevelopment&&!this.environmentService.extensionTestsLocationURI?l=this.storageService.get(Bn.activeViewletSettingsKey,T.WORKSPACE,(o=this.viewDescriptorService.getDefaultViewContainer(S.Sidebar))==null?void 0:o.id):l=(a=this.viewDescriptorService.getDefaultViewContainer(S.Sidebar))==null?void 0:a.id,l?this.state.initialization.views.containerToRestore.sideBar=l:this.stateModel.setRuntimeValue(d.SIDEBAR_HIDDEN,!0)}if(this.isVisible(h.PANEL_PART)){const l=this.storageService.get(Ln.activePanelSettingsKey,T.WORKSPACE,(r=this.viewDescriptorService.getDefaultViewContainer(S.Panel))==null?void 0:r.id);l?this.state.initialization.views.containerToRestore.panel=l:this.stateModel.setRuntimeValue(d.PANEL_HIDDEN,!0)}if(this.isVisible(h.AUXILIARYBAR_PART)){const l=this.storageService.get(Mn.activeViewSettingsKey,T.WORKSPACE,(c=this.viewDescriptorService.getDefaultViewContainer(S.AuxiliaryBar))==null?void 0:c.id);l?this.state.initialization.views.containerToRestore.auxiliaryBar=l:this.stateModel.setRuntimeValue(d.AUXILIARYBAR_HIDDEN,!0)}this.updateWindowsBorder(!0)}getDefaultLayoutViews(e,i){var n;const t=(n=e.options)==null?void 0:n.defaultLayout;if(!t||!t.force&&!i.isNew(T.WORKSPACE))return;const{views:s}=t;if(s!=null&&s.length)return s.map(o=>o.id)}shouldRestoreEditors(e,i){return On(e.getWorkspace())?!1:!!(this.configurationService.getValue("window.restoreWindows")==="preserve")||i===void 0}willRestoreEditors(){return this.state.initialization.editor.restoreEditors}async resolveEditorsToOpen(e,i){var t;if(i){const s=li(await ot(i.filesToMerge,e,this.logService));if(s.length===4&&Pi(s[0])&&Pi(s[1])&&Pi(s[2])&&Pi(s[3]))return[{editor:{input1:{resource:s[0].resource},input2:{resource:s[1].resource},base:{resource:s[2].resource},result:{resource:s[3].resource},options:{pinned:!0}}}];const n=li(await ot(i.filesToDiff,e,this.logService));if(n.length===2)return[{editor:{original:{resource:n[0].resource},modified:{resource:n[1].resource},options:{pinned:!0}}}];const o=[],a=await ot(i.filesToOpenOrCreate,e,this.logService);for(let r=0;r<a.length;r++){const c=a[r];c&&o.push({editor:c,viewColumn:(t=i.filesToOpenOrCreate)==null?void 0:t[r].viewColumn})}return o}else if(this.contextService.getWorkbenchState()===Vs.EMPTY&&this.configurationService.getValue("workbench.startupEditor")==="newUntitledFile")return this.editorGroupService.hasRestorableState?[]:await this.workingCopyBackupService.hasBackups()?[]:[{editor:{resource:void 0}}];return[]}get openedDefaultEditors(){return this._openedDefaultEditors}getInitialEditorsState(){var n,o,a,r,c;const e=(n=this.environmentService.options)==null?void 0:n.defaultLayout;if(((o=e==null?void 0:e.editors)!=null&&o.length||(a=e==null?void 0:e.layout)!=null&&a.editors)&&(e.force||this.storageService.isNew(T.WORKSPACE)))return this._openedDefaultEditors=!0,{layout:(r=e.layout)==null?void 0:r.editors,filesToOpenOrCreate:(c=e==null?void 0:e.editors)==null?void 0:c.map(l=>({viewColumn:l.viewColumn,fileUri:et.revive(l.uri),openOnlyIfExists:l.openOnlyIfExists,options:l.options}))};const{filesToOpenOrCreate:i,filesToDiff:t,filesToMerge:s}=this.environmentService;if(i||t||s)return{filesToOpenOrCreate:i,filesToDiff:t,filesToMerge:s}}isRestored(){return this.restored}restoreParts(){const e=[],i=[];e.push((async()=>{var r;V("code/willRestoreEditors"),await this.editorGroupService.whenReady,V("code/restoreEditors/editorGroupsReady"),(r=this.state.initialization.layout)!=null&&r.editors&&this.editorGroupService.mainPart.applyLayout(this.state.initialization.layout.editors);const o=await this.state.initialization.editor.editorsToOpen;V("code/restoreEditors/editorsToOpenResolved");let a;if(o.length){const c=this.editorGroupService.mainPart.getGroups(xn.GRID_APPEARANCE),l=new Map;for(const g of o){const A=c[(g.viewColumn??1)-1];let p=l.get(A.id);p||(p=new Set,l.set(A.id,p)),p.add(g.editor)}a=Promise.all(Array.from(l).map(async([g,A])=>{try{await this.editorService.openEditors(Array.from(A),g,{validateTrust:!0})}catch(p){this.logService.error(p)}}))}i.push(Promise.all([a==null?void 0:a.finally(()=>V("code/restoreEditors/editorsOpened")),this.editorGroupService.whenRestored.finally(()=>V("code/restoreEditors/editorGroupsRestored"))]).finally(()=>{V("code/didRestoreEditors")}))})());const t=(async()=>{var o;if((o=this.state.initialization.views.defaults)!=null&&o.length){V("code/willOpenDefaultViews");const a=[],r=g=>{var p;const A=this.viewDescriptorService.getViewLocationById(g.id);if(A!==null){const R=this.viewDescriptorService.getViewContainerByViewId(g.id);if(R){g.order>=(((p=a==null?void 0:a[A])==null?void 0:p.order)??0)&&(a[A]={id:R.id,order:g.order});const N=this.viewDescriptorService.getViewContainerModel(R);return N.setCollapsed(g.id,!1),N.setVisible(g.id,!0),!0}}return!1},c=[...this.state.initialization.views.defaults].reverse().map((g,A)=>({id:g,order:A}));let l=c.length;for(;l;)l--,r(c[l])&&c.splice(l,1);if(c.length){await this.extensionService.whenInstalledExtensionsRegistered();let g=c.length;for(;g;)g--,r(c[g])&&c.splice(g,1)}a[S.Sidebar]&&(this.state.initialization.views.containerToRestore.sideBar=a[S.Sidebar].id),a[S.Panel]&&(this.state.initialization.views.containerToRestore.panel=a[S.Panel].id),a[S.AuxiliaryBar]&&(this.state.initialization.views.containerToRestore.auxiliaryBar=a[S.AuxiliaryBar].id),V("code/didOpenDefaultViews")}})();e.push(t),e.push((async()=>{var a;if(await t,!this.state.initialization.views.containerToRestore.sideBar)return;V("code/willRestoreViewlet"),await this.paneCompositeService.openPaneComposite(this.state.initialization.views.containerToRestore.sideBar,S.Sidebar)||await this.paneCompositeService.openPaneComposite((a=this.viewDescriptorService.getDefaultViewContainer(S.Sidebar))==null?void 0:a.id,S.Sidebar),V("code/didRestoreViewlet")})()),e.push((async()=>{var a;if(await t,!this.state.initialization.views.containerToRestore.panel)return;V("code/willRestorePanel"),await this.paneCompositeService.openPaneComposite(this.state.initialization.views.containerToRestore.panel,S.Panel)||await this.paneCompositeService.openPaneComposite((a=this.viewDescriptorService.getDefaultViewContainer(S.Panel))==null?void 0:a.id,S.Panel),V("code/didRestorePanel")})()),e.push((async()=>{var a;if(await t,!this.state.initialization.views.containerToRestore.auxiliaryBar)return;V("code/willRestoreAuxiliaryBar"),await this.paneCompositeService.openPaneComposite(this.state.initialization.views.containerToRestore.auxiliaryBar,S.AuxiliaryBar)||await this.paneCompositeService.openPaneComposite((a=this.viewDescriptorService.getDefaultViewContainer(S.AuxiliaryBar))==null?void 0:a.id,S.AuxiliaryBar),V("code/didRestoreAuxiliaryBar")})());const s=this.isZenModeActive(),n=As(this.configurationService).restore;s&&(this.setZenModeActive(!n),this.toggleZenMode(!1,!0)),this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED)&&this.centerMainEditorLayout(!0,!0),es.settled(e).finally(()=>{this.whenReadyPromise.complete(),es.settled(i).finally(()=>{this.restored=!0,this.whenRestoredPromise.complete()})})}registerPart(e){const i=e.getId();return this.parts.set(i,e),Ii(()=>this.parts.delete(i))}getPart(e){const i=this.parts.get(e);if(!i)throw new Error(`Unknown part ${e}`);return i}registerNotifications(e){this._register(e.onDidChangeNotificationsVisibility(i=>this._onDidChangeNotificationsVisibility.fire(i)))}hasFocus(e){const i=this.getContainer(at(),e);if(!i)return!1;const t=kn();return t?Hn(t,i):!1}_getFocusedPart(){for(const e of this.parts.keys())if(this.hasFocus(e))return e}focusPart(e,i=C){var s,n,o;const t=this.getContainer(i,e)??this.mainContainer;switch(e){case h.EDITOR_PART:this.editorGroupService.getPart(t).activeGroup.focus();break;case h.PANEL_PART:{(s=this.paneCompositeService.getActivePaneComposite(S.Panel))==null||s.focus();break}case h.SIDEBAR_PART:{(n=this.paneCompositeService.getActivePaneComposite(S.Sidebar))==null||n.focus();break}case h.AUXILIARYBAR_PART:{(o=this.paneCompositeService.getActivePaneComposite(S.AuxiliaryBar))==null||o.focus();break}case h.ACTIVITYBAR_PART:this.getPart(h.SIDEBAR_PART).focusActivityBar();break;case h.STATUSBAR_PART:this.statusBarService.getPart(t).focus();break;default:t==null||t.focus()}}getContainer(e,i){if(typeof i>"u")return this.getContainerFromDocument(e.document);if(e===C)return this.getPart(i).getContainer();let t;if(i===h.EDITOR_PART?t=this.editorGroupService.getPart(this.getContainerFromDocument(e.document)):i===h.STATUSBAR_PART?t=this.statusBarService.getPart(this.getContainerFromDocument(e.document)):i===h.TITLEBAR_PART&&(t=this.titleService.getPart(this.getContainerFromDocument(e.document))),t instanceof Xt)return t.getContainer()}isVisible(e,i=C){if(i!==C&&e===h.EDITOR_PART)return!0;if(this.initialized)switch(e){case h.TITLEBAR_PART:return this.workbenchGrid.isViewVisible(this.titleBarPartView);case h.SIDEBAR_PART:return!this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN);case h.PANEL_PART:return!this.stateModel.getRuntimeValue(d.PANEL_HIDDEN);case h.AUXILIARYBAR_PART:return!this.stateModel.getRuntimeValue(d.AUXILIARYBAR_HIDDEN);case h.STATUSBAR_PART:return!this.stateModel.getRuntimeValue(d.STATUSBAR_HIDDEN);case h.ACTIVITYBAR_PART:return!this.stateModel.getRuntimeValue(d.ACTIVITYBAR_HIDDEN);case h.EDITOR_PART:return!this.stateModel.getRuntimeValue(d.EDITOR_HIDDEN);case h.BANNER_PART:return this.workbenchGrid.isViewVisible(this.bannerPartView);default:return!1}switch(e){case h.TITLEBAR_PART:return Ie(this.configurationService,C,this.state.runtime.menuBar.toggled);case h.SIDEBAR_PART:return!this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN);case h.PANEL_PART:return!this.stateModel.getRuntimeValue(d.PANEL_HIDDEN);case h.AUXILIARYBAR_PART:return!this.stateModel.getRuntimeValue(d.AUXILIARYBAR_HIDDEN);case h.STATUSBAR_PART:return!this.stateModel.getRuntimeValue(d.STATUSBAR_HIDDEN);case h.ACTIVITYBAR_PART:return!this.stateModel.getRuntimeValue(d.ACTIVITYBAR_HIDDEN);case h.EDITOR_PART:return!this.stateModel.getRuntimeValue(d.EDITOR_HIDDEN);default:return!1}}shouldShowBannerFirst(){return j&&!At()}focus(){this.isPanelMaximized()&&this.mainContainer===this.activeContainer?this.focusPart(h.PANEL_PART):this.focusPart(h.EDITOR_PART,G(this.activeContainer))}focusPanelOrEditor(){const e=this.paneCompositeService.getActivePaneComposite(S.Panel);(this.hasFocus(h.PANEL_PART)||!this.isVisible(h.EDITOR_PART))&&e?e.focus():this.focus()}getMaximumEditorDimensions(e){const i=G(e),t=this.getContainerDimension(e);if(e===this.mainContainer){const s=L(this.getPanelPosition()),n=(this.isVisible(h.ACTIVITYBAR_PART)?this.activityBarPartView.minimumWidth:0)+(this.isVisible(h.SIDEBAR_PART)?this.sideBarPartView.minimumWidth:0)+(this.isVisible(h.PANEL_PART)&&!s?this.panelPartView.minimumWidth:0)+(this.isVisible(h.AUXILIARYBAR_PART)?this.auxiliaryBarPartView.minimumWidth:0),o=(this.isVisible(h.TITLEBAR_PART,i)?this.titleBarPartView.minimumHeight:0)+(this.isVisible(h.STATUSBAR_PART,i)?this.statusBarPartView.minimumHeight:0)+(this.isVisible(h.PANEL_PART)&&s?this.panelPartView.minimumHeight:0),a=t.width-n,r=t.height-o;return{width:a,height:r}}else{const s=(this.isVisible(h.TITLEBAR_PART,i)?this.titleBarPartView.minimumHeight:0)+(this.isVisible(h.STATUSBAR_PART,i)?this.statusBarPartView.minimumHeight:0);return{width:t.width,height:t.height-s}}}isZenModeActive(){return this.stateModel.getRuntimeValue(d.ZEN_MODE_ACTIVE)}setZenModeActive(e){this.stateModel.setRuntimeValue(d.ZEN_MODE_ACTIVE,e)}toggleZenMode(e,i=!1){const t=this._getFocusedPart();this.setZenModeActive(!this.isZenModeActive()),this.state.runtime.zenMode.transitionDisposables.clearAndDisposeAll();const s=r=>{for(const c of this.mainPartEditorService.visibleTextEditorControls){if(!r&&$n(c)&&c.hasModel()){const l=c.getModel();r=this.configurationService.getValue("editor.lineNumbers",{resource:l.uri,overrideIdentifier:l.getLanguageId()})}r||(r=this.configurationService.getValue("editor.lineNumbers")),c.updateOptions({lineNumbers:r})}};let n=!1;const o=As(this.configurationService),a=this.stateModel.getRuntimeValue(d.ZEN_MODE_EXIT_INFO);this.isZenModeActive()?(n=!this.state.runtime.mainWindowFullscreen&&o.fullScreen&&!is,i||(a.transitionedToFullScreen=n,a.transitionedToCenteredEditorLayout=!this.isMainEditorLayoutCentered()&&o.centerLayout,a.handleNotificationsDoNotDisturbMode=this.notificationService.getFilter()===w.OFF,a.wasVisible.sideBar=this.isVisible(h.SIDEBAR_PART),a.wasVisible.panel=this.isVisible(h.PANEL_PART),a.wasVisible.auxiliaryBar=this.isVisible(h.AUXILIARYBAR_PART),this.stateModel.setRuntimeValue(d.ZEN_MODE_EXIT_INFO,a)),this.setPanelHidden(!0,!0),this.setAuxiliaryBarHidden(!0,!0),this.setSideBarHidden(!0,!0),o.hideActivityBar&&this.setActivityBarHidden(!0,!0),o.hideStatusBar&&this.setStatusBarHidden(!0,!0),o.hideLineNumbers&&(s("off"),this.state.runtime.zenMode.transitionDisposables.set(x.HIDE_LINENUMBERS,this.mainPartEditorService.onDidVisibleEditorsChange(()=>s("off")))),o.showTabs!==this.editorGroupService.partOptions.showTabs&&this.state.runtime.zenMode.transitionDisposables.set(x.SHOW_TABS,this.editorGroupService.mainPart.enforcePartOptions({showTabs:o.showTabs})),o.silentNotifications&&a.handleNotificationsDoNotDisturbMode&&this.notificationService.setFilter(w.ERROR),o.centerLayout&&this.centerMainEditorLayout(!0,!0),this.state.runtime.zenMode.transitionDisposables.set("configurationChange",this.configurationService.onDidChangeConfiguration(r=>{if(r.affectsConfiguration(x.HIDE_ACTIVITYBAR)){const c=this.configurationService.getValue(x.HIDE_ACTIVITYBAR);this.setActivityBarHidden(c,!0)}if(r.affectsConfiguration(x.HIDE_STATUSBAR)){const c=this.configurationService.getValue(x.HIDE_STATUSBAR);this.setStatusBarHidden(c,!0)}if(r.affectsConfiguration(x.CENTER_LAYOUT)){const c=this.configurationService.getValue(x.CENTER_LAYOUT);this.centerMainEditorLayout(c,!0)}if(r.affectsConfiguration(x.SHOW_TABS)){const c=this.configurationService.getValue(x.SHOW_TABS)??"multiple";this.state.runtime.zenMode.transitionDisposables.set(x.SHOW_TABS,this.editorGroupService.mainPart.enforcePartOptions({showTabs:c}))}if(r.affectsConfiguration(x.SILENT_NOTIFICATIONS)){const c=!!this.configurationService.getValue(x.SILENT_NOTIFICATIONS);a.handleNotificationsDoNotDisturbMode&&this.notificationService.setFilter(c?w.ERROR:w.OFF)}if(r.affectsConfiguration(x.HIDE_LINENUMBERS)){const c=this.configurationService.getValue(x.HIDE_LINENUMBERS)?"off":void 0;s(c),this.state.runtime.zenMode.transitionDisposables.set(x.HIDE_LINENUMBERS,this.mainPartEditorService.onDidVisibleEditorsChange(()=>s(c)))}}))):(a.wasVisible.panel&&this.setPanelHidden(!1,!0),a.wasVisible.auxiliaryBar&&this.setAuxiliaryBarHidden(!1,!0),a.wasVisible.sideBar&&this.setSideBarHidden(!1,!0),this.stateModel.getRuntimeValue(d.ACTIVITYBAR_HIDDEN,!0)||this.setActivityBarHidden(!1,!0),this.stateModel.getRuntimeValue(d.STATUSBAR_HIDDEN,!0)||this.setStatusBarHidden(!1,!0),a.transitionedToCenteredEditorLayout&&this.centerMainEditorLayout(!1,!0),a.handleNotificationsDoNotDisturbMode&&this.notificationService.setFilter(w.OFF),s(),n=a.transitionedToFullScreen&&this.state.runtime.mainWindowFullscreen),e||this.layout(),n&&this.hostService.toggleFullScreen(C),t&&this.isVisible(t,G(this.activeContainer))?Fn(t)?this.focusPart(t,G(this.activeContainer)):this.focusPart(t):this.focus(),this._onDidChangeZenMode.fire(this.isZenModeActive())}setStatusBarHidden(e,i){this.stateModel.setRuntimeValue(d.STATUSBAR_HIDDEN,e),e?this.mainContainer.classList.add(y.STATUSBAR_HIDDEN):this.mainContainer.classList.remove(y.STATUSBAR_HIDDEN),this.workbenchGrid.setViewVisible(this.statusBarPartView,!e)}createWorkbenchLayout(){const e=this.getPart(h.TITLEBAR_PART),i=this.getPart(h.BANNER_PART),t=this.getPart(h.EDITOR_PART),s=this.getPart(h.ACTIVITYBAR_PART),n=this.getPart(h.PANEL_PART),o=this.getPart(h.AUXILIARYBAR_PART),a=this.getPart(h.SIDEBAR_PART),r=this.getPart(h.STATUSBAR_PART);this.titleBarPartView=e,this.bannerPartView=i,this.sideBarPartView=a,this.activityBarPartView=s,this.editorPartView=t,this.panelPartView=n,this.auxiliaryBarPartView=o,this.statusBarPartView=r;const c={[h.ACTIVITYBAR_PART]:this.activityBarPartView,[h.BANNER_PART]:this.bannerPartView,[h.TITLEBAR_PART]:this.titleBarPartView,[h.EDITOR_PART]:this.editorPartView,[h.PANEL_PART]:this.panelPartView,[h.SIDEBAR_PART]:this.sideBarPartView,[h.STATUSBAR_PART]:this.statusBarPartView,[h.AUXILIARYBAR_PART]:this.auxiliaryBarPartView},l=({type:A})=>c[A],g=Gn.deserialize(this.createGridDescriptor(),{fromJSON:l},{proportionalLayout:!1});this.mainContainer.prepend(g.element),this.mainContainer.setAttribute("role","application"),this.workbenchGrid=g,this.workbenchGrid.edgeSnapping=this.state.runtime.mainWindowFullscreen;for(const A of[e,t,s,n,a,r,o,i])this._register(A.onDidVisibilityChange(p=>{A===a?this.setSideBarHidden(!p,!0):A===n?this.setPanelHidden(!p,!0):A===o?this.setAuxiliaryBarHidden(!p,!0):A===t&&this.setEditorHidden(!p,!0),this._onDidChangePartVisibility.fire(),this.handleContainerDidLayout(this.mainContainer,this._mainContainerDimension)}));this._register(this.storageService.onWillSaveState(A=>{const p=this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN)?this.workbenchGrid.getViewCachedVisibleSize(this.sideBarPartView):this.workbenchGrid.getViewSize(this.sideBarPartView).width;this.stateModel.setInitializationValue(d.SIDEBAR_SIZE,p);const R=this.stateModel.getRuntimeValue(d.PANEL_HIDDEN)?this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView):L(this.stateModel.getRuntimeValue(d.PANEL_POSITION))?this.workbenchGrid.getViewSize(this.panelPartView).height:this.workbenchGrid.getViewSize(this.panelPartView).width;this.stateModel.setInitializationValue(d.PANEL_SIZE,R);const N=this.stateModel.getRuntimeValue(d.AUXILIARYBAR_HIDDEN)?this.workbenchGrid.getViewCachedVisibleSize(this.auxiliaryBarPartView):this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;this.stateModel.setInitializationValue(d.AUXILIARYBAR_SIZE,N),this.stateModel.save(!0,!0)}))}layout(){this.disposed||(this._mainContainerDimension=nt(this.state.runtime.mainWindowFullscreen?C.document.body:this.parent,ps),this.logService.trace(`Layout#layout, height: ${this._mainContainerDimension.height}, width: ${this._mainContainerDimension.width}`),Wn(this.mainContainer,0,0,0,0,"relative"),zn(this.mainContainer,this._mainContainerDimension.width,this._mainContainerDimension.height),this.workbenchGrid.layout(this._mainContainerDimension.width,this._mainContainerDimension.height),this.initialized=!0,this.handleContainerDidLayout(this.mainContainer,this._mainContainerDimension))}isMainEditorLayoutCentered(){return this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED)}centerMainEditorLayout(e,i){this.stateModel.setRuntimeValue(d.MAIN_EDITOR_CENTERED,e);const s=li(this.editorGroupService.mainPart.groups.map(r=>r.activeEditor)).some(r=>r instanceof Un?this.configurationService.getValue("diffEditor.renderSideBySide"):!!(r!=null&&r.hasCapability(Kn.MultipleEditors))),n=this.editorGroupService.getLayout();let o=!1;n.orientation===Yn.HORIZONTAL?o=n.groups.length>1:o=n.groups.some(r=>r.groups&&r.groups.length>1),this.configurationService.getValue("workbench.editor.centeredLayoutAutoResize")&&(o&&!this.editorGroupService.mainPart.hasMaximizedGroup()||s)&&(e=!1),this.editorGroupService.mainPart.isLayoutCentered()!==e&&(this.editorGroupService.mainPart.centerLayout(e),i||this.layout()),this._onDidChangeMainEditorCenteredLayout.fire(this.stateModel.getRuntimeValue(d.MAIN_EDITOR_CENTERED))}getSize(e){return this.workbenchGrid.getViewSize(this.getPart(e))}setSize(e,i){this.workbenchGrid.resizeView(this.getPart(e),i)}resizePart(e,i,t){const s=Math.sign(i)*ts(at(),Math.abs(i)),n=Math.sign(t)*ts(at(),Math.abs(t));let o;switch(e){case h.SIDEBAR_PART:o=this.workbenchGrid.getViewSize(this.sideBarPartView),this.workbenchGrid.resizeView(this.sideBarPartView,{width:o.width+s,height:o.height});break;case h.PANEL_PART:o=this.workbenchGrid.getViewSize(this.panelPartView),this.workbenchGrid.resizeView(this.panelPartView,{width:o.width+(L(this.getPanelPosition())?0:s),height:o.height+(L(this.getPanelPosition())?n:0)});break;case h.AUXILIARYBAR_PART:o=this.workbenchGrid.getViewSize(this.auxiliaryBarPartView),this.workbenchGrid.resizeView(this.auxiliaryBarPartView,{width:o.width+s,height:o.height});break;case h.EDITOR_PART:if(o=this.workbenchGrid.getViewSize(this.editorPartView),this.editorGroupService.mainPart.count===1)this.workbenchGrid.resizeView(this.editorPartView,{width:o.width+s,height:o.height+n});else{const a=this.editorGroupService.mainPart.activeGroup,{width:r,height:c}=this.editorGroupService.mainPart.getSize(a);this.editorGroupService.mainPart.setSize(a,{width:r+s,height:c+n});const{width:l,height:g}=this.editorGroupService.mainPart.getSize(a);(n&&c===g||s&&r===l)&&this.workbenchGrid.resizeView(this.editorPartView,{width:o.width+(s&&r===l?s:0),height:o.height+(n&&c===g?n:0)})}break;default:return}}setActivityBarHidden(e,i){this.stateModel.setRuntimeValue(d.ACTIVITYBAR_HIDDEN,e),this.workbenchGrid.setViewVisible(this.activityBarPartView,!e)}setBannerHidden(e){this.workbenchGrid.setViewVisible(this.bannerPartView,!e)}setEditorHidden(e,i){this.stateModel.setRuntimeValue(d.EDITOR_HIDDEN,e),e?this.mainContainer.classList.add(y.MAIN_EDITOR_AREA_HIDDEN):this.mainContainer.classList.remove(y.MAIN_EDITOR_AREA_HIDDEN),this.workbenchGrid.setViewVisible(this.editorPartView,!e),e&&!this.isVisible(h.PANEL_PART)&&this.setPanelHidden(!1,!0)}getLayoutClasses(){return li([this.isVisible(h.SIDEBAR_PART)?void 0:y.SIDEBAR_HIDDEN,this.isVisible(h.EDITOR_PART,C)?void 0:y.MAIN_EDITOR_AREA_HIDDEN,this.isVisible(h.PANEL_PART)?void 0:y.PANEL_HIDDEN,this.isVisible(h.AUXILIARYBAR_PART)?void 0:y.AUXILIARYBAR_HIDDEN,this.isVisible(h.STATUSBAR_PART)?void 0:y.STATUSBAR_HIDDEN,this.state.runtime.mainWindowFullscreen?y.FULLSCREEN:void 0])}setSideBarHidden(e,i){var t;if(this.stateModel.setRuntimeValue(d.SIDEBAR_HIDDEN,e),e?this.mainContainer.classList.add(y.SIDEBAR_HIDDEN):this.mainContainer.classList.remove(y.SIDEBAR_HIDDEN),e&&this.paneCompositeService.getActivePaneComposite(S.Sidebar))this.paneCompositeService.hideActivePaneComposite(S.Sidebar),this.focusPanelOrEditor();else if(!e&&!this.paneCompositeService.getActivePaneComposite(S.Sidebar)){const s=this.paneCompositeService.getLastActivePaneCompositeId(S.Sidebar);s&&(this.paneCompositeService.openPaneComposite(s,S.Sidebar,!0)||this.paneCompositeService.openPaneComposite((t=this.viewDescriptorService.getDefaultViewContainer(S.Sidebar))==null?void 0:t.id,S.Sidebar,!0))}this.workbenchGrid.setViewVisible(this.sideBarPartView,!e)}hasViews(e){const i=this.viewDescriptorService.getViewContainerById(e);if(!i)return!1;const t=this.viewDescriptorService.getViewContainerModel(i);return t?t.activeViewDescriptors.length>=1:!1}adjustPartPositions(e,i,t){const s=!L(t),n=s||!(i==="center"||e===E.LEFT&&i==="right"||e===E.RIGHT&&i==="left"),o=s||!(i==="center"||e===E.RIGHT&&i==="right"||e===E.LEFT&&i==="left"),a=this.isVisible(h.PANEL_PART)?this.workbenchGrid.getViewSize(this.panelPartView).width:hi.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView)??this.panelPartView.minimumWidth),r=this.isVisible(h.PANEL_PART)?this.workbenchGrid.getViewSize(this.panelPartView).height:hi.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView)??this.panelPartView.minimumHeight),c=this.isVisible(h.SIDEBAR_PART)?this.workbenchGrid.getViewSize(this.sideBarPartView).width:hi.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.sideBarPartView)??this.sideBarPartView.minimumWidth),l=this.isVisible(h.AUXILIARYBAR_PART)?this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width:hi.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.auxiliaryBarPartView)??this.auxiliaryBarPartView.minimumWidth),g=[h.PANEL_PART,h.SIDEBAR_PART,h.AUXILIARYBAR_PART].find(A=>this.hasFocus(A));e===E.LEFT?(this.workbenchGrid.moveViewTo(this.activityBarPartView,[2,0]),this.workbenchGrid.moveView(this.sideBarPartView,c,n?this.editorPartView:this.activityBarPartView,n?F.Left:F.Right),o?this.workbenchGrid.moveView(this.auxiliaryBarPartView,l,this.editorPartView,F.Right):this.workbenchGrid.moveViewTo(this.auxiliaryBarPartView,[2,-1])):(this.workbenchGrid.moveViewTo(this.activityBarPartView,[2,-1]),this.workbenchGrid.moveView(this.sideBarPartView,c,n?this.editorPartView:this.activityBarPartView,n?F.Right:F.Left),o?this.workbenchGrid.moveView(this.auxiliaryBarPartView,l,this.editorPartView,F.Left):this.workbenchGrid.moveViewTo(this.auxiliaryBarPartView,[2,0])),g&&this.focusPart(g),s&&(this.workbenchGrid.moveView(this.panelPartView,a,this.editorPartView,t===E.LEFT?F.Left:F.Right),this.workbenchGrid.resizeView(this.panelPartView,{height:r,width:a})),this.isVisible(h.SIDEBAR_PART)&&this.workbenchGrid.resizeView(this.sideBarPartView,{height:this.workbenchGrid.getViewSize(this.sideBarPartView).height,width:c}),this.isVisible(h.AUXILIARYBAR_PART)&&this.workbenchGrid.resizeView(this.auxiliaryBarPartView,{height:this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).height,width:l})}setPanelAlignment(e,i){L(this.getPanelPosition())||this.setPanelPosition(E.BOTTOM),e!=="center"&&this.isPanelMaximized()&&this.toggleMaximizedPanel(),this.stateModel.setRuntimeValue(d.PANEL_ALIGNMENT,e),this.adjustPartPositions(this.getSideBarPosition(),e,this.getPanelPosition()),this._onDidChangePanelAlignment.fire(e)}setPanelHidden(e,i){var a,r;if(!this.workbenchGrid)return;const t=!this.isVisible(h.PANEL_PART);this.stateModel.setRuntimeValue(d.PANEL_HIDDEN,e);const s=this.isPanelMaximized(),n=this.panelOpensMaximized();e?this.mainContainer.classList.add(y.PANEL_HIDDEN):this.mainContainer.classList.remove(y.PANEL_HIDDEN);let o=!1;if(e&&this.paneCompositeService.getActivePaneComposite(S.Panel))this.paneCompositeService.hideActivePaneComposite(S.Panel),o=!is;else if(!e&&!this.paneCompositeService.getActivePaneComposite(S.Panel)){let c=this.paneCompositeService.getLastActivePaneCompositeId(S.Panel);if((!c||!this.hasViews(c))&&(c=(a=this.viewDescriptorService.getViewContainersByLocation(S.Panel).find(l=>this.hasViews(l.id)))==null?void 0:a.id),c){const l=!i;this.paneCompositeService.openPaneComposite(c,S.Panel,l)||this.paneCompositeService.openPaneComposite((r=this.viewDescriptorService.getDefaultViewContainer(S.Panel))==null?void 0:r.id,S.Panel,l)}}e&&s&&this.toggleMaximizedPanel(),t!==e&&(this.workbenchGrid.setViewVisible(this.panelPartView,!e),e?this.stateModel.setRuntimeValue(d.PANEL_WAS_LAST_MAXIMIZED,s):!i&&s!==n&&this.toggleMaximizedPanel(),o&&this.editorGroupService.mainPart.activeGroup.focus())}toggleMaximizedPanel(){const e=this.workbenchGrid.getViewSize(this.panelPartView),i=this.getPanelPosition(),t=this.isPanelMaximized();t?(this.setEditorHidden(!1),this.workbenchGrid.resizeView(this.panelPartView,{width:L(i)?e.width:this.stateModel.getRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_WIDTH),height:L(i)?this.stateModel.getRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_HEIGHT):e.height})):(this.isVisible(h.PANEL_PART)&&(L(i)?this.stateModel.setRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_HEIGHT,e.height):this.stateModel.setRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_WIDTH,e.width)),this.setEditorHidden(!0)),this.stateModel.setRuntimeValue(d.PANEL_WAS_LAST_MAXIMIZED,!t)}panelOpensMaximized(){if(this.getPanelAlignment()!=="center"&&L(this.getPanelPosition()))return!1;const e=Xn(this.configurationService.getValue(Di.PANEL_OPENS_MAXIMIZED)),i=this.stateModel.getRuntimeValue(d.PANEL_WAS_LAST_MAXIMIZED);return e===ss.ALWAYS||e===ss.REMEMBER_LAST&&i}setAuxiliaryBarHidden(e,i){var t,s;if(this.stateModel.setRuntimeValue(d.AUXILIARYBAR_HIDDEN,e),e?this.mainContainer.classList.add(y.AUXILIARYBAR_HIDDEN):this.mainContainer.classList.remove(y.AUXILIARYBAR_HIDDEN),e&&this.paneCompositeService.getActivePaneComposite(S.AuxiliaryBar))this.paneCompositeService.hideActivePaneComposite(S.AuxiliaryBar),this.focusPanelOrEditor();else if(!e&&!this.paneCompositeService.getActivePaneComposite(S.AuxiliaryBar)){let n=this.paneCompositeService.getLastActivePaneCompositeId(S.AuxiliaryBar);if((!n||!this.hasViews(n))&&(n=(t=this.viewDescriptorService.getViewContainersByLocation(S.AuxiliaryBar).find(o=>this.hasViews(o.id)))==null?void 0:t.id),n){const o=!i;this.paneCompositeService.openPaneComposite(n,S.AuxiliaryBar,o)||this.paneCompositeService.openPaneComposite((s=this.viewDescriptorService.getDefaultViewContainer(S.AuxiliaryBar))==null?void 0:s.id,S.AuxiliaryBar,o)}}this.workbenchGrid.setViewVisible(this.auxiliaryBarPartView,!e)}setPartHidden(e,i,t=C){switch(i){case h.ACTIVITYBAR_PART:return this.setActivityBarHidden(e);case h.SIDEBAR_PART:return this.setSideBarHidden(e);case h.EDITOR_PART:return this.setEditorHidden(e);case h.BANNER_PART:return this.setBannerHidden(e);case h.AUXILIARYBAR_PART:return this.setAuxiliaryBarHidden(e);case h.PANEL_PART:return this.setPanelHidden(e)}}hasMainWindowBorder(){return this.state.runtime.mainWindowBorder}getMainWindowBorderRadius(){return this.state.runtime.mainWindowBorder&&ee?"10px":void 0}isPanelMaximized(){return(this.getPanelAlignment()==="center"||!L(this.getPanelPosition()))&&!this.isVisible(h.EDITOR_PART,C)}getSideBarPosition(){return this.stateModel.getRuntimeValue(d.SIDEBAR_POSITON)}getPanelAlignment(){return this.stateModel.getRuntimeValue(d.PANEL_ALIGNMENT)}updateMenubarVisibility(e){const i=Ie(this.configurationService,C,this.state.runtime.menuBar.toggled);!e&&this.workbenchGrid&&i!==this.isVisible(h.TITLEBAR_PART,C)&&this.workbenchGrid.setViewVisible(this.titleBarPartView,i)}updateCustomTitleBarVisibility(){const e=Ie(this.configurationService,C,this.state.runtime.menuBar.toggled),i=this.isVisible(h.TITLEBAR_PART);e!==i&&this.workbenchGrid.setViewVisible(this.titleBarPartView,e)}toggleMenuBar(){let e=pt(this.configurationService);typeof e!="string"&&(e="classic");let i;e==="visible"||e==="classic"?i=ve(this.configurationService)?"toggle":"compact":i="classic",this.configurationService.updateValue("window.menuBarVisibility",i)}getPanelPosition(){return this.stateModel.getRuntimeValue(d.PANEL_POSITION)}setPanelPosition(e){this.isVisible(h.PANEL_PART)||this.setPanelHidden(!1);const i=this.getPart(h.PANEL_PART),t=qe(this.getPanelPosition()),s=qe(e),n=_e(i.getContainer());n.classList.remove(t),n.classList.add(s),i.updateStyles();const o=this.workbenchGrid.getViewSize(this.panelPartView),a=this.workbenchGrid.getViewSize(this.sideBarPartView),r=this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);let c=!this.isVisible(h.EDITOR_PART,C);s!==t&&!c&&(L(e)?this.stateModel.setRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_WIDTH,o.width):L(Ni(t))&&this.stateModel.setRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_HEIGHT,o.height)),L(e)&&this.getPanelAlignment()!=="center"&&c&&(this.toggleMaximizedPanel(),c=!1),this.stateModel.setRuntimeValue(d.PANEL_POSITION,e);const l=this.isVisible(h.SIDEBAR_PART),g=this.isVisible(h.AUXILIARYBAR_PART),A=this.hasFocus(h.PANEL_PART);e===E.BOTTOM?this.workbenchGrid.moveView(this.panelPartView,c?o.height:this.stateModel.getRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_HEIGHT),this.editorPartView,F.Down):e===E.TOP?this.workbenchGrid.moveView(this.panelPartView,c?o.height:this.stateModel.getRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_HEIGHT),this.editorPartView,F.Up):e===E.RIGHT?this.workbenchGrid.moveView(this.panelPartView,c?o.width:this.stateModel.getRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_WIDTH),this.editorPartView,F.Right):this.workbenchGrid.moveView(this.panelPartView,c?o.width:this.stateModel.getRuntimeValue(d.PANEL_LAST_NON_MAXIMIZED_WIDTH),this.editorPartView,F.Left),A&&this.focusPart(h.PANEL_PART),this.workbenchGrid.resizeView(this.sideBarPartView,a),l||this.setSideBarHidden(!0),this.workbenchGrid.resizeView(this.auxiliaryBarPartView,r),g||this.setAuxiliaryBarHidden(!0),L(e)&&this.adjustPartPositions(this.getSideBarPosition(),this.getPanelAlignment(),e),this._onDidChangePanelPosition.fire(s)}isWindowMaximized(e){return this.state.runtime.maximized.has(St(e))}updateWindowMaximizedState(e,i){this.mainContainer.classList.toggle(y.MAXIMIZED,i);const t=St(e);i!==this.state.runtime.maximized.has(t)&&(i?this.state.runtime.maximized.add(t):this.state.runtime.maximized.delete(t),this.updateWindowsBorder(),this._onDidChangeWindowMaximized.fire({windowId:t,maximized:i}))}getVisibleNeighborPart(e,i){if(!this.workbenchGrid||!this.isVisible(e,C))return;const t=this.workbenchGrid.getNeighborViews(this.getPart(e),i,!1);if(t)for(const s of t){const n=[h.ACTIVITYBAR_PART,h.EDITOR_PART,h.PANEL_PART,h.AUXILIARYBAR_PART,h.SIDEBAR_PART,h.STATUSBAR_PART,h.TITLEBAR_PART].find(o=>this.getPart(o)===s&&this.isVisible(o,C));if(n!==void 0)return n}}onDidChangeWCO(){const e=this.workbenchGrid.getNeighborViews(this.titleBarPartView,F.Up,!1).length>0,i=this.shouldShowBannerFirst();e!==i&&this.workbenchGrid.moveView(this.bannerPartView,hi.Distribute,this.titleBarPartView,i?F.Up:F.Down),this.workbenchGrid.setViewVisible(this.titleBarPartView,Ie(this.configurationService,C,this.state.runtime.menuBar.toggled))}arrangeEditorNodes(e,i,t){if(!e.sideBar&&!e.auxiliaryBar)return e.editor.size=i,e.editor;const s=[e.editor];return e.editor.size=t,e.sideBar&&(this.stateModel.getRuntimeValue(d.SIDEBAR_POSITON)===E.LEFT?s.splice(0,0,e.sideBar):s.push(e.sideBar),e.editor.size-=this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN)?0:e.sideBar.size),e.auxiliaryBar&&(this.stateModel.getRuntimeValue(d.SIDEBAR_POSITON)===E.RIGHT?s.splice(0,0,e.auxiliaryBar):s.push(e.auxiliaryBar),e.editor.size-=this.stateModel.getRuntimeValue(d.AUXILIARYBAR_HIDDEN)?0:e.auxiliaryBar.size),{type:"branch",data:s,size:i}}arrangeMiddleSectionNodes(e,i,t){const s=this.stateModel.getRuntimeValue(d.ACTIVITYBAR_HIDDEN)?0:e.activityBar.size,n=this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN)?0:e.sideBar.size,o=this.stateModel.getRuntimeValue(d.AUXILIARYBAR_HIDDEN)?0:e.auxiliaryBar.size,a=this.stateModel.getInitializationValue(d.PANEL_SIZE)?0:e.panel.size,r=this.stateModel.getRuntimeValue(d.PANEL_POSITION),c=this.stateModel.getRuntimeValue(d.SIDEBAR_POSITON),l=[];if(!L(r))l.push(e.editor),e.editor.size=i-s-n-a-o,r===E.RIGHT?l.push(e.panel):l.splice(0,0,e.panel),c===E.LEFT?(l.push(e.auxiliaryBar),l.splice(0,0,e.sideBar),l.splice(0,0,e.activityBar)):(l.splice(0,0,e.auxiliaryBar),l.push(e.sideBar),l.push(e.activityBar));else{const g=this.stateModel.getRuntimeValue(d.PANEL_ALIGNMENT),A=!(g==="center"||c===E.LEFT&&g==="right"||c===E.RIGHT&&g==="left"),p=!(g==="center"||c===E.RIGHT&&g==="right"||c===E.LEFT&&g==="left"),R=i-s-(A?0:n)-(p?0:o),N=this.arrangeEditorNodes({editor:e.editor,sideBar:A?e.sideBar:void 0,auxiliaryBar:p?e.auxiliaryBar:void 0},t-a,R);l.push({type:"branch",data:r===E.BOTTOM?[N,e.panel]:[e.panel,N],size:R}),A||(c===E.LEFT?l.splice(0,0,e.sideBar):l.push(e.sideBar)),p||(c===E.RIGHT?l.splice(0,0,e.auxiliaryBar):l.push(e.auxiliaryBar)),c===E.LEFT?l.splice(0,0,e.activityBar):l.push(e.activityBar)}return l}createGridDescriptor(){const{width:e,height:i}=this._mainContainerDimension,t=this.stateModel.getInitializationValue(d.SIDEBAR_SIZE),s=this.stateModel.getInitializationValue(d.AUXILIARYBAR_SIZE),n=this.stateModel.getInitializationValue(d.PANEL_SIZE),o=this.titleBarPartView.minimumHeight,a=this.bannerPartView.minimumHeight,r=this.statusBarPartView.minimumHeight,c=this.activityBarPartView.minimumWidth,l=i-o-r,g=[{type:"leaf",data:{type:h.TITLEBAR_PART},size:o,visible:this.isVisible(h.TITLEBAR_PART,C)},{type:"leaf",data:{type:h.BANNER_PART},size:a,visible:!1}],A={type:"leaf",data:{type:h.ACTIVITYBAR_PART},size:c,visible:!this.stateModel.getRuntimeValue(d.ACTIVITYBAR_HIDDEN)},p={type:"leaf",data:{type:h.SIDEBAR_PART},size:t,visible:!this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN)},R={type:"leaf",data:{type:h.AUXILIARYBAR_PART},size:s,visible:this.isVisible(h.AUXILIARYBAR_PART)},N={type:"leaf",data:{type:h.EDITOR_PART},size:0,visible:!this.stateModel.getRuntimeValue(d.EDITOR_HIDDEN)},de={type:"leaf",data:{type:h.PANEL_PART},size:n,visible:!this.stateModel.getRuntimeValue(d.PANEL_HIDDEN)},ci=this.arrangeMiddleSectionNodes({activityBar:A,auxiliaryBar:R,editor:N,panel:de,sideBar:p},e,l),tt={root:{type:"branch",size:e,data:[...this.shouldShowBannerFirst()?g.reverse():g,{type:"branch",data:ci,size:l},{type:"leaf",data:{type:h.STATUSBAR_PART},size:r,visible:!this.stateModel.getRuntimeValue(d.STATUSBAR_HIDDEN)}]},orientation:Zn.VERTICAL,width:e,height:i},Ys={activityBarVisible:!this.stateModel.getRuntimeValue(d.ACTIVITYBAR_HIDDEN),sideBarVisible:!this.stateModel.getRuntimeValue(d.SIDEBAR_HIDDEN),auxiliaryBarVisible:!this.stateModel.getRuntimeValue(d.AUXILIARYBAR_HIDDEN),panelVisible:!this.stateModel.getRuntimeValue(d.PANEL_HIDDEN),statusbarVisible:!this.stateModel.getRuntimeValue(d.STATUSBAR_HIDDEN),sideBarPosition:qe(this.stateModel.getRuntimeValue(d.SIDEBAR_POSITON)),panelPosition:qe(this.stateModel.getRuntimeValue(d.PANEL_POSITION))};return this.telemetryService.publicLog2("startupLayout",Ys),tt}dispose(){super.dispose(),this.disposed=!0}}function As(u){return u.getValue(Di.ZEN_MODE_CONFIG)}class Ks{constructor(e,i,t,s){this.name=e,this.scope=i,this.target=t,this.defaultValue=s}}class M extends Ks{constructor(e,i,t,s,n){super(e,i,t,s),this.zenModeIgnore=n,this.runtime=!0}}class lt extends Ks{constructor(){super(...arguments),this.runtime=!1}}const d={MAIN_EDITOR_CENTERED:new M("editor.centered",T.WORKSPACE,P.MACHINE,!1),ZEN_MODE_ACTIVE:new M("zenMode.active",T.WORKSPACE,P.MACHINE,!1),ZEN_MODE_EXIT_INFO:new M("zenMode.exitInfo",T.WORKSPACE,P.MACHINE,{transitionedToCenteredEditorLayout:!1,transitionedToFullScreen:!1,handleNotificationsDoNotDisturbMode:!1,wasVisible:{auxiliaryBar:!1,panel:!1,sideBar:!1}}),SIDEBAR_SIZE:new lt("sideBar.size",T.PROFILE,P.MACHINE,200),AUXILIARYBAR_SIZE:new lt("auxiliaryBar.size",T.PROFILE,P.MACHINE,200),PANEL_SIZE:new lt("panel.size",T.PROFILE,P.MACHINE,300),PANEL_LAST_NON_MAXIMIZED_HEIGHT:new M("panel.lastNonMaximizedHeight",T.PROFILE,P.MACHINE,300),PANEL_LAST_NON_MAXIMIZED_WIDTH:new M("panel.lastNonMaximizedWidth",T.PROFILE,P.MACHINE,300),PANEL_WAS_LAST_MAXIMIZED:new M("panel.wasLastMaximized",T.WORKSPACE,P.MACHINE,!1),SIDEBAR_POSITON:new M("sideBar.position",T.WORKSPACE,P.MACHINE,E.LEFT),PANEL_POSITION:new M("panel.position",T.WORKSPACE,P.MACHINE,E.BOTTOM),PANEL_ALIGNMENT:new M("panel.alignment",T.PROFILE,P.USER,"center"),ACTIVITYBAR_HIDDEN:new M("activityBar.hidden",T.WORKSPACE,P.MACHINE,!1,!0),SIDEBAR_HIDDEN:new M("sideBar.hidden",T.WORKSPACE,P.MACHINE,!1),EDITOR_HIDDEN:new M("editor.hidden",T.WORKSPACE,P.MACHINE,!1),PANEL_HIDDEN:new M("panel.hidden",T.WORKSPACE,P.MACHINE,!0),AUXILIARYBAR_HIDDEN:new M("auxiliaryBar.hidden",T.WORKSPACE,P.MACHINE,!0),STATUSBAR_HIDDEN:new M("statusBar.hidden",T.WORKSPACE,P.MACHINE,!1,!0)};var Di;(function(u){u.PANEL_POSITION="workbench.panel.defaultLocation",u.PANEL_OPENS_MAXIMIZED="workbench.panel.opensMaximized",u.ZEN_MODE_CONFIG="zenMode",u.EDITOR_CENTERED_LAYOUT_AUTO_RESIZE="workbench.editor.centeredLayoutAutoResize"})(Di||(Di={}));var Y;(function(u){u.STATUSBAR_VISIBLE="workbench.statusBar.visible",u.SIDEBAR_POSITION="workbench.sideBar.location"})(Y||(Y={}));const Je=class Je extends J{constructor(e,i,t){super(),this.storageService=e,this.configurationService=i,this.contextService=t,this._onDidChangeState=this._register(new b),this.onDidChangeState=this._onDidChangeState.event,this.stateCache=new Map,this._register(this.configurationService.onDidChangeConfiguration(s=>this.updateStateFromLegacySettings(s)))}updateStateFromLegacySettings(e){e.affectsConfiguration(D.ACTIVITY_BAR_LOCATION)&&this.setRuntimeValueAndFire(d.ACTIVITYBAR_HIDDEN,this.isActivityBarHidden()),e.affectsConfiguration(Y.STATUSBAR_VISIBLE)&&this.setRuntimeValueAndFire(d.STATUSBAR_HIDDEN,!this.configurationService.getValue(Y.STATUSBAR_VISIBLE)),e.affectsConfiguration(Y.SIDEBAR_POSITION)&&this.setRuntimeValueAndFire(d.SIDEBAR_POSITON,Ni(this.configurationService.getValue(Y.SIDEBAR_POSITION)??"left"))}updateLegacySettingsFromState(e,i){const t=this.getRuntimeValue(d.ZEN_MODE_ACTIVE);e.zenModeIgnore&&t||(e===d.ACTIVITYBAR_HIDDEN?this.configurationService.updateValue(D.ACTIVITY_BAR_LOCATION,i?ni.HIDDEN:void 0):e===d.STATUSBAR_HIDDEN?this.configurationService.updateValue(Y.STATUSBAR_VISIBLE,!i):e===d.SIDEBAR_POSITON&&this.configurationService.updateValue(Y.SIDEBAR_POSITION,qe(i)))}load(e){let i;for(i in d){const t=d[i],s=this.loadKeyFromStorage(t);s!==void 0&&this.stateCache.set(t.name,s)}this.stateCache.set(d.ACTIVITYBAR_HIDDEN.name,this.isActivityBarHidden()),this.stateCache.set(d.STATUSBAR_HIDDEN.name,!this.configurationService.getValue(Y.STATUSBAR_VISIBLE)),this.stateCache.set(d.SIDEBAR_POSITON.name,Ni(this.configurationService.getValue(Y.SIDEBAR_POSITION)??"left")),d.PANEL_POSITION.defaultValue=Ni(this.configurationService.getValue(Di.PANEL_POSITION)??"bottom"),d.SIDEBAR_SIZE.defaultValue=Math.min(300,e.width/4),d.AUXILIARYBAR_SIZE.defaultValue=Math.min(300,e.width/4),d.PANEL_SIZE.defaultValue=this.stateCache.get(d.PANEL_POSITION.name)??L(d.PANEL_POSITION.defaultValue)?e.height/3:e.width/4,d.SIDEBAR_HIDDEN.defaultValue=this.contextService.getWorkbenchState()===Vs.EMPTY;for(i in d){const t=d[i];this.stateCache.get(t.name)===void 0&&this.stateCache.set(t.name,t.defaultValue)}this._register(this.storageService.onDidChangeValue(T.PROFILE,void 0,this._store)(t=>{let s;for(s in d){const n=d[s];if(n instanceof M&&n.scope===T.PROFILE&&n.target===P.USER&&`${Je.STORAGE_PREFIX}${n.name}`===t.key){const o=this.loadKeyFromStorage(n)??n.defaultValue;this.stateCache.get(n.name)!==o&&(this.stateCache.set(n.name,o),this._onDidChangeState.fire({key:n,value:o}))}}}))}save(e,i){let t;const s=this.getRuntimeValue(d.ZEN_MODE_ACTIVE);for(t in d){const n=d[t];if(e&&n.scope===T.WORKSPACE||i&&n.scope===T.PROFILE){if(s&&n instanceof M&&n.zenModeIgnore)continue;this.saveKeyToStorage(n)}}}getInitializationValue(e){return this.stateCache.get(e.name)}setInitializationValue(e,i){this.stateCache.set(e.name,i)}getRuntimeValue(e,i){if(i)switch(e){case d.ACTIVITYBAR_HIDDEN:this.stateCache.set(e.name,this.isActivityBarHidden());break;case d.STATUSBAR_HIDDEN:this.stateCache.set(e.name,!this.configurationService.getValue(Y.STATUSBAR_VISIBLE));break;case d.SIDEBAR_POSITON:this.stateCache.set(e.name,this.configurationService.getValue(Y.SIDEBAR_POSITION)??"left");break}return this.stateCache.get(e.name)}setRuntimeValue(e,i){this.stateCache.set(e.name,i);const t=this.getRuntimeValue(d.ZEN_MODE_ACTIVE);e.scope===T.PROFILE&&(!t||!e.zenModeIgnore)&&(this.saveKeyToStorage(e),this.updateLegacySettingsFromState(e,i))}isActivityBarHidden(){const e=this.configurationService.getValue("workbench.activityBar.visible");return e!==void 0?!e:this.configurationService.getValue(D.ACTIVITY_BAR_LOCATION)!==ni.DEFAULT}setRuntimeValueAndFire(e,i){this.stateCache.get(e.name)!==i&&(this.setRuntimeValue(e,i),this._onDidChangeState.fire({key:e,value:i}))}saveKeyToStorage(e){const i=this.stateCache.get(e.name);this.storageService.store(`${Je.STORAGE_PREFIX}${e.name}`,typeof i=="object"?JSON.stringify(i):i,e.scope,e.target)}loadKeyFromStorage(e){let i=this.storageService.get(`${Je.STORAGE_PREFIX}${e.name}`,e.scope);if(i!==void 0)switch(typeof e.defaultValue){case"boolean":i=i==="true";break;case"number":i=parseInt(i);break;case"object":i=JSON.parse(i);break}return i}};Je.STORAGE_PREFIX="workbench.";let Pt=Je;const xa=5e3;let Nt=class extends J{constructor(e,i,t){super(),this._accessibilitySignalService=t,this._scheduler=new Bs(()=>{this._signalLoop=this._accessibilitySignalService.playSignalLoop(Qi.progress,i??xa)},e),this._scheduler.schedule()}dispose(){var e;super.dispose(),(e=this._signalLoop)==null||e.dispose(),this._scheduler.dispose()}};Nt=_([f(2,Ji)],Nt);class ka{constructor(){this.priority=90,this.name="notifications",this.when=q,this.type=os.View}getProvider(e){const i=e.get(qn),t=e.get(Ze),s=e.get(pe),n=e.get(Ji);function o(){const a=Ee(t);if(!a)return;s.executeCommand("notifications.showList");let r;const c=t.lastFocusedList;if(c instanceof Ut&&(r=c.indexOf(a)),r===void 0)return;function l(){if(s.executeCommand("notifications.showList"),c&&r!==void 0){c.domFocus();try{c.setFocus([r])}catch{}}}function g(){const p=Ee(t),R=p==null?void 0:p.message.original.toString();if(p)return p.source?m(3318,"{0} Source: {1}",R,p.source):m(3319,"{0}",R)}const A=g();if(A)return a.onDidClose(()=>i.next()),new jn(Jn.Notification,{type:os.View},()=>A,()=>l(),"accessibility.verbosity.notification",void 0,Ha(a,n),()=>{if(c)return l(),c.focusNext(),g()},()=>{if(c)return l(),c.focusPrevious(),g()})}return o()}}function Ha(u,e){let i;if(u.actions&&(i=[],u.actions.primary&&i.push(...u.actions.primary),u.actions.secondary&&i.push(...u.actions.secondary)),i)for(const s of i){s.class=O.asClassName(U.bell);const n=s.run;s.run=()=>{n(),u.close()}}const t=i==null?void 0:i.find(s=>s.label.includes("Manage Extension"));return t&&(t.class=O.asClassName(U.gear)),i&&i.push({id:"clearNotification",label:m(3320,"Clear Notification"),tooltip:m(3320,"Clear Notification"),run:()=>{u.close(),e.playSignal(Qi.clear)},enabled:!0,class:O.asClassName(U.clearAll)}),i}class Fa extends Oa{constructor(e,i,t,s){super(e),this.options=i,this.serviceCollection=t,this._onWillShutdown=this._register(new b),this.onWillShutdown=this._onWillShutdown.event,this._onDidShutdown=this._register(new b),this.onDidShutdown=this._onDidShutdown.event,this.previousUnexpectedError={message:void 0,time:0},V("code/willStartWorkbench"),this.registerErrorHandler(s)}registerErrorHandler(e){C.addEventListener("unhandledrejection",i=>{Vi(i.reason),i.preventDefault()}),Ls(i=>this.handleUnexpectedError(i,e))}handleUnexpectedError(e,i){const t=ji(e,!0);if(!t)return;const s=Date.now();t===this.previousUnexpectedError.message&&s-this.previousUnexpectedError.time<=1e3||(this.previousUnexpectedError.time=s,this.previousUnexpectedError.message=t,i.error(t))}startup(){try{this._register(Qn(175));const e=this.initServices(this.serviceCollection);return e.invokeFunction(i=>{const t=i.get(xi),s=i.get(Ce),n=i.get(Fe),o=i.get(ri),a=i.get(eo),r=i.get(me);this.initLayout(i),this.registerListeners(t,s,n,o,a),this.renderWorkbench(e,r,s,n),this.createWorkbenchLayout(),this.layout(),this.restore(t)}),e}catch(e){throw Vi(e),e}}initServices(e){e.set(he,this);const i=io();for(const[s,n]of i)e.set(s,n);const t=new to(e,!0);return t.invokeFunction(s=>{const n=s.get(xi),o=s.get(Fe);typeof o.acquireInstantiationService=="function"&&o.acquireInstantiationService(t),n.phase=ui.Ready}),t}registerListeners(e,i,t,s,n){this._register(t.onDidChangeConfiguration(o=>this.updateFontAliasing(o,t))),Bi?this._register(i.onWillSaveState(o=>{o.reason===so.SHUTDOWN&&this.storeFontInfo(i)})):this._register(e.onWillShutdown(()=>this.storeFontInfo(i))),this._register(e.onWillShutdown(o=>this._onWillShutdown.fire(o))),this._register(e.onDidShutdown(()=>{this._onDidShutdown.fire(),this.dispose()})),this._register(s.onDidChangeFocus(o=>{o||i.flush()})),this._register(n.onWillShowDialog(()=>this.mainContainer.classList.add("modal-dialog-visible"))),this._register(n.onDidShowDialog(()=>this.mainContainer.classList.remove("modal-dialog-visible")))}updateFontAliasing(e,i){if(!ee||e&&!e.affectsConfiguration("workbench.fontAliasing"))return;const t=i.getValue("workbench.fontAliasing");if(this.fontAliasing===t)return;this.fontAliasing=t;const s=["antialiased","none","auto"];this.mainContainer.classList.remove(...s.map(n=>`monaco-font-aliasing-${n}`)),s.some(n=>n===t)&&this.mainContainer.classList.add(`monaco-font-aliasing-${t}`)}restoreFontInfo(e,i){const t=e.get("editorFontInfo",T.APPLICATION);if(t)try{const s=JSON.parse(t);Array.isArray(s)&&rt.restoreFontInfo(C,s)}catch{}rt.readFontInfo(C,no.createFromRawSettings(i.getValue("editor"),oo.getInstance(C).value))}storeFontInfo(e){const i=rt.serializeFontInfo(C);i&&e.store("editorFontInfo",JSON.stringify(i),T.APPLICATION,P.MACHINE)}renderWorkbench(e,i,t,s){var a;ao(this.mainContainer),ro((r,c)=>e.createInstance(Nt,r,c));const o=li(["monaco-workbench",ii?"windows":Ei?"linux":"mac",j?"web":void 0,co?"chromium":ho?"firefox":lo?"safari":void 0,...this.getLayoutClasses(),...(a=this.options)!=null&&a.extraClasses?this.options.extraClasses:[]]);this.mainContainer.classList.add(...o),this.updateFontAliasing(void 0,s),this.restoreFontInfo(t,s);for(const{id:r,role:c,classes:l,options:g}of[{id:h.TITLEBAR_PART,role:"none",classes:["titlebar"]},{id:h.BANNER_PART,role:"banner",classes:["banner"]},{id:h.ACTIVITYBAR_PART,role:"none",classes:["activitybar",this.getSideBarPosition()===E.LEFT?"left":"right"]},{id:h.SIDEBAR_PART,role:"none",classes:["sidebar",this.getSideBarPosition()===E.LEFT?"left":"right"]},{id:h.EDITOR_PART,role:"main",classes:["editor"],options:{restorePreviousState:this.willRestoreEditors()}},{id:h.PANEL_PART,role:"none",classes:["panel","basepanel",qe(this.getPanelPosition())]},{id:h.AUXILIARYBAR_PART,role:"none",classes:["auxiliarybar","basepanel",this.getSideBarPosition()===E.LEFT?"right":"left"]},{id:h.STATUSBAR_PART,role:"status",classes:["statusbar"]}]){const A=this.createPart(r,c,l);V(`code/willCreatePart/${r}`),this.getPart(r).create(A,g),V(`code/didCreatePart/${r}`)}this.createNotificationsHandlers(e,i),this.parent.appendChild(this.mainContainer)}createPart(e,i,t){const s=document.createElement(i==="status"?"footer":"div");return s.classList.add("part",...t),s.id=e,s.setAttribute("role",i),i==="status"&&s.setAttribute("aria-live","off"),s}createNotificationsHandlers(e,i){const t=this._register(e.createInstance(Dt,this.mainContainer,i.model)),s=this._register(e.createInstance(yt,this.mainContainer,i.model));this._register(e.createInstance(Ba,i.model));const n=e.createInstance(Rt,i.model);this._register(t.onDidChangeVisibility(()=>{n.update(t.isVisible,s.isVisible),s.update(t.isVisible)})),this._register(s.onDidChangeVisibility(()=>{n.update(t.isVisible,s.isVisible)})),va(t,s,i.model),uo.register(new ka),this.registerNotifications({onDidChangeNotificationsVisibility:se.map(se.any(s.onDidChangeVisibility,t.onDidChangeVisibility),()=>s.isVisible||t.isVisible)})}restore(e){try{this.restoreParts()}catch(i){Vi(i)}this.whenReady.finally(()=>Promise.race([this.whenRestored,fo(2e3)]).finally(()=>{function i(){V("code/didStartWorkbench"),performance.measure("perf: workbench create & restore","code/didLoadWorkbenchMain","code/didStartWorkbench")}this.isRestored()?i():this.whenRestored.finally(()=>i()),e.phase=ui.Restored,this._register(new Bs(()=>{this._register(go(C,()=>e.phase=ui.Eventually,2500))},2500)).schedule()}))}}var Vt;let Bt=class{constructor(e,i,t,s){this._disposables=new X,this._onDidChangeVisibility=this._disposables.add(new b),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this.element=document.createElement("div"),this.element.classList.add("command-center");const n=t.createInstance(mo,this.element,B.CommandCenter,{contextMenu:B.TitleBarContext,hiddenItemStrategy:Ms.NoHide,toolbarOptions:{primaryGroup:()=>!0},telemetrySource:"commandCenter",actionViewItemProvider:(o,a)=>o instanceof po&&o.item.submenu===B.CommandCenterCenter?t.createInstance(Lt,o,e,{...a,hoverDelegate:i}):Zt(t,o,{...a,hoverDelegate:i})});this._disposables.add(se.filter(s.onShow,()=>Ns(this.element),this._disposables)(this._setVisibility.bind(this,!1))),this._disposables.add(s.onHide(this._setVisibility.bind(this,!0))),this._disposables.add(n)}_setVisibility(e){this.element.classList.toggle("hide",!e),this._onDidChangeVisibility.fire()}dispose(){this._disposables.dispose()}};Bt=_([f(2,K),f(3,Ts)],Bt);var xe;let Lt=(xe=class extends as{constructor(e,i,t,s,n,o,a){super(void 0,e.actions.find(r=>r.id==="workbench.action.quickOpenWithModes")??e.actions[0],t),this._submenu=e,this._windowTitle=i,this._hoverService=s,this._keybindingService=n,this._instaService=o,this._editorGroupService=a,this._hoverDelegate=t.hoverDelegate??gt("mouse")}render(e){super.render(e),e.classList.add("command-center-center"),e.classList.toggle("multiple",this._submenu.actions.length>1);const i=this._store.add(this._hoverService.setupManagedHover(this._hoverDelegate,e,this.getTooltip()));this._store.add(this._windowTitle.onDidChange(()=>{i.update(this.getTooltip())}));const t=[];for(const s of this._submenu.actions)s instanceof Ao?t.push(s.actions):t.push([s]);for(let s=0;s<t.length;s++){const n=t[s],o=this._instaService.createInstance(Os,e,{hiddenItemStrategy:Ms.NoHide,telemetrySource:"commandCenterCenter",actionViewItemProvider:(a,r)=>{if(r={...r,hoverDelegate:this._hoverDelegate},a.id!==Vt._quickOpenCommandId)return Zt(this._instaService,a,r);const c=this;return this._instaService.createInstance(class extends as{constructor(){super(void 0,a,r)}render(g){super.render(g),g.classList.toggle("command-center-quick-pick"),g.role="button";const A=this.action,p=document.createElement("span");p.ariaHidden="true",p.className=A.class??"",p.classList.add("search-icon");const R=this._getLabel(),N=document.createElement("span");N.classList.add("search-label"),N.innerText=R,xs(g,p,N);const de=this._store.add(c._hoverService.setupManagedHover(c._hoverDelegate,g,this.getTooltip()));this._store.add(c._windowTitle.onDidChange(()=>{de.update(this.getTooltip()),N.innerText=this._getLabel()})),this._store.add(c._editorGroupService.onDidChangeEditorPartOptions(({newPartOptions:ci,oldPartOptions:tt})=>{ci.showTabs!==tt.showTabs&&(de.update(this.getTooltip()),N.innerText=this._getLabel())}))}getTooltip(){return c.getTooltip()}_getLabel(){const{prefix:g,suffix:A}=c._windowTitle.getTitleDecorations();let p=c._windowTitle.workspaceName;return c._windowTitle.isCustomTitleFormat()?p=c._windowTitle.getWindowTitle():c._editorGroupService.partOptions.showTabs==="none"&&(p=c._windowTitle.fileName??p),p||(p=m(3440,"Search")),g&&(p=m(3441,"{0} {1}",g,p)),A&&(p=m(3442,"{0} {1}",p,A)),p.replaceAll(/\r\n|\r|\n/g,"⏎")}})}});if(o.setActions(n),this._store.add(o),s<t.length-1){const a=So(U.circleSmallFilled);a.style.padding="0 12px",a.style.height="100%",a.style.opacity="0.5",e.appendChild(a)}}}getTooltip(){var t;const e=(t=this._keybindingService.lookupKeybinding(this.action.id))==null?void 0:t.getLabel();return e?m(3443,"Search {0} ({1}) — {2}",this._windowTitle.workspaceName,e,this._windowTitle.value):m(3444,"Search {0} — {1}",this._windowTitle.workspaceName,this._windowTitle.value)}},Vt=xe,xe._quickOpenCommandId="workbench.action.quickOpenWithModes",xe);Lt=Vt=_([f(3,ws),f(4,Ue),f(5,K),f(6,Se)],Lt);ue.appendMenuItem(B.CommandCenter,{submenu:B.CommandCenterCenter,title:m(3445,"Command Center"),icon:U.shield,order:101});var Mt;let Ot=class extends Co{constructor(e,i,t){super("workbench.titleService",t,i),this.instantiationService=e,this.properties=void 0,this.variables=new Map,this.mainPart=this._register(this.createMainTitlebarPart()),this.onMenubarVisibilityChange=this.mainPart.onMenubarVisibilityChange,this._register(this.registerPart(this.mainPart)),this.registerActions(),this.registerAPICommands()}createMainTitlebarPart(){return this.instantiationService.createInstance(xt)}registerActions(){const e=this;this._register(ks(class extends Hs{constructor(){super({id:"workbench.action.focusTitleBar",title:oe(3480,"Focus Title Bar"),category:Fs.View,f1:!0,precondition:Io})}run(){var t;(t=e.getPartByDocument(ys()))==null||t.focus()}}))}registerAPICommands(){this._register(Te.registerCommand({id:"registerWindowTitleVariable",handler:(e,i,t)=>{this.registerVariables([{name:i,contextKey:t}])},metadata:{description:"Registers a new title variable",args:[{name:"name",schema:{type:"string"},description:"The name of the variable to register"},{name:"contextKey",schema:{type:"string"},description:"The context key to use for the value of the variable"}]}}))}createAuxiliaryTitlebarPart(e,i){const t=I(".part.titlebar",{role:"none"});t.style.position="relative",e.insertBefore(t,e.firstChild);const s=new X,n=this.doCreateAuxiliaryTitlebarPart(t,i);return s.add(this.registerPart(n)),s.add(se.runAndSubscribe(n.onDidChange,()=>t.style.height=`${n.height}px`)),n.create(t),this.properties&&n.updateProperties(this.properties),this.variables.size&&n.registerVariables(Array.from(this.variables.values())),se.once(n.onWillDispose)(()=>s.dispose()),n}doCreateAuxiliaryTitlebarPart(e,i){return this.instantiationService.createInstance(kt,e,i,this.mainPart)}updateProperties(e){this.properties=e;for(const i of this.parts)i.updateProperties(e)}registerVariables(e){const i=[];for(const t of e)this.variables.has(t.name)||(this.variables.set(t.name,t),i.push(t));for(const t of this.parts)t.registerVariables(i)}};Ot=_([f(0,K),f(1,Ce),f(2,Ae)],Ot);let Xi=class extends Xt{get minimumHeight(){var t;const e=j&&At();let i=this.isCommandCenterVisible||e?To:30;return e&&(i=Math.max(i,((t=bo(G(this.element)))==null?void 0:t.height)??0)),i/(this.preventZoom?Li(G(this.element)):1)}get maximumHeight(){return this.minimumHeight}constructor(e,i,t,s,n,o,a,r,c,l,g,A,p,R,N,de){super(e,{hasTitle:!1},r,c,l),this.contextMenuService=s,this.configurationService=n,this.environmentService=o,this.instantiationService=a,this.storageService=c,this.contextKeyService=g,this.hostService=A,this.editorGroupService=p,this.menuService=N,this.keybindingService=de,this.minimumWidth=0,this.maximumWidth=Number.POSITIVE_INFINITY,this._onMenubarVisibilityChange=this._register(new b),this.onMenubarVisibilityChange=this._onMenubarVisibilityChange.event,this._onWillDispose=this._register(new b),this.onWillDispose=this._onWillDispose.event,this.actionToolBarDisposable=this._register(new X),this.editorActionsChangeDisposable=this._register(new X),this.hasGlobalToolbarEntries=!1,this.globalToolbarMenuDisposables=this._register(new X),this.editorToolbarMenuDisposables=this._register(new X),this.layoutToolbarMenuDisposables=this._register(new X),this.activityToolbarDisposables=this._register(new X),this.titleDisposables=this._register(new X),this.isInactive=!1,this.titleBarStyle=Eo(this.configurationService),this.globalToolbarMenu=this._register(this.menuService.createMenu(B.TitleBar,this.contextKeyService)),this.isAuxiliary=t!=="main",this.editorService=R.createScoped(t,this._store),this.editorGroupsContainer=t==="main"?p.mainPart:t,this.windowTitle=this._register(a.createInstance(wo,i,t)),this.hoverDelegate=this._register(_o()),this.registerListeners(St(i))}registerListeners(e){this._register(this.hostService.onDidChangeFocus(i=>i?this.onFocus():this.onBlur())),this._register(this.hostService.onDidChangeActiveWindow(i=>i===e?this.onFocus():this.onBlur())),this._register(this.configurationService.onDidChangeConfiguration(i=>this.onConfigurationChanged(i))),this._register(this.editorGroupService.onDidChangeEditorPartOptions(i=>this.onEditorPartConfigurationChange(i)))}onBlur(){this.isInactive=!0,this.updateStyles()}onFocus(){this.isInactive=!1,this.updateStyles()}onEditorPartConfigurationChange({oldPartOptions:e,newPartOptions:i}){(e.editorActionsLocation!==i.editorActionsLocation||e.showTabs!==i.showTabs)&&this.actionToolBar&&(this.createActionToolBar(),this.createActionToolBarMenus({editorActions:!0}),this._onDidChange.fire(void 0))}onConfigurationChanged(e){if(!this.isAuxiliary&&!ve(this.configurationService,this.titleBarStyle)&&(!ee||j)&&e.affectsConfiguration("window.menuBarVisibility")&&(this.currentMenubarVisibility==="compact"?this.uninstallMenubar():this.installMenubar()),this.actionToolBar){const i=e.affectsConfiguration(D.LAYOUT_ACTIONS),t=e.affectsConfiguration(D.ACTIVITY_BAR_LOCATION);(i||t)&&(this.createActionToolBarMenus({layoutActions:i,activityActions:t}),this._onDidChange.fire(void 0))}e.affectsConfiguration(D.COMMAND_CENTER)&&(this.createTitle(),this._onDidChange.fire(void 0))}installMenubar(){this.menubar||(this.customMenubar=this._register(this.instantiationService.createInstance(vo)),this.menubar=$(this.leftContent,I("div.menubar")),this.menubar.setAttribute("role","menubar"),this._register(this.customMenubar.onVisibilityChange(e=>this.onMenubarVisibilityChanged(e))),this.customMenubar.create(this.menubar))}uninstallMenubar(){var e,i;(e=this.customMenubar)==null||e.dispose(),this.customMenubar=void 0,(i=this.menubar)==null||i.remove(),this.menubar=void 0,this.onMenubarVisibilityChanged(!1)}onMenubarVisibilityChanged(e){(j||ii||Ei)&&(this.lastLayoutDimensions&&this.layout(this.lastLayoutDimensions.width,this.lastLayoutDimensions.height),this._onMenubarVisibilityChange.fire(e))}updateProperties(e){this.windowTitle.updateProperties(e)}registerVariables(e){this.windowTitle.registerVariables(e)}createContentArea(e){var i;if(this.element=e,this.rootContainer=$(e,I(".titlebar-container")),this.leftContent=$(this.rootContainer,I(".titlebar-left")),this.centerContent=$(this.rootContainer,I(".titlebar-center")),this.rightContent=$(this.rootContainer,I(".titlebar-right")),(ii||Ei)&&!ve(this.configurationService,this.titleBarStyle)&&(this.appIcon=rs(this.leftContent,I("a.window-appicon"))),this.dragRegion=rs(this.rootContainer,I("div.titlebar-drag-region")),!this.isAuxiliary&&!ve(this.configurationService,this.titleBarStyle)&&(!ee||j)&&this.currentMenubarVisibility!=="compact"&&this.installMenubar(),this.title=$(this.centerContent,I("div.window-title")),this.createTitle(),this.actionToolBarElement=$(this.rightContent,I("div.action-toolbar-container")),this.createActionToolBar(),this.createActionToolBarMenus(),!ve(this.configurationService,this.titleBarStyle)){let t=ee?"left":"right";if(ee&&Bi){const s=Do.Locale(Ro);((i=s==null?void 0:s.textInfo)==null?void 0:i.direction)==="rtl"&&(t="right")}ee&&Bi&&t==="left"||yo(this.configurationService)===Po.HIDDEN||(this.windowControlsContainer=$(t==="left"?this.leftContent:this.rightContent,I("div.window-controls-container")),j&&$(t==="left"?this.rightContent:this.leftContent,I("div.window-controls-container")),At()&&this.windowControlsContainer.classList.add("wco-enabled"))}return this._register(re(this.rootContainer,ce.CONTEXT_MENU,t=>{ei.stop(t);let s;ee&&Gs(t.target)&&No(t.target,this.title)?s=B.TitleBarTitleContext:s=B.TitleBarContext,this.onContextMenu(t,s)})),ee&&this._register(re(this.title,ce.MOUSE_DOWN,t=>{t.metaKey&&(ei.stop(t,!0),this.onContextMenu(t,B.TitleBarTitleContext))},!0)),this.updateStyles(),this.element}createTitle(){if(this.titleDisposables.clear(),!this.isCommandCenterVisible)this.title.innerText=this.windowTitle.value,this.titleDisposables.add(this.windowTitle.onDidChange(()=>{this.title.innerText=this.windowTitle.value,this.lastLayoutDimensions&&this.updateLayout(this.lastLayoutDimensions)}));else{const e=this.instantiationService.createInstance(Bt,this.windowTitle,this.hoverDelegate);xs(this.title,e.element),this.titleDisposables.add(e)}}actionViewItemProvider(e,i){var s;if(!this.isAuxiliary){if(e.id===cs)return this.instantiationService.createInstance(Vo,{position:()=>hs.BELOW},i);if(e.id===ls)return this.instantiationService.createInstance(Bo,{position:()=>hs.BELOW},i)}const t=(s=this.editorGroupsContainer.activeGroup)==null?void 0:s.activeEditorPane;if(t&&t instanceof Lo){const n=t.getActionViewItem(e,i);if(n)return n}return Zt(this.instantiationService,e,{...i,menuAsChild:!1})}getKeybinding(e){var t,s;const i=((s=(t=this.editorGroupsContainer.activeGroup)==null?void 0:t.activeEditorPane)==null?void 0:s.scopedContextKeyService)??this.contextKeyService;return this.keybindingService.lookupKeybinding(e.id,i)}createActionToolBar(){this.actionToolBarDisposable.clear(),this.actionToolBar=this.actionToolBarDisposable.add(this.instantiationService.createInstance(Os,this.actionToolBarElement,{contextMenu:B.TitleBarContext,orientation:xo.HORIZONTAL,ariaLabel:m(3481,"Title actions"),getKeyBinding:e=>this.getKeybinding(e),overflowBehavior:{maxItems:9,exempted:[ls,cs,...Oo]},anchorAlignmentProvider:()=>Mo.RIGHT,telemetrySource:"titlePart",highlightToggledItems:this.editorActionsEnabled,actionViewItemProvider:(e,i)=>this.actionViewItemProvider(e,i),hoverDelegate:this.hoverDelegate})),this.editorActionsEnabled&&this.actionToolBarDisposable.add(this.editorGroupsContainer.onDidChangeActiveGroup(()=>this.createActionToolBarMenus({editorActions:!0})))}createActionToolBarMenus(e=!0){e===!0&&(e={editorActions:!0,layoutActions:!0,activityActions:!0});const i=()=>{const t={primary:[],secondary:[]};if(this.editorActionsEnabled){this.editorActionsChangeDisposable.clear();const n=this.editorGroupsContainer.activeGroup;if(n){const o=n.createEditorActions(this.editorActionsChangeDisposable);t.primary.push(...o.actions.primary),t.secondary.push(...o.actions.secondary),this.editorActionsChangeDisposable.add(o.onDidChange(()=>i()))}}const s=this.globalToolbarMenu.getActions();this.hasGlobalToolbarEntries=s.length>0,ds(s,t),this.layoutToolbarMenu&&ds(this.layoutToolbarMenu.getActions(),t,()=>!this.editorActionsEnabled),this.activityActionsEnabled&&($o(this.storageService)&&t.primary.push(qo),t.primary.push(jo)),this.actionToolBar.setActions(us(t.primary),us(t.secondary))};if(e.editorActions)if(this.editorToolbarMenuDisposables.clear(),this.editorActionsEnabled&&this.editorService.activeEditor!==void 0){const t={groupId:this.editorGroupsContainer.activeGroup.id};this.actionToolBar.actionRunner=this.editorToolbarMenuDisposables.add(new ko(t)),this.actionToolBar.context=t}else this.actionToolBar.actionRunner=this.editorToolbarMenuDisposables.add(new zt),this.actionToolBar.context=void 0;e.layoutActions&&(this.layoutToolbarMenuDisposables.clear(),this.layoutControlEnabled?(this.layoutToolbarMenu=this.menuService.createMenu(B.LayoutControlMenu,this.contextKeyService),this.layoutToolbarMenuDisposables.add(this.layoutToolbarMenu),this.layoutToolbarMenuDisposables.add(this.layoutToolbarMenu.onDidChange(()=>i()))):this.layoutToolbarMenu=void 0),this.globalToolbarMenuDisposables.clear(),this.globalToolbarMenuDisposables.add(this.globalToolbarMenu.onDidChange(()=>i())),e.activityActions&&(this.activityToolbarDisposables.clear(),this.activityActionsEnabled&&this.activityToolbarDisposables.add(this.storageService.onDidChangeValue(T.PROFILE,Ho.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,this._store)(()=>i()))),i()}updateStyles(){if(super.updateStyles(),this.element){this.isInactive?this.element.classList.add("inactive"):this.element.classList.remove("inactive");const e=this.getColor(this.isInactive?Fo:Go,(s,n)=>s.isOpaque()?s:s.makeOpaque(Wo(n)))||"";this.element.style.backgroundColor=e,this.appIconBadge&&(this.appIconBadge.style.backgroundColor=e),e&&zo.fromHex(e).isLighter()?this.element.classList.add("light"):this.element.classList.remove("light");const i=this.getColor(this.isInactive?Uo:Ko);this.element.style.color=i||"";const t=this.getColor(Yo);this.element.style.borderBottom=t?`1px solid ${t}`:""}}onContextMenu(e,i){const t=new Xo(G(this.element),e);this.contextMenuService.showContextMenu({getAnchor:()=>t,menuId:i,contextKeyService:this.contextKeyService,domForShadowRoot:ee&&Bi?t.target:void 0})}get currentMenubarVisibility(){return this.isAuxiliary?"hidden":pt(this.configurationService)}get layoutControlEnabled(){return!this.isAuxiliary&&this.configurationService.getValue(D.LAYOUT_ACTIONS)!==!1}get isCommandCenterVisible(){return this.configurationService.getValue(D.COMMAND_CENTER)!==!1}get editorActionsEnabled(){return this.editorGroupService.partOptions.editorActionsLocation===mt.TITLEBAR||this.editorGroupService.partOptions.editorActionsLocation===mt.DEFAULT&&this.editorGroupService.partOptions.showTabs===Zo.NONE}get activityActionsEnabled(){const e=this.configurationService.getValue(D.ACTIVITY_BAR_LOCATION);return!this.isAuxiliary&&(e===ni.TOP||e===ni.BOTTOM)}get hasZoomableElements(){const e=!(this.currentMenubarVisibility==="hidden"||this.currentMenubarVisibility==="compact"||!j&&ee),i=this.isCommandCenterVisible,t=this.hasGlobalToolbarEntries||this.layoutControlEnabled||this.editorActionsEnabled||this.activityActionsEnabled;return e||i||t}get preventZoom(){return Li(G(this.element))<1||!this.hasZoomableElements}layout(e,i){this.updateLayout(new Ge(e,i)),super.layoutContents(e,i)}updateLayout(e){this.lastLayoutDimensions=e;{const i=Li(G(this.element));if(this.element.style.setProperty("--zoom-factor",i.toString()),this.rootContainer.classList.toggle("counter-zoom",this.preventZoom),this.customMenubar){const t=new Ge(0,e.height);this.customMenubar.layout(t)}}}focus(){var e;this.customMenubar?this.customMenubar.toggleFocus():(e=this.element.querySelector('[tabindex]:not([tabindex="-1"])'))==null||e.focus()}toJSON(){return{type:h.TITLEBAR_PART}}dispose(){this._onWillDispose.fire(),super.dispose()}};Xi=_([f(3,ze),f(4,Fe),f(5,Ri),f(6,K),f(7,Ae),f(8,Ce),f(9,he),f(10,ai),f(11,ri),f(12,Se),f(13,yi),f(14,$t),f(15,Ue)],Xi);let xt=class extends Xi{constructor(e,i,t,s,n,o,a,r,c,l,g,A,p){super(h.TITLEBAR_PART,C,"main",e,i,t,s,n,o,a,r,c,l,g,A,p)}};xt=_([f(0,ze),f(1,Fe),f(2,Ri),f(3,K),f(4,Ae),f(5,Ce),f(6,he),f(7,ai),f(8,ri),f(9,Se),f(10,yi),f(11,$t),f(12,Ue)],xt);var ke;let kt=(ke=class extends Xi{get height(){return this.minimumHeight}constructor(e,i,t,s,n,o,a,r,c,l,g,A,p,R,N,de){const ci=Mt.COUNTER++;super(`workbench.parts.auxiliaryTitle.${ci}`,G(e),i,s,n,o,a,r,c,l,g,A,p,R,N,de),this.container=e,this.mainTitlebar=t}get preventZoom(){return Li(G(this.element))<1||!this.mainTitlebar.hasZoomableElements}},Mt=ke,ke.COUNTER=1,ke);kt=Mt=_([f(3,ze),f(4,Fe),f(5,Ri),f(6,K),f(7,Ae),f(8,Ce),f(9,he),f(10,ai),f(11,ri),f(12,Se),f(13,yi),f(14,$t),f(15,Ue)],kt);function Ga(){return{[Yt.toString()]:new fi(Ot,[],!1)}}Ws(async u=>{u.get(Yt)});let Ht=class extends Xt{get minimumHeight(){return this.visible?this.height:0}get maximumHeight(){return this.visible?this.height:0}get onDidChange(){return this._onDidChangeSize.event}constructor(e,i,t,s,n){super(h.BANNER_PART,{hasTitle:!1},e,t,i),this.contextKeyService=s,this.instantiationService=n,this.height=26,this.minimumWidth=0,this.maximumWidth=Number.POSITIVE_INFINITY,this._onDidChangeSize=this._register(new b),this.visible=!1,this.focusedActionIndex=-1,this.markdownRenderer=this.instantiationService.createInstance(Jo,{})}createContentArea(e){this.element=e,this.element.tabIndex=0,this._register(re(this.element,ce.FOCUS,()=>{this.focusedActionIndex!==-1&&this.focusActionLink()}));const i=this._register(this.contextKeyService.createScoped(this.element));return it.bindTo(i).set(!0),this.element}close(e){this.setVisibility(!1),bi(this.element),typeof e.onClose=="function"&&e.onClose(),this.item=void 0}focusActionLink(){var i,t,s,n,o;const e=((t=(i=this.item)==null?void 0:i.actions)==null?void 0:t.length)??0;if(this.focusedActionIndex<e){const a=(s=this.messageActionsContainer)==null?void 0:s.children[this.focusedActionIndex];Gs(a)&&((n=this.actionBar)==null||n.setFocusable(!1),a.focus())}else(o=this.actionBar)==null||o.focus(0)}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message=="string")return e.message}getBannerMessage(e){if(typeof e=="string"){const i=I("span");return i.innerText=e,i}return this.markdownRenderer.render(e).element}setVisibility(e){e!==this.visible&&(this.visible=e,this.focusedActionIndex=-1,this.layoutService.setPartHidden(!e,h.BANNER_PART),this._onDidChangeSize.fire(void 0))}focus(){this.focusedActionIndex=-1,this.element.focus()}focusNextAction(){var i,t;const e=((t=(i=this.item)==null?void 0:i.actions)==null?void 0:t.length)??0;this.focusedActionIndex=this.focusedActionIndex<e?this.focusedActionIndex+1:0,this.focusActionLink()}focusPreviousAction(){var i,t;const e=((t=(i=this.item)==null?void 0:i.actions)==null?void 0:t.length)??0;this.focusedActionIndex=this.focusedActionIndex>0?this.focusedActionIndex-1:e,this.focusActionLink()}hide(e){var i;((i=this.item)==null?void 0:i.id)===e&&this.setVisibility(!1)}show(e){var r;if(e.id===((r=this.item)==null?void 0:r.id)){this.setVisibility(!0);return}bi(this.element);const i=this.getAriaLabel(e);i&&this.element.setAttribute("aria-label",i);const t=$(this.element,I("div.icon-container"));t.setAttribute("aria-hidden","true"),O.isThemeIcon(e.icon)?t.appendChild(I(`div${O.asCSSSelector(e.icon)}`)):(t.classList.add("custom-icon"),et.isUri(e.icon)&&(t.style.backgroundImage=Qo(e.icon)));const s=$(this.element,I("div.message-container"));if(s.setAttribute("aria-hidden","true"),s.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=$(this.element,I("div.message-actions-container")),e.actions)for(const c of e.actions)this._register(this.instantiationService.createInstance(ea,this.messageActionsContainer,{...c,tabIndex:-1},{}));const n=$(this.element,I("div.action-container"));this.actionBar=this._register(new Kt(n));const o=e.closeLabel??"Close Banner",a=this._register(new Q("banner.close",o,O.asClassName(ia),!0,()=>this.close(e)));this.actionBar.push(a,{icon:!0,label:!1}),this.actionBar.setFocusable(!1),this.setVisibility(!0),this.item=e}toJSON(){return{type:h.BANNER_PART}}};Ht=_([f(0,Ae),f(1,he),f(2,Ce),f(3,ai),f(4,K)],Ht);k.registerCommandAndKeybindingRule({id:"workbench.banner.focusBanner",weight:H.WorkbenchContrib,primary:v.Escape,when:it,handler:u=>{u.get(Ke).focus()}});k.registerCommandAndKeybindingRule({id:"workbench.banner.focusNextAction",weight:H.WorkbenchContrib,primary:v.RightArrow,secondary:[v.DownArrow],when:it,handler:u=>{u.get(Ke).focusNextAction()}});k.registerCommandAndKeybindingRule({id:"workbench.banner.focusPreviousAction",weight:H.WorkbenchContrib,primary:v.LeftArrow,secondary:[v.UpArrow],when:it,handler:u=>{u.get(Ke).focusPreviousAction()}});const Qe=class Qe extends Hs{constructor(){super({id:Qe.ID,title:Qe.LABEL,category:Fs.View,f1:!0})}async run(e){e.get(he).focusPart(h.BANNER_PART)}};Qe.ID="workbench.action.focusBanner",Qe.LABEL=oe(2845,"Focus Banner");let Ft=Qe;ks(Ft);var Mi,He;let Gt=(He=class{constructor(e,i,t){var o;const s=(o=t.options)==null?void 0:o.welcomeBanner;if(!s||i.getBoolean(Mi.WELCOME_BANNER_DISMISSED_KEY,T.PROFILE,!1))return;let n;typeof s.icon=="string"?n=O.fromId(s.icon):s.icon&&(n=et.revive(s.icon)),e.show({id:"welcome.banner",message:s.message,icon:n,actions:s.actions,onClose:()=>{i.store(Mi.WELCOME_BANNER_DISMISSED_KEY,!0,T.PROFILE,P.MACHINE)}})}},Mi=He,He.WELCOME_BANNER_DISMISSED_KEY="workbench.banner.welcome.dismissed",He);Gt=Mi=_([f(0,Ke),f(1,Ce),f(2,Ri)],Gt);ta.as(sa.Workbench).registerWorkbenchContribution(Gt,ui.Restored);function Wa(){return{[Ke.toString()]:new fi(Ht,[],!1)}}Ws(async u=>{u.get(Ke)});let Wt=class extends Fa{constructor(e,i,t){super(la(),e,new da,i),this.instantiationService=t,this.mainContainer.classList.add("monaco-workbench-part")}registerErrorHandler(e){Ls(i=>this.handleUnexpectedError(i,e))}createNotificationsHandlers(){}initServices(){return this.instantiationService}restore(){try{this.restoreParts()}catch(e){Vi(e)}}};Wt=_([f(1,Ps),f(2,K)],Wt);const Ss=ua(C);fa(Ss!=null&&!Ss.guess,C);ga(async u=>{u.get(he).startup()});ma(async u=>{u.get(K).createInstance(pa)});function sr(u,e){return{...ra(e),...aa({isKeybindingConfigurationVisible:()=>!0,shouldUseGlobalPicker:()=>!0}),...oa({shouldUseGlobalKeybindings:()=>!0}),[he.toString()]:new fi(Wt,[u],!1),[Se.toString()]:new fi(ha,[],!1),[yi.toString()]:new fi(ca,[void 0],!1),...Ga(),...na(),...Wa()}}export{ar as AbstractResourceEditorInput,rr as AbstractTextResourceEditorInput,cr as ConfirmResult,hr as DomScrollableElement,lr as EditorInput,Kn as EditorInputCapabilities,h as Parts,dr as RegisteredEditorPriority,ur as SplitView,S as ViewContainerLocation,fr as ViewPaneContainer,sr as default};
