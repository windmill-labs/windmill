{"$schema":"http://json-schema.org/draft-07/schema#","definitions":{"OpenFlow":{"type":"object","properties":{"summary":{"type":"string"},"description":{"type":"string"},"value":{"$ref":"#/definitions/FlowValue"},"schema":{"type":"object"}},"required":["summary","value"]},"FlowValue":{"type":"object","properties":{"modules":{"type":"array","items":{"$ref":"#/definitions/FlowModule"}},"failure_module":{"$ref":"#/definitions/FlowModule"},"preprocessor_module":{"$ref":"#/definitions/FlowModule"},"same_worker":{"type":"boolean"},"concurrent_limit":{"type":"number"},"concurrency_key":{"type":"string"},"concurrency_time_window_s":{"type":"number"},"skip_expr":{"type":"string"},"cache_ttl":{"type":"number"},"priority":{"type":"number"},"early_return":{"type":"string"},"chat_input_enabled":{"type":"boolean","description":"Whether this flow accepts chat-style input"}},"required":["modules"]},"Retry":{"type":"object","properties":{"constant":{"type":"object","properties":{"attempts":{"type":"integer"},"seconds":{"type":"integer"}}},"exponential":{"type":"object","properties":{"attempts":{"type":"integer"},"multiplier":{"type":"integer"},"seconds":{"type":"integer"},"random_factor":{"type":"integer","minimum":0,"maximum":100}}},"retry_if":{"$ref":"#/definitions/RetryIf"}}},"RetryIf":{"type":"object","properties":{"expr":{"type":"string"}},"required":["expr"]},"StopAfterIf":{"type":"object","properties":{"skip_if_stopped":{"type":"boolean"},"expr":{"type":"string"},"error_message":{"type":"string"}},"required":["expr"]},"FlowModule":{"type":"object","properties":{"id":{"type":"string"},"value":{"$ref":"#/definitions/FlowModuleValue"},"stop_after_if":{"$ref":"#/definitions/StopAfterIf"},"stop_after_all_iters_if":{"$ref":"#/definitions/StopAfterIf"},"skip_if":{"type":"object","properties":{"expr":{"type":"string"}},"required":["expr"]},"sleep":{"$ref":"#/definitions/InputTransform"},"cache_ttl":{"type":"number"},"timeout":{"$ref":"#/definitions/InputTransform"},"delete_after_use":{"type":"boolean"},"summary":{"type":"string"},"mock":{"type":"object","properties":{"enabled":{"type":"boolean"},"return_value":{}}},"suspend":{"type":"object","properties":{"required_events":{"type":"integer"},"timeout":{"type":"integer"},"resume_form":{"type":"object","properties":{"schema":{"type":"object"}}},"user_auth_required":{"type":"boolean"},"user_groups_required":{"$ref":"#/definitions/InputTransform"},"self_approval_disabled":{"type":"boolean"},"hide_cancel":{"type":"boolean"},"continue_on_disapprove_timeout":{"type":"boolean"}}},"priority":{"type":"number"},"continue_on_error":{"type":"boolean"},"retry":{"$ref":"#/definitions/Retry"}},"required":["value","id"]},"InputTransform":{"oneOf":[{"$ref":"#/definitions/StaticTransform"},{"$ref":"#/definitions/JavascriptTransform"}],"discriminator":{"propertyName":"type"}},"StaticTransform":{"type":"object","properties":{"value":{},"type":{"type":"string","enum":["static"]}},"required":["type"]},"JavascriptTransform":{"type":"object","properties":{"expr":{"type":"string"},"type":{"type":"string","enum":["javascript"]}},"required":["expr","type"]},"FlowModuleValue":{"oneOf":[{"$ref":"#/definitions/RawScript"},{"$ref":"#/definitions/PathScript"},{"$ref":"#/definitions/PathFlow"},{"$ref":"#/definitions/ForloopFlow"},{"$ref":"#/definitions/WhileloopFlow"},{"$ref":"#/definitions/BranchOne"},{"$ref":"#/definitions/BranchAll"},{"$ref":"#/definitions/Identity"},{"$ref":"#/definitions/AiAgent"}],"discriminator":{"propertyName":"type"}},"RawScript":{"type":"object","properties":{"input_transforms":{"type":"object","additionalProperties":{"$ref":"#/definitions/InputTransform"}},"content":{"type":"string"},"language":{"type":"string","enum":["deno","bun","python3","go","bash","powershell","postgresql","mysql","bigquery","snowflake","mssql","oracledb","graphql","nativets","php"]},"path":{"type":"string"},"lock":{"type":"string"},"type":{"type":"string","enum":["rawscript"]},"tag":{"type":"string"},"concurrent_limit":{"type":"number"},"concurrency_time_window_s":{"type":"number"},"custom_concurrency_key":{"type":"string"},"is_trigger":{"type":"boolean"},"assets":{"type":"array","items":{"type":"object","required":["path","kind"],"properties":{"path":{"type":"string"},"kind":{"type":"string","enum":["s3object","resource","ducklake"]},"access_type":{"type":"string","enum":["r","w","rw"]},"alt_access_type":{"type":"string","enum":["r","w","rw"]}}}}},"required":["type","content","language","input_transforms"]},"PathScript":{"type":"object","properties":{"input_transforms":{"type":"object","additionalProperties":{"$ref":"#/definitions/InputTransform"}},"path":{"type":"string"},"hash":{"type":"string"},"type":{"type":"string","enum":["script"]},"tag_override":{"type":"string"},"is_trigger":{"type":"boolean"}},"required":["type","path","input_transforms"]},"PathFlow":{"type":"object","properties":{"input_transforms":{"type":"object","additionalProperties":{"$ref":"#/definitions/InputTransform"}},"path":{"type":"string"},"type":{"type":"string","enum":["flow"]}},"required":["type","path","input_transforms"]},"ForloopFlow":{"type":"object","properties":{"modules":{"type":"array","items":{"$ref":"#/definitions/FlowModule"}},"iterator":{"$ref":"#/definitions/InputTransform"},"skip_failures":{"type":"boolean"},"type":{"type":"string","enum":["forloopflow"]},"parallel":{"type":"boolean"},"parallelism":{"$ref":"#/definitions/InputTransform"}},"required":["modules","iterator","skip_failures","type"]},"WhileloopFlow":{"type":"object","properties":{"modules":{"type":"array","items":{"$ref":"#/definitions/FlowModule"}},"skip_failures":{"type":"boolean"},"type":{"type":"string","enum":["whileloopflow"]},"parallel":{"type":"boolean"},"parallelism":{"$ref":"#/definitions/InputTransform"}},"required":["modules","skip_failures","type"]},"BranchOne":{"type":"object","properties":{"branches":{"type":"array","items":{"type":"object","properties":{"summary":{"type":"string"},"expr":{"type":"string"},"modules":{"type":"array","items":{"$ref":"#/definitions/FlowModule"}}},"required":["modules","expr"]}},"default":{"type":"array","items":{"$ref":"#/definitions/FlowModule"},"required":["modules"]},"type":{"type":"string","enum":["branchone"]}},"required":["branches","default","type"]},"BranchAll":{"type":"object","properties":{"branches":{"type":"array","items":{"type":"object","properties":{"summary":{"type":"string"},"skip_failure":{"type":"boolean"},"modules":{"type":"array","items":{"$ref":"#/definitions/FlowModule"}}},"required":["modules"]}},"type":{"type":"string","enum":["branchall"]},"parallel":{"type":"boolean"}},"required":["branches","type"]},"AgentTool":{"type":"object","properties":{"id":{"type":"string"},"summary":{"type":"string"},"value":{"$ref":"#/definitions/ToolValue"}},"required":["id","value"]},"ToolValue":{"oneOf":[{"$ref":"#/definitions/FlowModuleTool"},{"$ref":"#/definitions/McpToolValue"}]},"FlowModuleTool":{"allOf":[{"type":"object","properties":{"tool_type":{"type":"string","enum":["flowmodule"]}},"required":["tool_type"]},{"$ref":"#/definitions/FlowModuleValue"}]},"McpToolValue":{"type":"object","properties":{"tool_type":{"type":"string","enum":["mcp"]},"resource_path":{"type":"string"},"include_tools":{"type":"array","items":{"type":"string"}},"exclude_tools":{"type":"array","items":{"type":"string"}}},"required":["tool_type","resource_path"]},"AiAgent":{"type":"object","properties":{"input_transforms":{"type":"object","additionalProperties":{"$ref":"#/definitions/InputTransform"}},"tools":{"type":"array","items":{"$ref":"#/definitions/AgentTool"}},"type":{"type":"string","enum":["aiagent"]},"parallel":{"type":"boolean"}},"required":["tools","type","input_transforms"]},"Identity":{"type":"object","properties":{"type":{"type":"string","enum":["identity"]},"flow":{"type":"boolean"}},"required":["type"]},"FlowStatus":{"type":"object","properties":{"step":{"type":"integer"},"modules":{"type":"array","items":{"$ref":"#/definitions/FlowStatusModule"}},"user_states":{"additionalProperties":true},"preprocessor_module":{"allOf":[{"$ref":"#/definitions/FlowStatusModule"}]},"failure_module":{"allOf":[{"$ref":"#/definitions/FlowStatusModule"},{"type":"object","properties":{"parent_module":{"type":"string"}}}]},"retry":{"type":"object","properties":{"fail_count":{"type":"integer"},"failed_jobs":{"type":"array","items":{"type":"string","format":"uuid"}}}}},"required":["step","modules","failure_module"]},"FlowStatusModule":{"type":"object","properties":{"type":{"type":"string","enum":["WaitingForPriorSteps","WaitingForEvents","WaitingForExecutor","InProgress","Success","Failure"]},"id":{"type":"string"},"job":{"type":"string","format":"uuid"},"count":{"type":"integer"},"progress":{"type":"integer"},"iterator":{"type":"object","properties":{"index":{"type":"integer"},"itered":{"type":"array","items":{}},"args":{}}},"flow_jobs":{"type":"array","items":{"type":"string"}},"flow_jobs_success":{"type":"array","items":{"type":"boolean"}},"flow_jobs_duration":{"type":"object","properties":{"started_at":{"type":"array","items":{"type":"string"}},"duration_ms":{"type":"array","items":{"type":"integer"}}}},"branch_chosen":{"type":"object","properties":{"type":{"type":"string","enum":["branch","default"]},"branch":{"type":"integer"}},"required":["type"]},"branchall":{"type":"object","properties":{"branch":{"type":"integer"},"len":{"type":"integer"}},"required":["branch","len"]},"approvers":{"type":"array","items":{"type":"object","properties":{"resume_id":{"type":"integer"},"approver":{"type":"string"}},"required":["resume_id","approver"]}},"failed_retries":{"type":"array","items":{"type":"string","format":"uuid"}},"skipped":{"type":"boolean"},"agent_actions":{"type":"array","items":{"type":"object","oneOf":[{"type":"object","properties":{"job_id":{"type":"string","format":"uuid"},"function_name":{"type":"string"},"type":{"type":"string","enum":["tool_call"]},"module_id":{"type":"string"}},"required":["job_id","function_name","type","module_id"]},{"type":"object","properties":{"call_id":{"type":"string","format":"uuid"},"function_name":{"type":"string"},"resource_path":{"type":"string"},"type":{"type":"string","enum":["mcp_tool_call"]},"arguments":{"type":"object"}},"required":["call_id","function_name","resource_path","type"]},{"type":"object","properties":{"type":{"type":"string","enum":["message"]}},"required":["content","type"]}]}},"agent_actions_success":{"type":"array","items":{"type":"boolean"}}},"required":["type"]}},"$ref":"#/definitions/FlowModule"}