apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: windmillinstances.windmill.dev
spec:
  group: windmill.dev
  names:
    categories: []
    kind: WindmillInstance
    plural: windmillinstances
    shortNames:
    - wmi
    singular: windmillinstance
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: '.status.synced'
      name: Synced
      type: string
    - jsonPath: '.status.lastSyncedAt'
      name: Last Synced
      type: date
    - jsonPath: '.metadata.creationTimestamp'
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for WindmillInstanceSpec via `CustomResource`
        properties:
          spec:
            description: |-
              WindmillInstance CRD spec.

              Declares the desired state for instance-level configuration: - `global_settings` maps directly to the `global_settings` table - `worker_configs` maps to the `config` table with a `worker__` prefix
            properties:
              global_settings:
                default: {}
                description: Global settings to sync to the `global_settings` table.
                properties:
                  app_workspaced_route:
                    nullable: true
                    type: boolean
                  base_url:
                    nullable: true
                    type: string
                  bunfig_install_scopes:
                    nullable: true
                    type: string
                  critical_alert_mute_ui:
                    nullable: true
                    type: boolean
                  critical_alerts_on_db_oversize:
                    description: Configuration for critical alerts when the database exceeds a size threshold.
                    nullable: true
                    properties:
                      enabled:
                        default: false
                        type: boolean
                      value:
                        default: 0.0
                        format: float
                        type: number
                    type: object
                  critical_error_channels:
                    items:
                      anyOf:
                      - required:
                        - email
                      - required:
                        - slack_channel
                      - required:
                        - teams_channel
                      description: A channel for delivering critical error alerts.
                      properties:
                        email:
                          type: string
                        slack_channel:
                          type: string
                        teams_channel:
                          description: Microsoft Teams channel reference.
                          properties:
                            channel_id:
                              type: string
                            channel_name:
                              type: string
                            team_id:
                              type: string
                            team_name:
                              type: string
                          required:
                          - channel_id
                          - channel_name
                          - team_id
                          - team_name
                          type: object
                      type: object
                    nullable: true
                    type: array
                  custom_instance_pg_databases:
                    description: Custom PostgreSQL databases managed by the instance.
                    nullable: true
                    properties:
                      databases:
                        additionalProperties:
                          description: Status of a single custom instance database.
                          properties:
                            error:
                              nullable: true
                              type: string
                            logs:
                              default:
                                super_admin: ''
                              description: Setup log entries for a custom instance database.
                              properties:
                                created_database:
                                  type: string
                                database_credentials:
                                  type: string
                                db_connect:
                                  type: string
                                grant_permissions:
                                  type: string
                                super_admin:
                                  default: ''
                                  type: string
                                valid_dbname:
                                  type: string
                              type: object
                            success:
                              default: false
                              type: boolean
                            tag:
                              nullable: true
                              type: string
                          type: object
                        type: object
                      user_pwd:
                        nullable: true
                        type: string
                    type: object
                  custom_tags:
                    items:
                      type: string
                    nullable: true
                    type: array
                  default_tags_per_workspace:
                    nullable: true
                    type: boolean
                  default_tags_workspaces:
                    items:
                      type: string
                    nullable: true
                    type: array
                  dev_instance:
                    nullable: true
                    type: boolean
                  disable_stats:
                    nullable: true
                    type: boolean
                  ducklake_settings:
                    description: DuckLake catalog database settings.
                    nullable: true
                    properties:
                      ducklakes:
                        additionalProperties:
                          description: A single DuckLake instance configuration.
                          properties:
                            catalog:
                              description: DuckLake catalog backend reference.
                              properties:
                                resource_path:
                                  type: string
                                resource_type:
                                  description: The type of database backing a DuckLake catalog.
                                  enum:
                                  - postgresql
                                  - mysql
                                  - instance
                                  type: string
                              required:
                              - resource_path
                              - resource_type
                              type: object
                            extra_args:
                              nullable: true
                              type: string
                            storage:
                              description: DuckLake storage location.
                              properties:
                                path:
                                  type: string
                                storage:
                                  nullable: true
                                  type: string
                              required:
                              - path
                              type: object
                          required:
                          - catalog
                          - storage
                          type: object
                        type: object
                    required:
                    - ducklakes
                    type: object
                  email_domain:
                    nullable: true
                    type: string
                  expose_debug_metrics:
                    nullable: true
                    type: boolean
                  expose_metrics:
                    nullable: true
                    type: boolean
                  hub_accessible_url:
                    nullable: true
                    type: string
                  hub_api_secret:
                    nullable: true
                    type: string
                  hub_base_url:
                    nullable: true
                    type: string
                  indexer_settings:
                    description: Full-text search indexer configuration.
                    nullable: true
                    properties:
                      commit_job_max_batch_size:
                        format: uint64
                        minimum: 0.0
                        nullable: true
                        type: integer
                      commit_log_max_batch_size:
                        format: uint64
                        minimum: 0.0
                        nullable: true
                        type: integer
                      max_indexed_job_log_size:
                        format: uint64
                        minimum: 0.0
                        nullable: true
                        type: integer
                      refresh_index_period:
                        format: uint64
                        minimum: 0.0
                        nullable: true
                        type: integer
                      refresh_log_index_period:
                        format: uint64
                        minimum: 0.0
                        nullable: true
                        type: integer
                      should_clear_job_index:
                        nullable: true
                        type: boolean
                      should_clear_log_index:
                        nullable: true
                        type: boolean
                      writer_memory_budget:
                        format: uint64
                        minimum: 0.0
                        nullable: true
                        type: integer
                    type: object
                  instance_python_version:
                    nullable: true
                    type: string
                  job_default_timeout:
                    format: int64
                    nullable: true
                    type: integer
                  jwt_secret:
                    nullable: true
                    type: string
                  keep_job_dir:
                    nullable: true
                    type: boolean
                  license_key:
                    nullable: true
                    type: string
                  maven_repos:
                    nullable: true
                    type: string
                  min_keep_alive_version:
                    nullable: true
                    type: string
                  monitor_logs_on_s3:
                    nullable: true
                    type: boolean
                  no_default_maven:
                    nullable: true
                    type: boolean
                  npm_config_registry:
                    nullable: true
                    type: string
                  nuget_config:
                    nullable: true
                    type: string
                  oauths:
                    additionalProperties:
                      description: OAuth client configuration for a single provider.
                      properties:
                        allowed_domains:
                          items:
                            type: string
                          nullable: true
                          type: array
                        connect_config:
                          description: OAuth provider endpoint configuration.
                          nullable: true
                          properties:
                            auth_url:
                              type: string
                            extra_params:
                              additionalProperties:
                                type: string
                              nullable: true
                              type: object
                            extra_params_callback:
                              additionalProperties:
                                type: string
                              nullable: true
                              type: object
                            req_body_auth:
                              nullable: true
                              type: boolean
                            scopes:
                              items:
                                type: string
                              nullable: true
                              type: array
                            token_url:
                              type: string
                            userinfo_url:
                              nullable: true
                              type: string
                          required:
                          - auth_url
                          - token_url
                          type: object
                        id:
                          type: string
                        login_config:
                          description: OAuth provider endpoint configuration.
                          nullable: true
                          properties:
                            auth_url:
                              type: string
                            extra_params:
                              additionalProperties:
                                type: string
                              nullable: true
                              type: object
                            extra_params_callback:
                              additionalProperties:
                                type: string
                              nullable: true
                              type: object
                            req_body_auth:
                              nullable: true
                              type: boolean
                            scopes:
                              items:
                                type: string
                              nullable: true
                              type: array
                            token_url:
                              type: string
                            userinfo_url:
                              nullable: true
                              type: string
                          required:
                          - auth_url
                          - token_url
                          type: object
                        secret:
                          type: string
                      required:
                      - id
                      - secret
                      type: object
                    nullable: true
                    type: object
                  object_store_cache_config:
                    nullable: true
                  openai_azure_base_path:
                    nullable: true
                    type: string
                  otel:
                    description: OpenTelemetry exporter configuration.
                    nullable: true
                    properties:
                      logs_enabled:
                        nullable: true
                        type: boolean
                      metrics_enabled:
                        nullable: true
                        type: boolean
                      otel_exporter_otlp_compression:
                        nullable: true
                        type: string
                      otel_exporter_otlp_endpoint:
                        nullable: true
                        type: string
                      otel_exporter_otlp_headers:
                        nullable: true
                        type: string
                      otel_exporter_otlp_protocol:
                        nullable: true
                        type: string
                      tracing_enabled:
                        nullable: true
                        type: boolean
                    type: object
                  otel_tracing_proxy:
                    description: Per-language HTTP request tracing proxy configuration.
                    nullable: true
                    properties:
                      enabled:
                        default: false
                        type: boolean
                      enabled_languages:
                        items:
                          description: Script language identifier.
                          enum:
                          - python3
                          - deno
                          - go
                          - bash
                          - powershell
                          - postgresql
                          - bun
                          - bunnative
                          - mysql
                          - bigquery
                          - snowflake
                          - graphql
                          - nativets
                          - mssql
                          - oracledb
                          - duckdb
                          - php
                          - rust
                          - ansible
                          - csharp
                          - nu
                          - java
                          - ruby
                          type: string
                        type: array
                    type: object
                  pip_extra_index_url:
                    nullable: true
                    type: string
                  pip_index_url:
                    nullable: true
                    type: string
                  powershell_repo_pat:
                    nullable: true
                    type: string
                  powershell_repo_url:
                    nullable: true
                    type: string
                  request_size_limit_mb:
                    format: int64
                    nullable: true
                    type: integer
                  require_preexisting_user_for_oauth:
                    nullable: true
                    type: boolean
                  retention_period_secs:
                    format: int64
                    nullable: true
                    type: integer
                  ruby_repos:
                    nullable: true
                    type: string
                  saml_metadata:
                    nullable: true
                    type: string
                  scim_token:
                    nullable: true
                    type: string
                  secret_backend:
                    nullable: true
                  slack:
                    nullable: true
                  smtp_settings:
                    description: SMTP server configuration.
                    nullable: true
                    properties:
                      smtp_disable_tls:
                        nullable: true
                        type: boolean
                      smtp_from:
                        nullable: true
                        type: string
                      smtp_host:
                        nullable: true
                        type: string
                      smtp_password:
                        nullable: true
                        type: string
                      smtp_port:
                        format: uint16
                        minimum: 0.0
                        nullable: true
                        type: integer
                      smtp_tls_implicit:
                        nullable: true
                        type: boolean
                      smtp_username:
                        nullable: true
                        type: string
                    type: object
                  teams:
                    nullable: true
                  timeout_wait_result:
                    format: int64
                    nullable: true
                    type: integer
                type: object
                x-kubernetes-preserve-unknown-fields: true
              worker_configs:
                additionalProperties:
                  description: Worker group configuration.
                  properties:
                    additional_python_paths:
                      items:
                        type: string
                      nullable: true
                      type: array
                    autoscaling:
                      description: Worker group autoscaling configuration.
                      nullable: true
                      properties:
                        cooldown_seconds:
                          format: uint64
                          minimum: 0.0
                          nullable: true
                          type: integer
                        custom_tags:
                          items:
                            type: string
                          nullable: true
                          type: array
                        dec_scale_occupancy_rate:
                          format: uint8
                          minimum: 0.0
                          nullable: true
                          type: integer
                        enabled:
                          default: false
                          type: boolean
                        full_scale_cooldown_seconds:
                          format: uint64
                          minimum: 0.0
                          nullable: true
                          type: integer
                        full_scale_jobs_waiting:
                          format: uint64
                          minimum: 0.0
                          nullable: true
                          type: integer
                        inc_num_workers:
                          format: uint32
                          minimum: 0.0
                          nullable: true
                          type: integer
                        inc_scale_num_jobs_waiting:
                          format: uint64
                          minimum: 0.0
                          nullable: true
                          type: integer
                        inc_scale_occupancy_rate:
                          format: uint8
                          minimum: 0.0
                          nullable: true
                          type: integer
                        integration:
                          description: |-
                            Autoscaling integration backend.

                            The `type` field selects the backend: `"script"`, `"dryrun"`, or `"kubernetes"`. For `"script"`, `path` is required and `tag` is optional.
                          nullable: true
                          properties:
                            path:
                              nullable: true
                              type: string
                            tag:
                              nullable: true
                              type: string
                            type:
                              type: string
                          required:
                          - type
                          type: object
                        max_workers:
                          format: uint32
                          minimum: 0.0
                          nullable: true
                          type: integer
                        min_workers:
                          format: uint32
                          minimum: 0.0
                          nullable: true
                          type: integer
                      type: object
                    cache_clear:
                      format: uint32
                      minimum: 0.0
                      nullable: true
                      type: integer
                    dedicated_worker:
                      nullable: true
                      type: string
                    dedicated_workers:
                      items:
                        type: string
                      nullable: true
                      type: array
                    env_vars_allowlist:
                      items:
                        type: string
                      nullable: true
                      type: array
                    env_vars_static:
                      additionalProperties:
                        type: string
                      nullable: true
                      type: object
                    init_bash:
                      nullable: true
                      type: string
                    min_alive_workers_alert_threshold:
                      format: uint32
                      minimum: 0.0
                      nullable: true
                      type: integer
                    periodic_script_bash:
                      nullable: true
                      type: string
                    periodic_script_interval_seconds:
                      format: uint64
                      minimum: 0.0
                      nullable: true
                      type: integer
                    pip_local_dependencies:
                      items:
                        type: string
                      nullable: true
                      type: array
                    priority_tags:
                      additionalProperties:
                        format: uint8
                        minimum: 0.0
                        type: integer
                      nullable: true
                      type: object
                    worker_tags:
                      items:
                        type: string
                      nullable: true
                      type: array
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                default: {}
                description: Worker group configs to sync to the `config` table. Keys are worker group names (e.g. "default", "gpu"). Each key is stored in the DB as `worker__<key>`.
                type: object
            type: object
          status:
            description: Status subresource for WindmillInstance.
            nullable: true
            properties:
              lastSyncedAt:
                description: Timestamp of the last successful sync.
                nullable: true
                type: string
              message:
                default: ''
                description: Human-readable status message.
                type: string
              observedGeneration:
                default: 0
                description: The `.metadata.generation` that was last observed.
                format: int64
                type: integer
              synced:
                description: Whether the last reconciliation was successful.
                type: boolean
            required:
            - synced
            type: object
        required:
        - spec
        title: WindmillInstance
        type: object
    served: true
    storage: true
    subresources:
      status: {}

