name: Build Windows Worker

on:
  push:
    branches:
      - "alp/build_windows"
    paths:
      - "backend/**"
      - ".github/workflows/build_windows_worker.yml"
  # pull_request:
  #   types: [opened, synchronize, reopened]
  #   paths:
  #     - "backend/**"
  #     - ".github/workflows/backend-test.yml"

env:
  CARGO_INCREMENTAL: 0
  DATABASE_URL: postgres://postgres:changeme@postgres:5432/windmill
  DISABLE_EMBEDDING: true
  RUST_LOG: info


jobs:
  cargo_build_windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: cargo build windows
        timeout-minutes: 15
        run: mkdir frontend/build && cd backend && New-Item -Path . -Name "windmill-api/openapi-deref.yaml" -ItemType "File" -Force && cargo build --release

