{"version":3,"file":"util.js","sources":["../../module/util.ts"],"sourcesContent":["import { isUrl } from \"../path.ts\";\nconst urlCache = new Map();\n/**\n * This function is primarily used to bypass the same-origin policy for Web\n * Workers in the browser, it downloads the script from the given URL and\n * converts it to an object URL which can be used by the `Worker` constructor.\n *\n * This function can also be used in other scenarios as it also corrects the\n * content-type of the response to ensure the script can be loaded properly.\n *\n * NOTE: This function is primarily designed for the browser, it has very little\n * use on the server side.\n */\nexport async function getObjectURL(src, mimeType = \"text/javascript\") {\n    var _a;\n    const isAbsolute = isUrl(src);\n    let cache = isAbsolute ? urlCache.get(src) : undefined;\n    if (cache) {\n        return cache;\n    }\n    // Use fetch to download the script and compose an object URL which can\n    // bypass the same-origin policy for web workers.\n    const res = await fetch(src);\n    if (!res.ok) {\n        throw new Error(`Failed to fetch resource: ${src}`);\n    }\n    let blob;\n    // JavaScript has more than one MIME types, so we just check it loosely.\n    const type = mimeType.includes(\"javascript\") ? \"javascript\" : mimeType;\n    if ((_a = res.headers.get(\"content-type\")) === null || _a === void 0 ? void 0 : _a.includes(type)) {\n        blob = await res.blob();\n    }\n    else {\n        // If the MIME type is not matched, we need to convert the response to\n        // a new Blob with the correct MIME type.\n        const buf = await res.arrayBuffer();\n        blob = new Blob([new Uint8Array(buf)], {\n            type: mimeType,\n        });\n    }\n    cache = URL.createObjectURL(blob);\n    isAbsolute && urlCache.set(src, cache);\n    return cache;\n}\n//# sourceMappingURL=util.js.map"],"names":[],"mappings":";;;AACA,MAAM,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAe,YAAY,CAAC,GAAG,EAAE,QAAQ,GAAG,iBAAiB,EAAE;AACtE,IAAI,IAAI,EAAE,CAAC;AACX,IAAI,MAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;AAClC,IAAI,IAAI,KAAK,GAAG,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC;AAC3D,IAAI,IAAI,KAAK,EAAE;AACf,QAAQ,OAAO,KAAK,CAAC;AACrB,KAAK;AACL;AACA;AACA,IAAI,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC;AACjC,IAAI,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE;AACjB,QAAQ,MAAM,IAAI,KAAK,CAAC,CAAC,0BAA0B,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;AAC5D,KAAK;AACL,IAAI,IAAI,IAAI,CAAC;AACb;AACA,IAAI,MAAM,IAAI,GAAG,QAAQ,CAAC,QAAQ,CAAC,YAAY,CAAC,GAAG,YAAY,GAAG,QAAQ,CAAC;AAC3E,IAAI,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,MAAM,IAAI,IAAI,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;AACvG,QAAQ,IAAI,GAAG,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC;AAChC,KAAK;AACL,SAAS;AACT;AACA;AACA,QAAQ,MAAM,GAAG,GAAG,MAAM,GAAG,CAAC,WAAW,EAAE,CAAC;AAC5C,QAAQ,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,UAAU,CAAC,GAAG,CAAC,CAAC,EAAE;AAC/C,YAAY,IAAI,EAAE,QAAQ;AAC1B,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,KAAK,GAAG,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;AACtC,IAAI,UAAU,IAAI,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;AAC3C,IAAI,OAAO,KAAK,CAAC;AACjB;;;;"}