{"version":3,"file":"try.js","sources":["../try.ts"],"sourcesContent":["/**\n * Calls a function safely and return errors when captured.\n * @module\n */\n// @ts-ignore\nimport { isAsyncGenerator, isGenerator } from \"./external/check-iterable/index.mjs\";\nimport { ThenableAsyncGenerator } from \"./external/thenable-generator/index.ts\";\nexport default function _try(fn, ...args) {\n    if (typeof fn === \"function\") {\n        try {\n            return _try(fn.apply(void 0, args));\n        }\n        catch (err) {\n            return [err, undefined];\n        }\n    }\n    let returns = fn;\n    // Implementation details should be ordered from complex to simple.\n    if (returns instanceof ThenableAsyncGenerator) {\n        // special case\n        returns = returns\n            .then((value) => [null, value]);\n        return Promise.resolve(returns)\n            .catch((err) => [err, undefined]);\n    }\n    else if (isAsyncGenerator(returns)) {\n        // @ts-ignore\n        return (async function* () {\n            let input;\n            let result;\n            // Use `while` loop instead of `for...of...` in order to\n            // retrieve the return value of a generator function.\n            while (true) {\n                try {\n                    const { done, value } = await returns.next(input);\n                    if (done) {\n                        result = value;\n                        break;\n                    }\n                    else {\n                        // Receive any potential input value that passed\n                        // to the outer `next()` call, and pass them to\n                        // `res.next()` in the next call.\n                        input = yield Promise.resolve([null, value]);\n                    }\n                }\n                catch (err) {\n                    // If any error occurs, yield that error as resolved\n                    // and break the loop immediately, indicating the\n                    // process is forced broken.\n                    yield Promise.resolve([err, undefined]);\n                    break;\n                }\n            }\n            return [null, result];\n        })();\n    }\n    else if (isGenerator(returns)) {\n        return (function* () {\n            let input;\n            let result;\n            while (true) {\n                try {\n                    const { done, value } = returns.next(input);\n                    if (done) {\n                        result = value;\n                        break;\n                    }\n                    else {\n                        input = yield [null, value];\n                    }\n                }\n                catch (err) {\n                    yield [err, undefined];\n                    break;\n                }\n            }\n            return [null, result];\n        })();\n    }\n    else if (typeof (returns === null || returns === void 0 ? void 0 : returns.then) === \"function\") {\n        returns = returns\n            .then((value) => [null, value]);\n        return Promise.resolve(returns)\n            .catch((err) => [err, undefined]);\n    }\n    else {\n        return [null, returns];\n    }\n}\n//# sourceMappingURL=try.js.map"],"names":[],"mappings":"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"}