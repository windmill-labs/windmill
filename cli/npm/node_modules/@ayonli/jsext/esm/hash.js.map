{"version":3,"file":"hash.js","sources":["../hash.ts"],"sourcesContent":["/**\n * Simplified hash functions for various data types, based on the Web Crypto API\n * and `crypto` package in Node.js.\n * @module\n */\nimport bytes from \"./bytes.ts\";\nimport { isDeno, isNodeLike } from \"./env.ts\";\nimport { hash, hmac as _hmac, toBytes, sha1 as _sha1, sha256 as _sha256, sha512 as _sha512 } from \"./hash/web.ts\";\nexport default hash;\nasync function nodeHash(algorithm, data, encoding = undefined) {\n    const crypto = await import(\"node:crypto\");\n    const bytes = await toBytes(data);\n    const hash = crypto.createHash(algorithm);\n    hash.update(bytes);\n    if (encoding) {\n        return hash.digest(encoding);\n    }\n    else {\n        const result = hash.digest();\n        // Truncate the buffer to the actual byte length so it's consistent with the web API.\n        return result.buffer.slice(result.byteOffset, result.byteOffset + result.byteLength);\n    }\n}\nexport async function sha1(data, encoding = undefined) {\n    if (typeof crypto === \"object\") {\n        return encoding ? _sha1(data, encoding) : _sha1(data);\n    }\n    else if (isDeno || isNodeLike) {\n        return nodeHash(\"sha1\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function sha256(data, encoding = undefined) {\n    if (typeof crypto === \"object\") {\n        return encoding ? _sha256(data, encoding) : _sha256(data);\n    }\n    else if (isDeno || isNodeLike) {\n        return nodeHash(\"sha256\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function sha512(data, encoding = undefined) {\n    if (typeof crypto === \"object\") {\n        return encoding ? _sha512(data, encoding) : _sha512(data);\n    }\n    else if (isDeno || isNodeLike) {\n        return nodeHash(\"sha512\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function md5(data, encoding = undefined) {\n    if (isDeno || isNodeLike) {\n        return nodeHash(\"md5\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function hmac(algorithm, key, data, encoding = undefined) {\n    if (typeof crypto === \"object\") {\n        return encoding ? _hmac(algorithm, key, data, encoding) : _hmac(algorithm, key, data);\n    }\n    else if (isDeno || isNodeLike) {\n        const crypto = await import(\"node:crypto\");\n        const binary = await toBytes(data);\n        const hash = crypto.createHmac(algorithm, bytes(key));\n        hash.update(binary);\n        if (encoding) {\n            return hash.digest(encoding);\n        }\n        else {\n            const result = hash.digest();\n            // Truncate the buffer to the actual byte length so it's consistent with the web API.\n            return result.buffer.slice(result.byteOffset, result.byteOffset + result.byteLength);\n        }\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n//# sourceMappingURL=hash.js.map"],"names":["_sha1","_sha256","_sha512","_hmac"],"mappings":"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"}