{"version":3,"file":"debounce.js","sources":["../debounce.ts"],"sourcesContent":["/**\n * Debounces function calls for frequent access.\n * @module\n */\nimport { asyncTask } from \"./async.ts\";\nconst registry = new Map();\nexport default function debounce(handler, options, reducer = undefined) {\n    const delay = typeof options === \"number\" ? options : options.delay;\n    const key = typeof options === \"number\" ? null : options.for;\n    const hasKey = key !== null && key !== undefined && key !== \"\";\n    let _cache = hasKey ? registry.get(key) : undefined;\n    if (!_cache) {\n        _cache = {\n            for: key,\n            tasks: [],\n            data: undefined,\n            timer: undefined,\n        };\n        if (hasKey) {\n            registry.set(key, _cache);\n        }\n    }\n    const cache = _cache;\n    return async function (data) {\n        if (typeof reducer === \"function\" && cache.data !== undefined) {\n            cache.data = reducer(cache.data, data);\n        }\n        else {\n            cache.data = data;\n        }\n        cache.timer && clearTimeout(cache.timer);\n        cache.timer = setTimeout(() => {\n            // Move tasks and cached data to new variables, so during the middle\n            // of handler running, new calls won't affect the running process.\n            const _tasks = cache.tasks;\n            const _data = cache.data;\n            cache.tasks = [];\n            cache.data = undefined;\n            if (hasKey) {\n                registry.delete(key);\n            }\n            const resolve = (result) => {\n                _tasks.forEach(({ resolve }) => resolve(result));\n            };\n            const reject = (err) => {\n                _tasks.forEach(({ reject }) => reject(err));\n            };\n            try {\n                const res = handler.call(this, _data);\n                if (typeof (res === null || res === void 0 ? void 0 : res.then) === \"function\") {\n                    Promise.resolve(res).then(resolve, reject);\n                }\n                else {\n                    resolve(res);\n                }\n            }\n            catch (err) {\n                reject(err);\n            }\n        }, delay);\n        const task = asyncTask();\n        cache.tasks.push(task);\n        return await task;\n    };\n}\n//# sourceMappingURL=debounce.js.map"],"names":[],"mappings":"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"}