{"version":3,"file":"question.js","sources":["../../../dialog/terminal/question.ts"],"sourcesContent":["import bytes, { concat, equals } from \"../../bytes.ts\";\nimport { chars } from \"../../string.ts\";\nimport { ControlKeys, ControlSequences, NavigationKeys, isTypingInput, moveLeftBy, moveRightBy, readStdin, writeStdout, } from \"../../cli.ts\";\nconst { BS, CTRL_A, CTRL_C, CTRL_E, CR, DEL, ESC, LF } = ControlKeys;\nconst { UP, DOWN, LEFT, RIGHT } = NavigationKeys;\nconst { CLR_RIGHT } = ControlSequences;\nfunction getMasks(mask, length) {\n    return new Array(length).fill(mask).join(\"\");\n}\nexport default async function question(message, options = {}) {\n    const { defaultValue = \"\", mask } = options;\n    const buf = [];\n    let cursor = 0;\n    await writeStdout(bytes(message));\n    if (defaultValue) {\n        const _chars = chars(defaultValue);\n        buf.push(..._chars);\n        cursor += _chars.length;\n        if (mask === undefined) {\n            await writeStdout(bytes(defaultValue));\n        }\n        else if (mask) {\n            await writeStdout(bytes(getMasks(mask, _chars.length)));\n        }\n    }\n    while (true) {\n        const input = await readStdin();\n        if (!input.length || equals(input, UP) || equals(input, DOWN)) {\n            continue;\n        }\n        else if (equals(input, LEFT)) {\n            if (cursor > 0) {\n                const char = buf[--cursor];\n                if (mask === undefined) {\n                    await moveLeftBy(char);\n                }\n                else if (mask) {\n                    await moveLeftBy(mask);\n                }\n            }\n        }\n        else if (equals(input, RIGHT)) {\n            if (cursor < buf.length) {\n                const char = buf[cursor++];\n                if (mask === undefined) {\n                    await moveRightBy(char);\n                }\n                else if (mask) {\n                    await moveRightBy(mask);\n                }\n            }\n        }\n        else if (equals(input, CTRL_A)) {\n            const left = buf.slice(0, cursor);\n            if (left.length) {\n                cursor = 0;\n                if (mask === undefined) {\n                    await moveLeftBy(left.join(\"\"));\n                }\n                else if (mask) {\n                    await moveLeftBy(getMasks(mask, left.length));\n                }\n            }\n        }\n        else if (equals(input, CTRL_E)) {\n            const right = buf.slice(cursor);\n            if (right.length) {\n                cursor = buf.length;\n                if (mask === undefined) {\n                    await moveRightBy(right.join(\"\"));\n                }\n                else if (mask) {\n                    await moveRightBy(getMasks(mask, right.length));\n                }\n            }\n        }\n        else if (equals(input, ESC) || equals(input, CTRL_C)) {\n            await writeStdout(LF);\n            return null;\n        }\n        else if (equals(input, CR) || equals(input, LF)) {\n            await writeStdout(LF);\n            return buf.join(\"\");\n        }\n        else if (equals(input, BS) || equals(input, DEL)) {\n            if (cursor > 0) {\n                cursor--;\n                const [char] = buf.splice(cursor, 1);\n                const rest = buf.slice(cursor);\n                if (mask === undefined) {\n                    await moveLeftBy(char);\n                    await writeStdout(CLR_RIGHT);\n                    if (rest.length) {\n                        const output = rest.join(\"\");\n                        await writeStdout(bytes(output));\n                        await moveLeftBy(output);\n                    }\n                }\n                else if (mask) {\n                    await moveLeftBy(mask);\n                    await writeStdout(CLR_RIGHT);\n                    if (rest.length) {\n                        const output = getMasks(mask, rest.length);\n                        await writeStdout(bytes(output));\n                        await moveLeftBy(output);\n                    }\n                }\n            }\n        }\n        else if (isTypingInput(input)) {\n            const _chars = chars(String(input));\n            if (cursor === buf.length) {\n                buf.push(..._chars);\n                cursor += _chars.length;\n                if (mask === undefined) {\n                    await writeStdout(input);\n                }\n                else if (mask) {\n                    await writeStdout(bytes(getMasks(mask, _chars.length)));\n                }\n            }\n            else {\n                buf.splice(cursor, 0, ..._chars);\n                cursor += _chars.length;\n                if (mask === undefined) {\n                    const rest = buf.slice(cursor).join(\"\");\n                    await writeStdout(concat(input, bytes(rest)));\n                    await moveLeftBy(rest);\n                }\n                else if (mask) {\n                    const output = getMasks(mask, _chars.length);\n                    const rest = getMasks(mask, buf.slice(cursor).length);\n                    await writeStdout(bytes(output + rest));\n                    await moveLeftBy(rest);\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=question.js.map"],"names":[],"mappings":"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"}