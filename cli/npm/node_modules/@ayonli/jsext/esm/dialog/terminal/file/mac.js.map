{"version":3,"file":"mac.js","sources":["../../../../dialog/terminal/file/mac.ts"],"sourcesContent":["import { dedent, lines } from \"../../../string.ts\";\nimport { run } from \"../../../cli.ts\";\nimport { getUTI } from \"../../../filetype.ts\";\nimport { escape } from \"../util.ts\";\nfunction htmlAcceptToAppleType(accept) {\n    return accept.split(/\\s*,\\s*/).map(getUTI).filter(Boolean).map(t => `\"${t}\"`).join(\", \");\n}\nfunction createAppleScript(mode, title = \"\", options = {}) {\n    const { type, forSave, defaultName } = options;\n    if (mode === \"file\") {\n        if (forSave) {\n            return dedent `\n                tell application (path to frontmost application as text)\n                    set myFile to choose file name${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                        ${defaultName ? ` default name \"${escape(defaultName)}\"` : \"\"}\n                    POSIX path of myFile\n                end\n                `;\n        }\n        else {\n            const _type = type ? htmlAcceptToAppleType(type) : \"\";\n            return dedent `\n                tell application (path to frontmost application as text)\n                    set myFile to choose file${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                        ${_type ? ` of type {${_type}}` : \"\"} invisibles false\n                    POSIX path of myFile\n                end\n                `;\n        }\n    }\n    else if (mode === \"files\") {\n        const _type = type ? htmlAcceptToAppleType(type) : \"\";\n        return dedent `\n            tell application (path to frontmost application as text)\n                set myFiles to choose file${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                    ${_type ? ` of type {${_type}}` : \"\"} invisibles false\\\n                    multiple selections allowed true\n                set theList to {}\n                repeat with aItem in myFiles\n                    set end of theList to POSIX path of aItem\n                end repeat\n                set my text item delimiters to \"\\\\n\"\n                return theList as text\n            end\n            `;\n    }\n    else {\n        return dedent `\n            tell application (path to frontmost application as text)\n                set myFolder to choose folder${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                    invisibles false\n                POSIX path of myFolder\n            end\n            `;\n    }\n}\nexport async function macPickFile(title = \"\", options = {}) {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"file\", title, options)\n    ]);\n    if (!code) {\n        const path = stdout.trim();\n        return path || null;\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return null;\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\nexport async function macPickFiles(title = \"\", type = \"\") {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"files\", title, { type })\n    ]);\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()) : [];\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return [];\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\nexport async function macPickFolder(title = \"\") {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"folder\", title)\n    ]);\n    if (!code) {\n        const dir = stdout.trim();\n        return dir || null;\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return null;\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\n//# sourceMappingURL=mac.js.map"],"names":[],"mappings":"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"}