{"version":3,"file":"bytes.js","sources":["../bytes.ts"],"sourcesContent":["/**\n * Functions for dealing with byte arrays (`Uint8Array`).\n * @module\n */\nimport { equals as _equals, includeSlice as _includesSlice, startsWith as _startsWith, endsWith as _endsWith, split as _split, chunk as _chunk, } from \"./array/base.ts\";\nimport { decodeBase64, decodeHex, encodeBase64, encodeHex } from \"./encoding.ts\";\nimport { sum } from \"./math.ts\";\nconst defaultEncoder = new TextEncoder();\nconst defaultDecoder = new TextDecoder();\n/**\n * A byte array is a `Uint8Array` that can be coerced to a string with `utf8`\n * encoding.\n */\nexport class ByteArray extends Uint8Array {\n    toString() {\n        return text(this);\n    }\n    toJSON() {\n        return {\n            type: \"ByteArray\",\n            data: Array.from(this),\n        };\n    }\n}\nexport default function bytes(data, encoding = \"utf8\") {\n    if (typeof data === \"number\") {\n        return new ByteArray(data);\n    }\n    else if (typeof data === \"string\") {\n        let _data;\n        if (encoding === \"hex\") {\n            _data = decodeHex(data);\n        }\n        else if (encoding === \"base64\") {\n            _data = decodeBase64(data);\n        }\n        else {\n            _data = defaultEncoder.encode(data);\n        }\n        return new ByteArray(_data.buffer, _data.byteOffset, _data.byteLength);\n    }\n    else if (ArrayBuffer.isView(data)) {\n        return new ByteArray(data.buffer, data.byteOffset, data.byteLength);\n    }\n    else {\n        return new ByteArray(data);\n    }\n}\n/**\n * Converts the byte array (or `Uint8Array`) to a string.\n * @param encoding Default value: `utf8`.\n *\n * @example\n * ```ts\n * import { text } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33]);\n *\n * console.log(text(arr)); // \"Hello, World!\"\n * console.log(text(arr, \"hex\")); // \"48656c6c6f2c20576f726c6421\"\n * console.log(text(arr, \"base64\")); // \"SGVsbG8sIFdvcmxkIQ==\"\n * ```\n */\nexport function text(bytes, encoding = \"utf8\") {\n    if (encoding === \"hex\") {\n        return encodeHex(bytes);\n    }\n    else if (encoding === \"base64\") {\n        return encodeBase64(bytes);\n    }\n    else if (typeof Buffer === \"function\" && bytes instanceof Buffer) {\n        return bytes.toString(\"utf8\");\n    }\n    else {\n        return defaultDecoder.decode(bytes);\n    }\n}\n/**\n * Copies bytes from `src` array to `dest` and returns the number of bytes copied.\n *\n * @example\n * ```ts\n * import { copy } from \"@ayonli/jsext/bytes\";\n *\n * const src = new Uint8Array([1, 2, 3, 4, 5]);\n * const dest = new Uint8Array(3);\n *\n * const n = copy(src, dest);\n *\n * console.log(n); // 3\n * console.log(dest); // Uint8Array(3) [ 1, 2, 3 ]\n * ```\n */\nexport function copy(src, dest) {\n    if (src.length > dest.length) {\n        src = src.subarray(0, dest.length);\n    }\n    dest.set(src);\n    return src.length;\n}\n/**\n * Like `Buffer.concat` but for native `Uint8Array`.\n *\n * @example\n * ```ts\n * import { concat } from \"@ayonli/jsext/bytes\";\n *\n * const arr1 = new Uint8Array([1, 2, 3]);\n * const arr2 = new Uint8Array([4, 5, 6]);\n *\n * const result = concat(arr1, arr2);\n *\n * console.log(result); // Uint8Array(6) [ 1, 2, 3, 4, 5, 6 ]\n * ```\n */\nexport function concat(...arrays) {\n    var _a;\n    const length = sum(...arrays.map(arr => arr.length));\n    const ctor = (((_a = arrays[0]) === null || _a === void 0 ? void 0 : _a.constructor) || Uint8Array);\n    const result = typeof Buffer === \"function\" && Object.is(ctor, Buffer)\n        ? Buffer.alloc(length)\n        : new ctor(length);\n    let offset = 0;\n    for (const arr of arrays) {\n        result.set(arr, offset);\n        offset += arr.length;\n    }\n    return result;\n}\n/**\n * Like `Buffer.compare` but for native `Uint8Array`.\n *\n * @example\n * ```ts\n * import { compare } from \"@ayonli/jsext/bytes\";\n *\n * const arr1 = new Uint8Array([1, 2, 3]);\n * const arr2 = new Uint8Array([1, 2, 4]);\n * const arr3 = new Uint8Array([1, 2, 3, 4]);\n * const arr4 = new Uint8Array([1, 2, 3]);\n * const arr5 = new Uint8Array([1, 2]);\n *\n * console.log(compare(arr1, arr2)); // -1\n * console.log(compare(arr1, arr3)); // -1\n * console.log(compare(arr1, arr4)); // 0\n * console.log(compare(arr1, arr5)); // 1\n * ```\n */\nexport function compare(arr1, arr2) {\n    if (arr1 === arr2) {\n        return 0;\n    }\n    for (let i = 0; i < arr1.length; i++) {\n        const ele1 = arr1[i];\n        const ele2 = arr2[i];\n        if (ele2 === undefined) {\n            return 1;\n        }\n        else if (ele1 < ele2) {\n            return -1;\n        }\n        else if (ele1 > ele2) {\n            return 1;\n        }\n    }\n    return arr1.length < arr2.length ? -1 : 0;\n}\n/**\n * Checks if the two byte arrays are equal to each other.\n *\n * @example\n * ```ts\n * import { equals } from \"@ayonli/jsext/bytes\";\n *\n * const arr1 = new Uint8Array([1, 2, 3]);\n * const arr2 = new Uint8Array([1, 2, 3]);\n * const arr3 = new Uint8Array([1, 2, 4]);\n *\n * console.log(equals(arr1, arr2)); // true\n * console.log(equals(arr1, arr3)); // false\n * ```\n */\nexport function equals(arr1, arr2) {\n    if (arr1 === arr2) {\n        return true;\n    }\n    else if (arr1.length !== arr2.length) {\n        return false;\n    }\n    else if (arr1.length < 1000) {\n        return _equals(arr1, arr2);\n    }\n    const len = arr1.length;\n    const compressible = Math.floor(len / 4);\n    const _arr1 = new Uint32Array(arr1.buffer, 0, compressible);\n    const _arr2 = new Uint32Array(arr2.buffer, 0, compressible);\n    for (let i = compressible * 4; i < len; i++) {\n        if (arr1[i] !== arr2[i]) {\n            return false;\n        }\n    }\n    for (let i = 0; i < _arr1.length; i++) {\n        if (_arr1[i] !== _arr2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Checks if the byte array contains another array as a slice of its contents.\n *\n * @example\n * ```ts\n * import { includesSlice } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n *\n * console.log(includesSlice(arr, new Uint8Array([3, 4]))); // true\n * console.log(includesSlice(arr, new Uint8Array([4, 3]))); // false\n * ```\n */\nexport function includesSlice(arr, slice) {\n    return _includesSlice(arr, slice);\n}\n/**\n * Checks if the byte array starts with the given prefix.\n *\n * @example\n * ```ts\n * import { startsWith } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n *\n * console.log(startsWith(arr, new Uint8Array([1, 2]))); // true\n * console.log(startsWith(arr, new Uint8Array([2, 1]))); // false\n * ```\n */\nexport function startsWith(arr, prefix) {\n    return _startsWith(arr, prefix);\n}\n/**\n * Checks if the byte array ends with the given suffix.\n *\n * @example\n * ```ts\n * import { endsWith } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n *\n * console.log(endsWith(arr, new Uint8Array([4, 5]))); // true\n * console.log(endsWith(arr, new Uint8Array([5, 4]))); // false\n * ```\n */\nexport function endsWith(arr, suffix) {\n    return _endsWith(arr, suffix);\n}\n/**\n * Breaks the byte array into smaller chunks according to the given delimiter.\n *\n * @example\n * ```ts\n * import { split } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 0, 4, 5, 0, 6, 7]);\n *\n * console.log(split(arr, 0));\n * // [\n * //     Uint8Array(3) [ 1, 2, 3 ],\n * //     Uint8Array(2) [ 4, 5 ],\n * //     Uint8Array(2) [ 6, 7 ]\n * // ]\n * ```\n */\nexport function split(arr, delimiter) {\n    return _split(arr, delimiter);\n}\n/**\n * Breaks the byte array into smaller chunks according to the given length.\n *\n * @example\n * ```ts\n * import { chunk } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5, 6, 7]);\n *\n * console.log(chunk(arr, 3));\n * // [\n * //     Uint8Array(3) [ 1, 2, 3 ],\n * //     Uint8Array(3) [ 4, 5, 6 ],\n * //     Uint8Array(1) [ 7 ]\n * // ]\n * ```\n */\nexport function chunk(arr, length) {\n    return _chunk(arr, length);\n}\n//# sourceMappingURL=bytes.js.map"],"names":["_equals","_includesSlice","_startsWith","_endsWith","_split","_chunk"],"mappings":"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E,KAAK,CAAC,CAAC;AACtC,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,UAAU,CAAC,GAAG,EAAE,MAAM,EAAE;AACxC,IAAI,OAAOC,YAAW,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AACpC,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,QAAQ,CAAC,GAAG,EAAE,MAAM,EAAE;AACtC,IAAI,OAAOC,UAAS,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AAClC,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE;AACtC,IAAI,OAAOC,OAAM,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;AAClC,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,KAAK,CAAC,GAAG,EAAE,MAAM,EAAE;AACnC,IAAI,OAAOC,OAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AAC/B;;;;"}