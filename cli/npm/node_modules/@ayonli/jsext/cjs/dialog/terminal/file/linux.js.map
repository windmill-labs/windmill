{"version":3,"file":"linux.js","sources":["../../../../dialog/terminal/file/linux.ts"],"sourcesContent":["import { extname } from \"../../../path.ts\";\nimport { lines } from \"../../../string.ts\";\nimport { run } from \"../../../cli.ts\";\nimport { getExtensions } from \"../../../filetype.ts\";\nfunction htmlAcceptToFileFilters(accept) {\n    const groups = [];\n    for (const type of accept.split(/\\s*,\\s*/)) {\n        if (type.endsWith(\"/*\")) {\n            groups.push(type);\n        }\n        else {\n            const group = groups[groups.length - 1];\n            if (!group || typeof group === \"string\") {\n                groups.push([type]);\n            }\n            else {\n                group.push(type);\n            }\n        }\n    }\n    return groups.map(group => {\n        if (Array.isArray(group)) {\n            return group.map(type => getExtensions(type).map(t => `*${t}`))\n                .flat()\n                .join(\" \");\n        }\n        else if (group === \"*/*\") {\n            return \"All Files | *\";\n        }\n        else {\n            const patterns = getExtensions(group).map(t => `*${t}`).join(\" \");\n            if (!patterns) {\n                return undefined;\n            }\n            else if (group === \"video/*\") {\n                return \"Video Files | \" + patterns;\n            }\n            else if (group === \"audio/*\") {\n                return \"Audio Files | \" + patterns;\n            }\n            else if (group === \"image/*\") {\n                return \"Image Files | \" + patterns;\n            }\n            else if (group === \"text/*\") {\n                return \"Text Files | \" + patterns;\n            }\n            else {\n                return patterns;\n            }\n        }\n    }).filter(Boolean);\n}\nexport async function linuxPickFile(title = \"\", options = {}) {\n    const { type, forSave, defaultName } = options;\n    const args = [\n        \"--file-selection\",\n    ];\n    if (title) {\n        args.push(\"--title\", title);\n    }\n    if (type) {\n        htmlAcceptToFileFilters(type).forEach(filter => {\n            args.push(\"--file-filter\", filter);\n        });\n    }\n    if (forSave) {\n        args.push(\"--save\", \"--confirm-overwrite\");\n        if (defaultName) {\n            args.push(\"--filename\", defaultName);\n            if (!type) {\n                const ext = extname(defaultName);\n                if (ext) {\n                    htmlAcceptToFileFilters(ext).forEach(filter => {\n                        args.push(\"--file-filter\", filter);\n                    });\n                }\n            }\n        }\n    }\n    const { code, stdout, stderr } = await run(\"zenity\", args);\n    if (!code) {\n        const path = stdout.trim();\n        return path || null;\n    }\n    else if (code === 1) {\n        return null;\n    }\n    else {\n        throw new Error(stderr.trim());\n    }\n}\nexport async function linuxPickFiles(title = \"\", type = \"\") {\n    const args = [\n        \"--file-selection\",\n        \"--multiple\",\n        \"--separator\", \"\\n\",\n    ];\n    if (title) {\n        args.push(\"--title\", title);\n    }\n    if (type) {\n        htmlAcceptToFileFilters(type).forEach(filter => {\n            args.push(\"--file-filter\", filter);\n        });\n    }\n    const { code, stdout, stderr } = await run(\"zenity\", args);\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()) : [];\n    }\n    else if (code === 1) {\n        return [];\n    }\n    else {\n        throw new Error(stderr.trim());\n    }\n}\nexport async function linuxPickFolder(title = \"\") {\n    const args = [\n        \"--file-selection\",\n        \"--directory\",\n    ];\n    if (title) {\n        args.push(\"--title\", title);\n    }\n    const { code, stdout, stderr } = await run(\"zenity\", args);\n    if (!code) {\n        const dir = stdout.trim();\n        return dir || null;\n    }\n    else if (code === 1) {\n        return null;\n    }\n    else {\n        throw new Error(stderr.trim());\n    }\n}\n//# sourceMappingURL=linux.js.map"],"names":["getExtensions","extname","run","lines"],"mappings":";;;;;;;AAIA,SAAS,uBAAuB,CAAC,MAAM,EAAE;AACzC,IAAI,MAAM,MAAM,GAAG,EAAE,CAAC;AACtB,IAAI,KAAK,MAAM,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE;AAChD,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;AACjC,YAAY,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC9B,SAAS;AACT,aAAa;AACb,YAAY,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AACpD,YAAY,IAAI,CAAC,KAAK,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;AACrD,gBAAgB,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;AACpC,aAAa;AACb,iBAAiB;AACjB,gBAAgB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACjC,aAAa;AACb,SAAS;AACT,KAAK;AACL,IAAI,OAAO,MAAM,CAAC,GAAG,CAAC,KAAK,IAAI;AAC/B,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;AAClC,YAAY,OAAO,KAAK,CAAC,GAAG,CAAC,IAAI,IAAIA,sBAAa,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3E,iBAAiB,IAAI,EAAE;AACvB,iBAAiB,IAAI,CAAC,GAAG,CAAC,CAAC;AAC3B,SAAS;AACT,aAAa,IAAI,KAAK,KAAK,KAAK,EAAE;AAClC,YAAY,OAAO,eAAe,CAAC;AACnC,SAAS;AACT,aAAa;AACb,YAAY,MAAM,QAAQ,GAAGA,sBAAa,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC9E,YAAY,IAAI,CAAC,QAAQ,EAAE;AAC3B,gBAAgB,OAAO,SAAS,CAAC;AACjC,aAAa;AACb,iBAAiB,IAAI,KAAK,KAAK,SAAS,EAAE;AAC1C,gBAAgB,OAAO,gBAAgB,GAAG,QAAQ,CAAC;AACnD,aAAa;AACb,iBAAiB,IAAI,KAAK,KAAK,SAAS,EAAE;AAC1C,gBAAgB,OAAO,gBAAgB,GAAG,QAAQ,CAAC;AACnD,aAAa;AACb,iBAAiB,IAAI,KAAK,KAAK,SAAS,EAAE;AAC1C,gBAAgB,OAAO,gBAAgB,GAAG,QAAQ,CAAC;AACnD,aAAa;AACb,iBAAiB,IAAI,KAAK,KAAK,QAAQ,EAAE;AACzC,gBAAgB,OAAO,eAAe,GAAG,QAAQ,CAAC;AAClD,aAAa;AACb,iBAAiB;AACjB,gBAAgB,OAAO,QAAQ,CAAC;AAChC,aAAa;AACb,SAAS;AACT,KAAK,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AACvB,CAAC;AACM,eAAe,aAAa,CAAC,KAAK,GAAG,EAAE,EAAE,OAAO,GAAG,EAAE,EAAE;AAC9D,IAAI,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG,OAAO,CAAC;AACnD,IAAI,MAAM,IAAI,GAAG;AACjB,QAAQ,kBAAkB;AAC1B,KAAK,CAAC;AACN,IAAI,IAAI,KAAK,EAAE;AACf,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;AACpC,KAAK;AACL,IAAI,IAAI,IAAI,EAAE;AACd,QAAQ,uBAAuB,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI;AACxD,YAAY,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;AAC/C,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,IAAI,OAAO,EAAE;AACjB,QAAQ,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,qBAAqB,CAAC,CAAC;AACnD,QAAQ,IAAI,WAAW,EAAE;AACzB,YAAY,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,WAAW,CAAC,CAAC;AACjD,YAAY,IAAI,CAAC,IAAI,EAAE;AACvB,gBAAgB,MAAM,GAAG,GAAGC,YAAO,CAAC,WAAW,CAAC,CAAC;AACjD,gBAAgB,IAAI,GAAG,EAAE;AACzB,oBAAoB,uBAAuB,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI;AACnE,wBAAwB,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;AAC3D,qBAAqB,CAAC,CAAC;AACvB,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;AACL,IAAI,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAMC,OAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;AAC/D,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,QAAQ,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;AACnC,QAAQ,OAAO,IAAI,IAAI,IAAI,CAAC;AAC5B,KAAK;AACL,SAAS,IAAI,IAAI,KAAK,CAAC,EAAE;AACzB,QAAQ,OAAO,IAAI,CAAC;AACpB,KAAK;AACL,SAAS;AACT,QAAQ,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;AACvC,KAAK;AACL,CAAC;AACM,eAAe,cAAc,CAAC,KAAK,GAAG,EAAE,EAAE,IAAI,GAAG,EAAE,EAAE;AAC5D,IAAI,MAAM,IAAI,GAAG;AACjB,QAAQ,kBAAkB;AAC1B,QAAQ,YAAY;AACpB,QAAQ,aAAa,EAAE,IAAI;AAC3B,KAAK,CAAC;AACN,IAAI,IAAI,KAAK,EAAE;AACf,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;AACpC,KAAK;AACL,IAAI,IAAI,IAAI,EAAE;AACd,QAAQ,uBAAuB,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI;AACxD,YAAY,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;AAC/C,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAMA,OAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;AAC/D,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,QAAQ,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;AACrC,QAAQ,OAAO,MAAM,GAAGC,YAAK,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC;AAClD,KAAK;AACL,SAAS,IAAI,IAAI,KAAK,CAAC,EAAE;AACzB,QAAQ,OAAO,EAAE,CAAC;AAClB,KAAK;AACL,SAAS;AACT,QAAQ,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;AACvC,KAAK;AACL,CAAC;AACM,eAAe,eAAe,CAAC,KAAK,GAAG,EAAE,EAAE;AAClD,IAAI,MAAM,IAAI,GAAG;AACjB,QAAQ,kBAAkB;AAC1B,QAAQ,aAAa;AACrB,KAAK,CAAC;AACN,IAAI,IAAI,KAAK,EAAE;AACf,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;AACpC,KAAK;AACL,IAAI,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAMD,OAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;AAC/D,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,QAAQ,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC;AAClC,QAAQ,OAAO,GAAG,IAAI,IAAI,CAAC;AAC3B,KAAK;AACL,SAAS,IAAI,IAAI,KAAK,CAAC,EAAE;AACzB,QAAQ,OAAO,IAAI,CAAC;AACpB,KAAK;AACL,SAAS;AACT,QAAQ,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;AACvC,KAAK;AACL;;;;;;"}