{"version":3,"file":"prompt.js","sources":["../../../dialog/terminal/prompt.ts"],"sourcesContent":["import { escape } from \"./util.ts\";\nimport { dedent } from \"../../string.ts\";\nimport { platform } from \"../../runtime.ts\";\nimport { isWSL, lockStdin, powershell, run, which } from \"../../cli.ts\";\nimport question from \"./question.ts\";\nfunction createAppleScript(message, defaultValue = \"\", password = false) {\n    return dedent `\n        tell application (path to frontmost application as text)\n            set response to display dialog \"${escape(message)}\" with title \"Prompt\"\\\n                default answer \"${escape(defaultValue)}\"${password ? \" hidden answer true\" : \"\"}\n            return text returned of response\n        end\n        `;\n}\nfunction createPowerShellScript(message, defaultValue = \"\", password = false) {\n    return dedent `\n        Add-Type -AssemblyName System.Windows.Forms\n        $form = New-Object System.Windows.Forms.Form\n        $form.Text = 'Prompt'\n        $form.Size = New-Object System.Drawing.Size(450,175)\n        $form.StartPosition = 'CenterScreen'\n        $form.FormBorderStyle = 'FixedDialog'\n        $form.Font = New-Object System.Drawing.Font('Aria', 10)\n        $form.AutoScaleMode = 'Dpi'\n        $form.MaximizeBox = $false\n        $form.MinimizeBox = $false\n        \n        $label = New-Object System.Windows.Forms.Label\n        $label.Location = New-Object System.Drawing.Point(17,20)\n        $label.Size = New-Object System.Drawing.Size(400,30)\n        $label.Text = \"${escape(message)}\"\n        $form.Controls.Add($label)\n        \n        $textBox = New-Object System.Windows.Forms.TextBox\n        $textBox.Location = New-Object System.Drawing.Point(17,50)\n        $textBox.Size = New-Object System.Drawing.Size(400,30)\n        $textBox.UseSystemPasswordChar = ${password ? \"$true\" : \"$false\"}\n        $textBox.Text = \"${escape(defaultValue)}\"\n        $form.Controls.Add($textBox)\n        \n        $cancelButton = New-Object System.Windows.Forms.Button\n        $cancelButton.Location = New-Object System.Drawing.Point(232,90)\n        $cancelButton.Size = New-Object System.Drawing.Size(87,27)\n        $cancelButton.Text = 'Cancel'\n        $cancelButton.DialogResult = [System.Windows.Forms.DialogResult]::Cancel\n        $cancelButton.FlatStyle = 'System'\n        $form.Controls.Add($cancelButton)\n        \n        $okButton = New-Object System.Windows.Forms.Button\n        $okButton.Location = New-Object System.Drawing.Point(330,90)\n        $okButton.Size = New-Object System.Drawing.Size(87,27)\n        $okButton.Text = 'OK'\n        $okButton.DialogResult = [System.Windows.Forms.DialogResult]::OK\n        $okButton.FlatStyle = 'System'\n        $form.Controls.Add($okButton)\n        \n        $form.AcceptButton = $okButton\n        $form.CancelButton = $cancelButton\n        $form.Add_Shown({$textBox.Select()})\n        \n        $result = $form.ShowDialog()\n        \n        if ($result -eq [System.Windows.Forms.DialogResult]::OK)\n        {\n            $textBox.Text\n        }\n        elseif ($result -eq [System.Windows.Forms.DialogResult]::Cancel)\n        {\n            throw 'User canceled'\n        }\n        `;\n}\nexport default async function promptInTerminal(message, options = {}) {\n    if ((options === null || options === void 0 ? void 0 : options.gui) && platform() === \"darwin\") {\n        const { code, stdout, stderr } = await run(\"osascript\", [\n            \"-e\",\n            createAppleScript(message, options.defaultValue, options.type === \"password\")\n        ]);\n        if (code) {\n            if (stderr.includes(\"User canceled\")) {\n                return null;\n            }\n            else {\n                throw new Error(stderr);\n            }\n        }\n        else {\n            return stdout.trim();\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"windows\" || isWSL())) {\n        const { code, stdout, stderr } = await powershell(createPowerShellScript(message, options.defaultValue, options.type === \"password\"));\n        if (code) {\n            if (stderr.includes(\"User canceled\")) {\n                return null;\n            }\n            else {\n                throw new Error(stderr);\n            }\n        }\n        else {\n            return stdout.trim();\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"linux\" || await which(\"zenity\"))) {\n        const args = [\n            \"--entry\",\n            \"--title\", \"Prompt\",\n            \"--width\", \"450\",\n        ];\n        if (message) {\n            args.push(\"--text\", message);\n        }\n        if (options.defaultValue) {\n            args.push(\"--entry-text\", options.defaultValue);\n        }\n        if (options.type === \"password\") {\n            args.push(\"--hide-text\");\n        }\n        const { code, stdout, stderr } = await run(\"zenity\", args);\n        if (!code) {\n            return stdout.trim();\n        }\n        else if (code === 1) {\n            return null;\n        }\n        else {\n            throw new Error(stderr);\n        }\n    }\n    else {\n        return await lockStdin(() => question(message + \" \", options));\n    }\n}\n//# sourceMappingURL=prompt.js.map"],"names":["dedent","escape","platform","run","isWSL","powershell","which","lockStdin","question"],"mappings":"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"}