{"version":3,"file":"deprecate.js","sources":["../deprecate.ts"],"sourcesContent":["/**\n * Marks a function as deprecated and emit warnings when it is called.\n * @module\n * @experimental\n */\nimport runtime from \"./runtime.ts\";\nimport wrap from \"./wrap.ts\";\nconst warnedRecord = new Map();\nexport default function deprecate(target, ...args) {\n    var _a, _b, _c, _d;\n    const { identity } = runtime();\n    if (typeof target === \"function\") {\n        const tip = (_a = args[0]) !== null && _a !== void 0 ? _a : \"\";\n        const once = (_b = args[1]) !== null && _b !== void 0 ? _b : false;\n        return wrap(target, function wrapped(fn, ...args) {\n            const lineOffset = ({\n                \"node\": 2,\n                \"deno\": 2,\n                \"chrome\": 2,\n                \"workerd\": 2,\n                \"bun\": 1,\n                \"safari\": 1,\n                \"firefox\": 3,\n                \"fastly\": 3,\n                \"unknown\": 3,\n            })[identity];\n            emitWarning(fn.name + \"()\", wrapped, tip, once, lineOffset, identity, true);\n            return fn.apply(this, args);\n        });\n    }\n    const forFn = args[0];\n    const tip = (_c = args[1]) !== null && _c !== void 0 ? _c : \"\";\n    const once = (_d = args[2]) !== null && _d !== void 0 ? _d : false;\n    const lineOffset = ({\n        \"node\": 1,\n        \"deno\": 1,\n        \"chrome\": 1,\n        \"workerd\": 1,\n        \"bun\": 1,\n        \"safari\": 1,\n        \"firefox\": 3,\n        \"fastly\": 3,\n        \"unknown\": 3,\n    })[identity];\n    return emitWarning(target, forFn, tip, once, lineOffset, identity, false);\n}\nfunction emitWarning(target, forFn, tip, once, lineNum, runtime, wrapped = false) {\n    if (!once || !warnedRecord.has(forFn)) {\n        let trace = {};\n        if (typeof Error.captureStackTrace === \"function\") {\n            Error.captureStackTrace(trace, forFn);\n        }\n        else {\n            trace = new Error(\"\");\n        }\n        let lines = trace.stack.split(\"\\n\");\n        const offset = lines.findIndex(line => line === \"Error\");\n        if (offset !== -1 && offset !== 0) {\n            lines = lines.slice(offset); // fix for tsx in Node.js v16\n        }\n        let line;\n        if (runtime === \"safari\") {\n            line = lines.find(line => line.trim().startsWith(\"module code@\"))\n                || lines[lineNum];\n        }\n        else if (runtime === \"bun\" && !wrapped) {\n            line = lines.find(line => line.trim().startsWith(\"at module code\"))\n                || lines[lineNum];\n        }\n        else {\n            line = lines[lineNum];\n        }\n        let warning = `${target} is deprecated`;\n        if (tip) {\n            warning += \", \" + tip;\n        }\n        if (line) {\n            line = line.trim();\n            let start = line.indexOf(\"(\");\n            if (start !== -1) {\n                start += 1;\n                const end = line.indexOf(\")\", start);\n                line = line.slice(start, end);\n            }\n            warning += \" (\" + line + \")\";\n        }\n        console.warn(\"DeprecationWarning:\", warning);\n        once && warnedRecord.set(forFn, true);\n    }\n}\n//# sourceMappingURL=deprecate.js.map"],"names":["runtime","wrap"],"mappings":"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"}