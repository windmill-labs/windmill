{"version":3,"file":"internal.js","sources":["../../http/internal.ts"],"sourcesContent":["/**\n * This is an internal module that provides utility functions for handling HTTP\n * requests, mostly used by the `http.serve` and `http.serveStatic` functions.\n *\n * This module is exposed for advanced use cases such as when we want to\n * implement a new `serve` function that behave like the existing one, e.g. for\n * integrating with Vite dev server.\n *\n * @module\n * @experimental\n */\nimport { orderBy } from \"../array.ts\";\nimport { join } from \"../path.ts\";\nimport runtime from \"../runtime.ts\";\nimport { EventEndpoint } from \"../sse.ts\";\nimport { capitalize, dedent } from \"../string.ts\";\nfunction sanitizeTimers(timers) {\n    const total = timers.get(\"total\");\n    const _timers = new Map([...timers].filter(([name, metrics]) => !!metrics.timeEnd && name !== \"total\"));\n    if (!!(total === null || total === void 0 ? void 0 : total.timeEnd)) {\n        _timers.set(\"total\", total);\n    }\n    return _timers;\n}\n/**\n * Creates timing functions for measuring the request processing time. This\n * function returns the timing functions and a `timers` map that associates\n * with them.\n */\nexport function createTimingFunctions() {\n    const timers = new Map();\n    return {\n        timers,\n        getTimers: (sanitize = false) => {\n            return sanitize ? sanitizeTimers(timers) : timers;\n        },\n        time: (name, description) => {\n            if (timers.has(name)) {\n                console.warn(`Timer '${name}' already exists`);\n            }\n            else {\n                timers.set(name, { timeStart: Date.now(), description });\n            }\n        },\n        timeEnd: (name) => {\n            const metrics = timers.get(name);\n            if (metrics) {\n                metrics.timeEnd = Date.now();\n            }\n            else {\n                console.warn(`Timer '${name}' does not exist`);\n            }\n        },\n    };\n}\n/**\n * Creates a request context object from the given `request` and properties.\n */\nexport function createRequestContext(request, props) {\n    const { ws, remoteAddress = null, ...rest } = props;\n    return {\n        remoteAddress,\n        createEventEndpoint: () => {\n            const events = new EventEndpoint(request);\n            return { events, response: events.response };\n        },\n        upgradeWebSocket: () => ws.upgrade(request),\n        ...rest,\n    };\n}\n;\n/**\n * Patches the timing metrics to the response's headers.\n */\nexport function patchTimingMetrics(response, timers) {\n    const metrics = [...sanitizeTimers(timers)].map(([name, metrics]) => {\n        const duration = metrics.timeEnd - metrics.timeStart;\n        let value = `${name};dur=${duration}`;\n        if (metrics.description) {\n            value += `;desc=\"${metrics.description}\"`;\n        }\n        else if (name === \"total\") {\n            value += `;desc=\"Total\"`;\n        }\n        return value;\n    }).join(\", \");\n    if (metrics) {\n        try {\n            response.headers.set(\"Server-Timing\", metrics);\n        }\n        catch (_a) {\n            // Ignore\n        }\n    }\n    return response;\n}\n/**\n * Returns a new request handler that wraps the given one so that we can add\n * extra `headers` to the response.\n */\nexport function withHeaders(handle, headers = undefined) {\n    if (headers === undefined) {\n        const { identity, version } = runtime();\n        let serverName = ({\n            \"node\": \"Node.js\",\n            \"deno\": \"Deno\",\n            \"bun\": \"Bun\",\n            \"workerd\": \"Cloudflare Workers\",\n            \"fastly\": \"Fastly Compute\",\n        })[identity] || \"Unknown\";\n        if (version) {\n            serverName += `/${version}`;\n        }\n        headers = { \"Server\": serverName };\n    }\n    return async (...args) => {\n        const response = await handle(...args);\n        if (response.status === 101) {\n            // WebSocket headers cannot be modified\n            return response;\n        }\n        try {\n            const patch = (name, value) => {\n                if (!response.headers.has(name)) {\n                    response.headers.set(name, value);\n                }\n            };\n            if (headers instanceof Headers) {\n                headers.forEach((value, name) => patch(name, value));\n            }\n            else if (Array.isArray(headers)) {\n                headers.forEach(([name, value]) => patch(name, value));\n            }\n            else if (headers !== null) {\n                Object.entries(headers).forEach(([name, value]) => patch(name, value));\n            }\n        }\n        catch (_a) {\n            // In case the headers are immutable, ignore the error.\n        }\n        return response;\n    };\n}\n/**\n * Adds a event listener to the `fetch` event in service workers that handles\n * HTTP requests with the given options.\n */\nexport function listenFetchEvent(options) {\n    const { ws, fetch, headers, onError, bindings } = options;\n    // @ts-ignore\n    addEventListener(\"fetch\", (event) => {\n        var _a, _b, _c;\n        const { request } = event;\n        const address = (_a = request.headers.get(\"cf-connecting-ip\")) !== null && _a !== void 0 ? _a : (_b = event.client) === null || _b === void 0 ? void 0 : _b.address;\n        const { getTimers, time, timeEnd } = createTimingFunctions();\n        const ctx = createRequestContext(request, {\n            ws,\n            remoteAddress: address ? {\n                family: address.includes(\":\") ? \"IPv6\" : \"IPv4\",\n                address: address,\n                port: 0,\n            } : null,\n            time,\n            timeEnd,\n            waitUntil: (_c = event.waitUntil) === null || _c === void 0 ? void 0 : _c.bind(event),\n            bindings,\n        });\n        const _handle = withHeaders(fetch, headers);\n        const _onError = withHeaders(onError, headers);\n        const response = _handle(request, ctx)\n            .then(res => patchTimingMetrics(res, getTimers()))\n            .catch(err => _onError(err, request, ctx));\n        event.respondWith(response);\n    });\n}\n/**\n * Renders a directory listing page for the `pathname` with the given `entries`.\n */\nexport async function renderDirectoryPage(pathname, entries, extraHeaders = {}) {\n    const list = [\n        ...orderBy(entries.filter(e => e.kind === \"directory\"), e => e.name).map(e => e.name + \"/\"),\n        ...orderBy(entries.filter(e => e.kind === \"file\"), e => e.name).map(e => e.name),\n    ];\n    if (pathname !== \"/\") {\n        list.unshift(\"../\");\n    }\n    const listHtml = list.map((name) => {\n        let url = join(pathname, name);\n        if (name.endsWith(\"/\") && url !== \"/\") {\n            url += \"/\";\n        }\n        return dedent `\n            <li>\n                <a href=\"${url}\">${name}</a>\n            </li>\n            `;\n    });\n    return new Response(dedent `\n                <!DOCTYPE HTML>\n                <html lang=\"en\">\n                <head>\n                    <meta charset=\"utf-8\">\n                    <title>Directory listing for ${pathname}</title>\n                    <style>\n                    body {\n                        font-family: system-ui;\n                    }\n                    </style>\n                </head>\n                <body>\n                    <h1>Directory listing for ${pathname}</h1>\n                    <hr>\n                    <ul>\n                        ${listHtml.join(\"\")}\n                    </ul>\n                </body>\n                </html>\n                `, {\n        status: 200,\n        statusText: \"OK\",\n        headers: {\n            ...extraHeaders,\n            \"Content-Type\": \"text/html; charset=utf-8\",\n        },\n    });\n}\n/**\n * Creates a Node.js HTTP request listener with modern Web APIs.\n *\n * NOTE: This function is only available in Node.js and requires Node.js v18.4.1\n * or above.\n *\n * @example\n * ```ts\n * import * as http from \"node:http\";\n * import { withWeb } from \"@ayonli/jsext/http/internal\";\n *\n * const server = http.createServer(withWeb(async (req) => {\n *     return new Response(\"Hello, World!\");\n * }));\n *\n * server.listen(8000);\n * ```\n */\nexport function withWeb(listener) {\n    return async (nReq, nRes) => {\n        const remoteAddress = {\n            family: nReq.socket.remoteFamily,\n            address: nReq.socket.remoteAddress,\n            port: nReq.socket.remotePort,\n        };\n        const req = toWebRequest(nReq);\n        const res = await listener(req, { remoteAddress });\n        if (!nRes.req) { // fix for Deno and Node.js below v15.7.0\n            Object.assign(nRes, { req: nReq });\n        }\n        if (res && !nRes.headersSent) {\n            if (res.status === 101) {\n                // When the status code is 101, it means the server is upgrading\n                // the connection to a different protocol, usually to WebSocket.\n                // In this case, the response shall be and may have already been\n                // written by the request socket. So we should not write the\n                // response again.\n                return;\n            }\n            toNodeResponse(res, nRes);\n        }\n    };\n}\n/**\n * Transforms a Node.js HTTP request to a modern `Request` object.\n */\nfunction toWebRequest(req) {\n    var _a, _b;\n    const protocol = req.socket[\"encrypted\"] || req.headers[\":scheme\"] === \"https\"\n        ? \"https\" : \"http\";\n    const host = (_a = req.headers[\":authority\"]) !== null && _a !== void 0 ? _a : req.headers[\"host\"];\n    const url = new URL((_b = req.url) !== null && _b !== void 0 ? _b : \"/\", `${protocol}://${host}`);\n    const headers = new Headers(Object.fromEntries(Object.entries(req.headers).filter(([key]) => {\n        return typeof key === \"string\" && !key.startsWith(\":\");\n    })));\n    if (req.headers[\":authority\"]) {\n        headers.set(\"Host\", req.headers[\":authority\"]);\n    }\n    const controller = new AbortController();\n    const init = {\n        method: req.method,\n        headers,\n        signal: controller.signal,\n    };\n    const cache = headers.get(\"Cache-Control\");\n    const mode = headers.get(\"Sec-Fetch-Mode\");\n    const referrer = headers.get(\"Referer\");\n    if (cache === \"no-cache\") {\n        init.cache = \"no-cache\";\n    }\n    else if (cache === \"no-store\") {\n        init.cache = \"no-store\";\n    }\n    else if (cache === \"only-if-cached\" && mode === \"same-origin\") {\n        init.cache = \"only-if-cached\";\n    }\n    else {\n        init.cache = \"default\";\n    }\n    if (mode === \"no-cors\") {\n        init.mode = \"no-cors\";\n    }\n    else if (mode === \"same-origin\") {\n        init.mode = \"same-origin\";\n    }\n    else {\n        init.mode = \"cors\";\n    }\n    if (referrer) {\n        init.referrer = referrer;\n    }\n    if (req.method !== \"GET\" && req.method !== \"HEAD\" && req.method !== \"OPTIONS\") {\n        const { readable, writable } = new TransformStream();\n        const writer = writable.getWriter();\n        req.on(\"data\", (chunk) => {\n            writer.write(chunk);\n        }).once(\"error\", (err) => {\n            writer.abort(err);\n        }).once(\"end\", () => {\n            writer.close();\n        });\n        init.body = readable;\n        // @ts-ignore Node.js special\n        init.duplex = \"half\";\n    }\n    req.once(\"close\", () => {\n        req.errored && controller.abort();\n    });\n    const request = new Request(url, init);\n    if (!req.headers[\":authority\"]) {\n        Object.assign(request, {\n            [Symbol.for(\"incomingMessage\")]: req,\n        });\n    }\n    return request;\n}\n/**\n * Pipes a modern `Response` object to a Node.js HTTP response.\n */\nfunction toNodeResponse(res, nodeRes) {\n    const { status, statusText, headers } = res;\n    for (const [key, value] of headers) {\n        // Use `setHeader` to set headers instead of passing them to `writeHead`,\n        // it seems in Deno, the headers are not written to the response if they\n        // are passed to `writeHead`.\n        nodeRes.setHeader(capitalize(key, true), value);\n    }\n    if (nodeRes.req.httpVersion === \"2.0\") {\n        nodeRes.writeHead(status);\n    }\n    else {\n        nodeRes.writeHead(status, statusText);\n    }\n    if (!res.body) {\n        nodeRes.end();\n    }\n    else {\n        res.body.pipeTo(new WritableStream({\n            start(controller) {\n                nodeRes.once(\"close\", () => {\n                    controller.error();\n                }).once(\"error\", (err) => {\n                    controller.error(err);\n                });\n            },\n            write(chunk) {\n                nodeRes.write(chunk);\n            },\n            close() {\n                nodeRes.end();\n            },\n            abort(err) {\n                nodeRes.destroy(err);\n            },\n        }));\n    }\n}\n//# sourceMappingURL=internal.js.map"],"names":["EventEndpoint","runtime","orderBy","join","dedent","capitalize"],"mappings":"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"}